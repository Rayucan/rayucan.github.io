<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="Rayucan"><meta name="copyright" content="Rayucan"><meta name="generator" content="Hexo 5.4.0"><meta name="theme" content="hexo-theme-yun"><title>云课项目 | Rayの云端小屋</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.25/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link id="light-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism.css" media="(prefers-color-scheme: light)"><link id="dark-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism-tomorrow.css" media="(prefers-color-scheme: dark)"><link rel="icon" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"example.com","root":"/","title":"Rayの云端小屋","version":"1.6.1","mode":"light","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}.","hits":"${hits} results found","hits_time":"${hits} results found in ${time} ms"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><meta name="description" content="Day 1 项目背景 项目采用的商业模式 项目实现的功能模块 项目使用的技术 学习技术 MyBatis-Plus  商业模式B2C 两个角色：管理员和普通用户  管理员：添加 修改 删除 普通用户：查询 本项目采用此模式。 B2B2C举例电商平台 京东：商家：消费者 项目功能模块 b2c模式  系统后台：(管理员使用)  讲师管理模块  课程分类管理模块  课程管理模块 视频  统计分析模块  订">
<meta property="og:type" content="article">
<meta property="og:title" content="云课项目">
<meta property="og:url" content="http://example.com/2021/07/01/Cloud-Learning/index.html">
<meta property="og:site_name" content="Rayの云端小屋">
<meta property="og:description" content="Day 1 项目背景 项目采用的商业模式 项目实现的功能模块 项目使用的技术 学习技术 MyBatis-Plus  商业模式B2C 两个角色：管理员和普通用户  管理员：添加 修改 删除 普通用户：查询 本项目采用此模式。 B2B2C举例电商平台 京东：商家：消费者 项目功能模块 b2c模式  系统后台：(管理员使用)  讲师管理模块  课程分类管理模块  课程管理模块 视频  统计分析模块  订">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210422123452.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210422160035.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210422160348.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210422161155.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210422164854.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210423161041.jpg">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210423163603.jpg">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210425154308.jpg">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210428083606.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210428084107.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210428084944.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210428093816.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210508083339.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210508084246.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210508093531.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210510150354.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210512083008.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210512083104.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210512084224.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210512090125.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210512095144.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210512095115.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210512095241.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210513160821.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210513161224.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210513171635.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210513172053.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210513172841.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210513173140.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210517145854.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210517150224.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210517150617.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210517150707.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210602000857.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210602001002.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210602002753.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210602002833.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210602003436.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210602003806.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210602004207.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210607150238.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210607151417.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210627214048.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210627214302.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210627214334.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211030232302.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211030233235.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211101172058.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211101172010.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211101173220.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211103143616.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211103144645.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211103144807.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211103145848.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211103163345.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211103163818.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211103164932.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211103165134.png">
<meta property="og:image" content="c:/Users/yinwu/AppData/Roaming/Typora/typora-user-images/image-20211104150550276.png">
<meta property="og:image" content="c:/Users/yinwu/AppData/Roaming/Typora/typora-user-images/image-20211104151234053.png">
<meta property="og:image" content="c:/Users/yinwu/AppData/Roaming/Typora/typora-user-images/image-20211104151339393.png">
<meta property="og:image" content="c:/Users/yinwu/AppData/Roaming/Typora/typora-user-images/image-20211104151432726.png">
<meta property="article:published_time" content="2021-07-01T04:12:32.000Z">
<meta property="article:modified_time" content="2023-07-17T03:24:10.067Z">
<meta property="article:author" content="Rayucan">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210422123452.png"></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="Rayucan"><img width="96" loading="lazy" src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210515231431.jpg" alt="Rayucan"></a><div class="site-author-name"><a href="/about/">Rayucan</a></div><a class="site-name" href="/about/site.html">Rayの云端小屋</a><sub class="site-subtitle"></sub><div class="site-desciption">Gaze into abyss.</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="Home"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">52</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">2</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">16</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/Rayucan" title="GitHub" target="_blank" style="color:#181717"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&amp;uin=775972516&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:775972516@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a></div></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-1"><span class="toc-number">1.</span> <span class="toc-text">Day 1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%95%86%E4%B8%9A%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.1.</span> <span class="toc-text">商业模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#B2C"><span class="toc-number">1.1.1.</span> <span class="toc-text">B2C</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#B2B2C"><span class="toc-number">1.1.2.</span> <span class="toc-text">B2B2C</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97"><span class="toc-number">1.2.</span> <span class="toc-text">项目功能模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%8A%80%E6%9C%AF%E7%82%B9"><span class="toc-number">1.3.</span> <span class="toc-text">项目技术点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mp%E4%BB%A3%E7%A0%81%E6%B5%81%E7%A8%8B"><span class="toc-number">1.4.</span> <span class="toc-text">mp代码流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mp%E5%AE%9E%E7%8E%B0%E6%B7%BB%E5%8A%A0%E6%93%8D%E4%BD%9C"><span class="toc-number">1.5.</span> <span class="toc-text">mp实现添加操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E7%94%9F%E6%88%90%E7%AD%96%E7%95%A5"><span class="toc-number">1.6.</span> <span class="toc-text">主键生成策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mp%E5%AE%9E%E7%8E%B0%E4%BF%AE%E6%94%B9%E6%93%8D%E4%BD%9C"><span class="toc-number">1.7.</span> <span class="toc-text">mp实现修改操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mp%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85"><span class="toc-number">1.8.</span> <span class="toc-text">mp实现自动填充</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%90%E8%A7%82%E9%94%81"><span class="toc-number">1.9.</span> <span class="toc-text">乐观锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mp%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.10.</span> <span class="toc-text">mp实现简单查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mp%E5%AE%9E%E7%8E%B0%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.11.</span> <span class="toc-text">mp实现分页查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mp%E5%AE%9E%E7%8E%B0%E9%80%BB%E8%BE%91%E5%88%A0%E9%99%A4"><span class="toc-number">1.12.</span> <span class="toc-text">mp实现逻辑删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mp%E5%AE%9E%E7%8E%B0%E5%A4%8D%E6%9D%82%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.13.</span> <span class="toc-text">mp实现复杂条件查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-2"><span class="toc-number">2.</span> <span class="toc-text">Day 2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BC%80%E5%8F%91"><span class="toc-number">2.1.</span> <span class="toc-text">前后端分离开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">2.2.</span> <span class="toc-text">项目准备工作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8"><span class="toc-number">2.3.</span> <span class="toc-text">代码生成器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%B2%E5%B8%88%E5%88%97%E8%A1%A8%E6%8E%A5%E5%8F%A3"><span class="toc-number">2.4.</span> <span class="toc-text">讲师列表接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%B2%E5%B8%88%E9%80%BB%E8%BE%91%E5%88%A0%E9%99%A4%E6%8E%A5%E5%8F%A3"><span class="toc-number">2.5.</span> <span class="toc-text">讲师逻辑删除接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#swagger%E6%95%B4%E5%90%88"><span class="toc-number">2.6.</span> <span class="toc-text">swagger整合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E4%B8%80%E7%BB%93%E6%9E%9C%E8%BF%94%E5%9B%9E"><span class="toc-number">2.7.</span> <span class="toc-text">统一结果返回</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%B2%E5%B8%88%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%92%8C%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.8.</span> <span class="toc-text">讲师分页查询和条件查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%B2%E5%B8%88%E6%B7%BB%E5%8A%A0%E5%8A%9F%E8%83%BD"><span class="toc-number">2.9.</span> <span class="toc-text">讲师添加功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%B2%E5%B8%88%E4%BF%AE%E6%94%B9%E5%8A%9F%E8%83%BD"><span class="toc-number">2.10.</span> <span class="toc-text">讲师修改功能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-3"><span class="toc-number">3.</span> <span class="toc-text">Day 3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">3.1.</span> <span class="toc-text">统一异常处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E4%B8%80%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86"><span class="toc-number">3.2.</span> <span class="toc-text">统一日志处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#es6%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.3.</span> <span class="toc-text">es6介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vue%E5%85%A5%E9%97%A8"><span class="toc-number">3.4.</span> <span class="toc-text">vue入门</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-4"><span class="toc-number">4.</span> <span class="toc-text">Day 4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#axios"><span class="toc-number">4.1.</span> <span class="toc-text">axios</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nodejs"><span class="toc-number">4.2.</span> <span class="toc-text">nodejs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#npm"><span class="toc-number">4.3.</span> <span class="toc-text">npm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#babel"><span class="toc-number">4.4.</span> <span class="toc-text">babel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="toc-number">4.5.</span> <span class="toc-text">模块化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack"><span class="toc-number">4.6.</span> <span class="toc-text">webpack</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%93%E5%8C%85css"><span class="toc-number">4.6.1.</span> <span class="toc-text">打包css</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E7%8E%AF%E5%A2%83"><span class="toc-number">4.7.</span> <span class="toc-text">搭建前端页面环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E7%8E%AF%E5%A2%83%E8%AF%B4%E6%98%8E"><span class="toc-number">4.8.</span> <span class="toc-text">前端页面环境说明</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-5"><span class="toc-number">5.</span> <span class="toc-text">Day 5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B9%E9%80%A0%E7%99%BB%E5%BD%95%E5%88%B0%E6%9C%AC%E5%9C%B0%E6%8E%A5%E5%8F%A3"><span class="toc-number">5.1.</span> <span class="toc-text">改造登录到本地接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B%E4%BB%8B%E7%BB%8D"><span class="toc-number">5.2.</span> <span class="toc-text">前端框架开发过程介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%B2%E5%B8%88%E5%88%97%E8%A1%A8%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91"><span class="toc-number">5.3.</span> <span class="toc-text">讲师列表前端开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%B2%E5%B8%88%E5%88%A0%E9%99%A4%E5%8A%9F%E8%83%BD%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.4.</span> <span class="toc-text">讲师删除功能前端实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%B2%E5%B8%88%E6%B7%BB%E5%8A%A0%E5%8A%9F%E8%83%BD%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.5.</span> <span class="toc-text">讲师添加功能前端实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%B2%E5%B8%88%E4%BF%AE%E6%94%B9%E5%8A%9F%E8%83%BD-1"><span class="toc-number">5.6.</span> <span class="toc-text">讲师修改功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E4%BF%AE%E6%94%B9%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.6.1.</span> <span class="toc-text">最终修改实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%88%87%E6%8D%A2%E9%97%AE%E9%A2%98"><span class="toc-number">5.7.</span> <span class="toc-text">路由切换问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-6"><span class="toc-number">6.</span> <span class="toc-text">Day 6</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91oss"><span class="toc-number">6.1.</span> <span class="toc-text">阿里云oss</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E5%87%86%E5%A4%87"><span class="toc-number">6.1.1.</span> <span class="toc-text">开发准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E9%A1%B9%E7%9B%AE%E7%8E%AF%E5%A2%83"><span class="toc-number">6.1.2.</span> <span class="toc-text">搭建项目环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.1.3.</span> <span class="toc-text">上传文件接口实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E6%8E%A5%E5%8F%A3%E5%AE%8C%E5%96%84"><span class="toc-number">6.1.4.</span> <span class="toc-text">上传文件接口完善</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx"><span class="toc-number">6.2.</span> <span class="toc-text">Nginx</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%AF%B7%E6%B1%82%E8%BD%AC%E5%8F%91%EF%BC%9F"><span class="toc-number">6.2.1.</span> <span class="toc-text">什么是请求转发？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%EF%BC%9F"><span class="toc-number">6.2.2.</span> <span class="toc-text">什么是负载均衡？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEnginx%EF%BC%8C%E5%AE%9E%E7%8E%B0%E8%AF%B7%E6%B1%82%E8%BD%AC%E5%8F%91"><span class="toc-number">6.2.3.</span> <span class="toc-text">配置nginx，实现请求转发</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E5%A4%B4%E5%83%8F%E5%89%8D%E7%AB%AF%E6%95%B4%E5%90%88"><span class="toc-number">6.3.</span> <span class="toc-text">上传头像前端整合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%88%86%E7%B1%BB%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84"><span class="toc-number">6.4.</span> <span class="toc-text">课程分类存储结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EasyExcel%E8%AF%BB%E5%86%99%E6%93%8D%E4%BD%9C"><span class="toc-number">6.5.</span> <span class="toc-text">EasyExcel读写操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E6%93%8D%E4%BD%9C"><span class="toc-number">6.5.1.</span> <span class="toc-text">写操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E6%93%8D%E4%BD%9C"><span class="toc-number">6.5.2.</span> <span class="toc-text">读操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E6%93%8D%E4%BD%9C%E5%88%86%E7%B1%BB"><span class="toc-number">6.5.3.</span> <span class="toc-text">读操作分类</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-7"><span class="toc-number">7.</span> <span class="toc-text">Day 7</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%AF%BE%E7%A8%8B%E5%88%86%E7%B1%BB%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="toc-number">7.1.</span> <span class="toc-text">添加课程分类前端实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%88%86%E7%B1%BB%E5%88%97%E8%A1%A8-%E6%A0%91%E5%BD%A2%E6%98%BE%E7%A4%BA"><span class="toc-number">7.1.1.</span> <span class="toc-text">课程分类列表-树形显示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83%E6%B5%81%E7%A8%8B"><span class="toc-number">7.2.</span> <span class="toc-text">课程发布流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E7%9B%B8%E5%85%B3%E8%A1%A8%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">7.3.</span> <span class="toc-text">课程相关表的关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%AF%BE%E7%A8%8B%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF%E6%8E%A5%E5%8F%A3"><span class="toc-number">7.4.</span> <span class="toc-text">添加课程基本信息接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%AF%BE%E7%A8%8B%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF%E5%89%8D%E7%AB%AF"><span class="toc-number">7.5.</span> <span class="toc-text">添加课程基本信息前端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E7%BA%A7%E8%81%94%E5%8A%A8%E6%98%BE%E7%A4%BA"><span class="toc-number">7.6.</span> <span class="toc-text">二级联动显示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-8"><span class="toc-number">8.</span> <span class="toc-text">Day 8</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E5%90%88%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8"><span class="toc-number">8.1.</span> <span class="toc-text">整合文本编辑器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%A4%A7%E7%BA%B2%E5%88%97%E8%A1%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">8.2.</span> <span class="toc-text">课程大纲列表功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E4%BF%A1%E6%81%AF%E4%BF%AE%E6%94%B9%E5%8A%9F%E8%83%BD"><span class="toc-number">8.3.</span> <span class="toc-text">课程信息修改功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%88%E6%9E%9C"><span class="toc-number">8.3.1.</span> <span class="toc-text">效果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3"><span class="toc-number">8.3.2.</span> <span class="toc-text">后端接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF"><span class="toc-number">8.3.3.</span> <span class="toc-text">前端</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%A0%E8%8A%82%E6%B7%BB%E5%8A%A0-%E4%BF%AE%E6%94%B9-%E5%88%A0%E9%99%A4"><span class="toc-number">8.4.</span> <span class="toc-text">章节添加 修改 删除</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0"><span class="toc-number">8.4.1.</span> <span class="toc-text">添加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4"><span class="toc-number">8.4.2.</span> <span class="toc-text">删除</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E4%BF%A1%E6%81%AF%E7%A1%AE%E8%AE%A4"><span class="toc-number">8.5.</span> <span class="toc-text">课程信息确认</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%A5%E9%94%99"><span class="toc-number">8.5.1.</span> <span class="toc-text">报错</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-9"><span class="toc-number">9.</span> <span class="toc-text">Day 9</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%88%97%E8%A1%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">9.1.</span> <span class="toc-text">课程列表功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%88%A0%E9%99%A4"><span class="toc-number">9.2.</span> <span class="toc-text">课程删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E8%A7%86%E9%A2%91%E7%82%B9%E6%92%AD"><span class="toc-number">9.3.</span> <span class="toc-text">阿里云视频点播</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SDK-%E8%8E%B7%E5%8F%96%E8%A7%86%E9%A2%91%E5%9C%B0%E5%9D%80%E5%92%8C%E5%87%AD%E8%AF%81"><span class="toc-number">9.3.1.</span> <span class="toc-text">SDK 获取视频地址和凭证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SDK-%E4%B8%8A%E4%BC%A0%E8%A7%86%E9%A2%91"><span class="toc-number">9.3.2.</span> <span class="toc-text">SDK 上传视频</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-10"><span class="toc-number">10.</span> <span class="toc-text">Day 10</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%B0%8F%E8%8A%82%E5%88%A0%E9%99%A4%E8%A7%86%E9%A2%91"><span class="toc-number">10.1.</span> <span class="toc-text">添加小节删除视频</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%8ESpringCloud"><span class="toc-number">10.2.</span> <span class="toc-text">微服务与SpringCloud</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-number">10.2.1.</span> <span class="toc-text">微服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SpringCloud"><span class="toc-number">10.2.2.</span> <span class="toc-text">SpringCloud</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nacos"><span class="toc-number">10.3.</span> <span class="toc-text">Nacos</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Nacos%E6%B5%81%E7%A8%8B"><span class="toc-number">10.3.1.</span> <span class="toc-text">Nacos流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nacos%E6%B3%A8%E5%86%8C%E8%BF%87%E7%A8%8B"><span class="toc-number">10.3.2.</span> <span class="toc-text">Nacos注册过程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenFeign"><span class="toc-number">10.4.</span> <span class="toc-text">OpenFeign</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B"><span class="toc-number">10.4.1.</span> <span class="toc-text">服务调用实现过程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%AF%BE%E7%A8%8B%E5%88%A0%E9%99%A4%E8%A7%86%E9%A2%91"><span class="toc-number">10.5.</span> <span class="toc-text">删除课程删除视频</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringCloud%E8%B0%83%E7%94%A8%E6%8E%A5%E5%8F%A3%E8%BF%87%E7%A8%8B"><span class="toc-number">10.6.</span> <span class="toc-text">SpringCloud调用接口过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringCloud%E7%86%94%E6%96%AD%E5%99%A8"><span class="toc-number">10.7.</span> <span class="toc-text">SpringCloud熔断器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-11"><span class="toc-number">11.</span> <span class="toc-text">Day 11</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%89%8D%E5%8F%B0%E7%8E%AF%E5%A2%83"><span class="toc-number">11.1.</span> <span class="toc-text">搭建项目前台环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NUXT%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">11.2.</span> <span class="toc-text">NUXT目录结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NUXT%E9%A1%B5%E9%9D%A2%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B"><span class="toc-number">11.3.</span> <span class="toc-text">NUXT页面加载过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E9%A6%96%E9%A1%B5%E6%95%B0%E6%8D%AEbanner"><span class="toc-number">11.4.</span> <span class="toc-text">后端首页数据banner</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E7%83%AD%E9%97%A8%E8%AF%BE%E7%A8%8B%E5%92%8C%E5%90%8D%E5%B8%88%E6%8E%A5%E5%8F%A3"><span class="toc-number">11.5.</span> <span class="toc-text">首页热门课程和名师接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E6%95%B0%E6%8D%AE%E6%98%BE%E7%A4%BA-%E5%89%8D%E7%AB%AF"><span class="toc-number">11.6.</span> <span class="toc-text">首页数据显示(前端)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis"><span class="toc-number">11.7.</span> <span class="toc-text">Redis</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-12"><span class="toc-number">12.</span> <span class="toc-text">Day 12</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">12.1.</span> <span class="toc-text">单点登录三种方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E4%B8%80%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">12.1.1.</span> <span class="toc-text">单一服务器模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E6%A8%A1%E5%BC%8F"><span class="toc-number">12.1.2.</span> <span class="toc-text">集群部署模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JWT"><span class="toc-number">12.2.</span> <span class="toc-text">JWT</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8"><span class="toc-number">12.2.1.</span> <span class="toc-text">如何使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1%E6%9C%8D%E5%8A%A1"><span class="toc-number">12.3.</span> <span class="toc-text">阿里云短信服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81%E6%9C%8D%E5%8A%A1"><span class="toc-number">12.4.</span> <span class="toc-text">邮件发送服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E6%8E%A5%E5%8F%A3"><span class="toc-number">12.5.</span> <span class="toc-text">登录接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E6%8E%A5%E5%8F%A3"><span class="toc-number">12.6.</span> <span class="toc-text">注册接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E4%B8%8E%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%E5%89%8D%E7%AB%AF%E6%95%B4%E5%90%88"><span class="toc-number">12.7.</span> <span class="toc-text">注册与登录页面前端整合</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-13"><span class="toc-number">13.</span> <span class="toc-text">Day 13</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%89%8D%E7%AB%AF%E6%95%B4%E5%90%88"><span class="toc-number">13.1.</span> <span class="toc-text">登录前端整合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OAuth2"><span class="toc-number">13.2.</span> <span class="toc-text">OAuth2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1%E6%89%AB%E6%8F%8F%E7%99%BB%E5%BD%95"><span class="toc-number">13.3.</span> <span class="toc-text">微信扫描登录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%AB%E6%8F%8F%E4%B9%8B%E5%90%8E%E8%8E%B7%E5%8F%96%E6%89%AB%E6%8F%8F%E4%BA%BA%E4%BF%A1%E6%81%AF"><span class="toc-number">13.3.1.</span> <span class="toc-text">扫描之后获取扫描人信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E6%98%BE%E7%A4%BA%E6%95%B0%E6%8D%AE"><span class="toc-number">13.3.2.</span> <span class="toc-text">首页显示数据</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-14"><span class="toc-number">14.</span> <span class="toc-text">Day 14</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8D%E5%B8%88%E5%88%97%E8%A1%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">14.1.</span> <span class="toc-text">名师列表功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%B2%E5%B8%88%E8%AF%A6%E6%83%85%E5%8A%9F%E8%83%BD"><span class="toc-number">14.2.</span> <span class="toc-text">讲师详情功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%88%97%E8%A1%A8%E5%8A%9F%E8%83%BD-1"><span class="toc-number">14.3.</span> <span class="toc-text">课程列表功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2%E5%B8%A6%E5%88%86%E9%A1%B5%E5%8A%9F%E8%83%BD"><span class="toc-number">14.3.1.</span> <span class="toc-text">条件查询带分页功能</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E8%AF%A6%E6%83%85%E5%8A%9F%E8%83%BD"><span class="toc-number">14.4.</span> <span class="toc-text">课程详情功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E5%90%88%E9%98%BF%E9%87%8C%E4%BA%91%E6%92%AD%E6%94%BE%E5%99%A8"><span class="toc-number">14.5.</span> <span class="toc-text">整合阿里云播放器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day15"><span class="toc-number">15.</span> <span class="toc-text">Day15</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E8%AF%84%E8%AE%BA%E5%8A%9F%E8%83%BD"><span class="toc-number">15.1.</span> <span class="toc-text">课程评论功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B"><span class="toc-number">15.1.1.</span> <span class="toc-text">具体实现过程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E6%94%AF%E4%BB%98%E5%8A%9F%E8%83%BD"><span class="toc-number">15.2.</span> <span class="toc-text">课程支付功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">15.2.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%AF%E4%BB%98%E7%9B%B8%E5%85%B3%E6%8E%A5%E5%8F%A3%E6%B1%87%E6%80%BB"><span class="toc-number">15.2.2.</span> <span class="toc-text">支付相关接口汇总</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E8%AE%A2%E5%8D%95%E6%8E%A5%E5%8F%A3"><span class="toc-number">15.2.3.</span> <span class="toc-text">生成订单接口</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8-Nacos"><span class="toc-number">15.2.3.1.</span> <span class="toc-text">远程调用-Nacos</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E8%AE%A2%E5%8D%95-id-%E6%9F%A5%E8%AF%A2%E8%AE%A2%E5%8D%95%E4%BF%A1%E6%81%AF"><span class="toc-number">15.2.4.</span> <span class="toc-text">根据订单 id 查询订单信息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E4%BA%8C%E7%BB%B4%E7%A0%81%E7%94%9F%E6%88%90%E6%8E%A5%E5%8F%A3"><span class="toc-number">15.3.</span> <span class="toc-text">微信支付二维码生成接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-16"><span class="toc-number">16.</span> <span class="toc-text">Day 16</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%AF%E4%BB%98%E5%90%8E%E6%B5%81%E7%A8%8B"><span class="toc-number">16.1.</span> <span class="toc-text">支付后流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90%E6%A8%A1%E5%9D%97"><span class="toc-number">16.2.</span> <span class="toc-text">统计分析模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">16.2.1.</span> <span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E6%9F%90%E4%B8%80%E5%A4%A9%E6%B3%A8%E5%86%8C%E4%BA%BA%E6%95%B0"><span class="toc-number">16.2.2.</span> <span class="toc-text">统计某一天注册人数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B"><span class="toc-number">16.2.3.</span> <span class="toc-text">最终实现过程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">16.3.</span> <span class="toc-text">定时任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-17"><span class="toc-number">17.</span> <span class="toc-text">Day 17</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#canal-%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E5%B7%A5%E5%85%B7"><span class="toc-number">17.1.</span> <span class="toc-text">canal 数据同步工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">17.1.1.</span> <span class="toc-text">应用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#canal-%E5%90%8C%E6%AD%A5%E8%BF%87%E7%A8%8B"><span class="toc-number">17.1.2.</span> <span class="toc-text">canal 同步过程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9-linux-%E7%B3%BB%E7%BB%9F-MySQL-%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE"><span class="toc-number">17.1.2.1.</span> <span class="toc-text">修改 linux 系统 MySQL 数据库配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-canal-%E5%B7%A5%E5%85%B7"><span class="toc-number">17.1.2.2.</span> <span class="toc-text">安装 canal 工具</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#canal-%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99"><span class="toc-number">17.1.3.</span> <span class="toc-text">canal 代码编写</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gateway-%E7%BD%91%E5%85%B3"><span class="toc-number">17.2.</span> <span class="toc-text">Gateway 网关</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%BD%91%E5%85%B3"><span class="toc-number">17.2.1.</span> <span class="toc-text">什么是网关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Gateway"><span class="toc-number">17.2.2.</span> <span class="toc-text">Gateway</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Gateway-%E5%85%B7%E4%BD%93%E4%BD%BF%E7%94%A8"><span class="toc-number">17.2.3.</span> <span class="toc-text">Gateway 具体使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Gateway-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">17.2.4.</span> <span class="toc-text">Gateway 负载均衡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97"><span class="toc-number">17.3.</span> <span class="toc-text">权限管理模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E9%9C%80%E6%B1%82"><span class="toc-number">17.3.1.</span> <span class="toc-text">权限管理需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3%E6%95%B4%E5%90%88"><span class="toc-number">17.3.2.</span> <span class="toc-text">后端接口整合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%92%E5%BD%92%E6%9F%A5%E8%AF%A2%E8%8F%9C%E5%8D%95"><span class="toc-number">17.3.3.</span> <span class="toc-text">递归查询菜单</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%92%E5%BD%92%E5%88%A0%E9%99%A4%E8%8F%9C%E5%8D%95"><span class="toc-number">17.3.4.</span> <span class="toc-text">递归删除菜单</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%92%E8%89%B2%E5%88%86%E9%85%8D%E8%8F%9C%E5%8D%95"><span class="toc-number">17.3.5.</span> <span class="toc-text">角色分配菜单</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-18"><span class="toc-number">18.</span> <span class="toc-text">Day 18</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Security"><span class="toc-number">18.1.</span> <span class="toc-text">Spring Security</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E4%BB%8B%E7%BB%8D"><span class="toc-number">18.1.1.</span> <span class="toc-text">框架介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%88%E6%9D%83%E8%BF%87%E7%A8%8B"><span class="toc-number">18.1.2.</span> <span class="toc-text">授权过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B"><span class="toc-number">18.1.3.</span> <span class="toc-text">代码执行过程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nacos-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83"><span class="toc-number">18.2.</span> <span class="toc-text">Nacos 配置中心</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">18.2.1.</span> <span class="toc-text">配置中心的作用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Boot-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">18.3.</span> <span class="toc-text">Spring Boot 配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%8A%A0%E8%BD%BD%E9%A1%BA%E5%BA%8F"><span class="toc-number">18.3.1.</span> <span class="toc-text">配置文件的加载顺序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-19"><span class="toc-number">19.</span> <span class="toc-text">Day 19</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-20-%E6%80%BB%E7%BB%93"><span class="toc-number">20.</span> <span class="toc-text">Day 20 总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%8F%8F%E8%BF%B0"><span class="toc-number">20.1.</span> <span class="toc-text">项目描述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E9%A1%B9%E7%9B%AE%E6%80%BB%E4%BD%93%E4%BB%8B%E7%BB%8D"><span class="toc-number">20.1.1.</span> <span class="toc-text">对项目总体介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97-1"><span class="toc-number">20.1.2.</span> <span class="toc-text">项目功能模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF"><span class="toc-number">20.1.3.</span> <span class="toc-text">项目涉及技术</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E9%A1%B9%E7%9B%AE%E5%8A%9F%E8%83%BD"><span class="toc-number">20.2.</span> <span class="toc-text">总结项目功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%86%E5%A4%87"><span class="toc-number">20.2.1.</span> <span class="toc-text">准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%8A%9F%E8%83%BD"><span class="toc-number">20.2.2.</span> <span class="toc-text">项目后台管理系统功能</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="toc-number">20.2.2.1.</span> <span class="toc-text">登录功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97-1"><span class="toc-number">20.2.2.2.</span> <span class="toc-text">权限管理模块</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%B2%E5%B8%88%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97"><span class="toc-number">20.2.2.3.</span> <span class="toc-text">讲师管理模块</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9D%97"><span class="toc-number">20.2.2.4.</span> <span class="toc-text">课程分类模块</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97"><span class="toc-number">20.2.2.5.</span> <span class="toc-text">课程管理模块</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90%E6%A8%A1%E5%9D%97-1"><span class="toc-number">20.2.2.6.</span> <span class="toc-text">统计分析模块</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%89%8D%E5%8F%B0%E7%94%A8%E6%88%B7%E7%B3%BB%E7%BB%9F%E5%8A%9F%E8%83%BD"><span class="toc-number">20.2.3.</span> <span class="toc-text">项目前台用户系统功能</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E6%95%B0%E6%8D%AE%E6%98%BE%E7%A4%BA"><span class="toc-number">20.2.3.1.</span> <span class="toc-text">首页数据显示</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%83%BD"><span class="toc-number">20.2.3.2.</span> <span class="toc-text">注册功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD-1"><span class="toc-number">20.2.3.3.</span> <span class="toc-text">登录功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%8D%E5%B8%88%E5%88%97%E8%A1%A8%E5%8A%9F%E8%83%BD-1"><span class="toc-number">20.2.3.4.</span> <span class="toc-text">名师列表功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%8D%E5%B8%88%E8%AF%A6%E6%83%85%E5%8A%9F%E8%83%BD"><span class="toc-number">20.2.3.5.</span> <span class="toc-text">名师详情功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%88%97%E8%A1%A8%E5%8A%9F%E8%83%BD-2"><span class="toc-number">20.2.3.6.</span> <span class="toc-text">课程列表功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E8%AF%A6%E6%83%85%E9%A1%B5"><span class="toc-number">20.2.3.7.</span> <span class="toc-text">课程详情页</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E8%A7%86%E9%A2%91%E5%9C%A8%E7%BA%BF%E6%92%AD%E6%94%BE"><span class="toc-number">20.2.3.8.</span> <span class="toc-text">课程视频在线播放</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E6%94%AF%E4%BB%98%E5%8A%9F%E8%83%BD%EF%BC%88%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%EF%BC%89"><span class="toc-number">20.2.3.9.</span> <span class="toc-text">课程支付功能（微信支付）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E9%A1%B9%E7%9B%AE%E6%8A%80%E6%9C%AF%E7%82%B9%EF%BC%88%E5%89%8D%E7%AB%AF%EF%BC%89"><span class="toc-number">20.3.</span> <span class="toc-text">总结项目技术点（前端）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#vue"><span class="toc-number">20.3.1.</span> <span class="toc-text">vue</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Element-ui"><span class="toc-number">20.3.2.</span> <span class="toc-text">Element-ui</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nodejs-1"><span class="toc-number">20.3.3.</span> <span class="toc-text">nodejs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NPM"><span class="toc-number">20.3.4.</span> <span class="toc-text">NPM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Babel"><span class="toc-number">20.3.5.</span> <span class="toc-text">Babel</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="toc-number">20.3.6.</span> <span class="toc-text">前端模块化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F"><span class="toc-number">20.3.7.</span> <span class="toc-text">后台系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E5%8F%B0%E7%B3%BB%E7%BB%9F"><span class="toc-number">20.3.8.</span> <span class="toc-text">前台系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Echarts"><span class="toc-number">20.3.9.</span> <span class="toc-text">Echarts</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E9%A1%B9%E7%9B%AE%E6%8A%80%E6%9C%AF%E7%82%B9%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89"><span class="toc-number">20.4.</span> <span class="toc-text">总结项目技术点（后端）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SpringBoot"><span class="toc-number">20.4.1.</span> <span class="toc-text">SpringBoot</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SpringCloud-1"><span class="toc-number">20.4.2.</span> <span class="toc-text">SpringCloud</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MyBatisPlus"><span class="toc-number">20.4.3.</span> <span class="toc-text">MyBatisPlus</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#EasyExcel"><span class="toc-number">20.4.4.</span> <span class="toc-text">EasyExcel</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SpringSecurity"><span class="toc-number">20.4.5.</span> <span class="toc-text">SpringSecurity</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis-1"><span class="toc-number">20.4.6.</span> <span class="toc-text">Redis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nginx-1"><span class="toc-number">20.4.7.</span> <span class="toc-text">Nginx</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OAuth2-JWT"><span class="toc-number">20.4.8.</span> <span class="toc-text">OAuth2 + JWT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HttpClient"><span class="toc-number">20.4.9.</span> <span class="toc-text">HttpClient</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cookie"><span class="toc-number">20.4.10.</span> <span class="toc-text">Cookie</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98"><span class="toc-number">20.4.11.</span> <span class="toc-text">微信支付</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91-OSS"><span class="toc-number">20.4.12.</span> <span class="toc-text">阿里云 OSS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E8%A7%86%E9%A2%91%E7%82%B9%E6%92%AD-1"><span class="toc-number">20.4.13.</span> <span class="toc-text">阿里云视频点播</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1%E6%9C%8D%E5%8A%A1-1"><span class="toc-number">20.4.14.</span> <span class="toc-text">阿里云短信服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Git"><span class="toc-number">20.4.15.</span> <span class="toc-text">Git</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker-Jenkins"><span class="toc-number">20.4.16.</span> <span class="toc-text">Docker + Jenkins</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E9%A1%B9%E7%9B%AE%E9%97%AE%E9%A2%98"><span class="toc-number">20.5.</span> <span class="toc-text">总结项目问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%EF%BC%9A%E8%B7%AF%E7%94%B1%E5%88%87%E6%8D%A2%E9%97%AE%E9%A2%98"><span class="toc-number">20.5.1.</span> <span class="toc-text">前端：路由切换问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%EF%BC%9AES6-%E6%A8%A1%E5%9D%97%E5%8C%96%E8%BF%90%E8%A1%8C%E9%97%AE%E9%A2%98"><span class="toc-number">20.5.2.</span> <span class="toc-text">前端：ES6 模块化运行问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MyBatisPlus-%E7%94%9F%E6%88%9019%E4%BD%8D-id-%E5%80%BC%E9%97%AE%E9%A2%98"><span class="toc-number">20.5.3.</span> <span class="toc-text">MyBatisPlus 生成19位 id 值问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="toc-number">20.5.4.</span> <span class="toc-text">跨域问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#413-%E9%97%AE%E9%A2%98"><span class="toc-number">20.5.5.</span> <span class="toc-text">413 问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Maven-%E5%8A%A0%E8%BD%BD%E9%97%AE%E9%A2%98"><span class="toc-number">20.5.6.</span> <span class="toc-text">Maven 加载问题</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://example.com/2021/07/01/Cloud-Learning/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Rayucan"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Rayの云端小屋"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">云课项目</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="Created: 2021-07-01 12:12:32" itemprop="dateCreated datePublished" datetime="2021-07-01T12:12:32+08:00">2021-07-01</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="Modified: 2023-07-17 11:24:10" itemprop="dateModified" datetime="2023-07-17T11:24:10+08:00">2023-07-17</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E7%AC%94%E8%AE%B0/" style="--text-color:dimgray" itemprop="url" rel="index"><span itemprop="text">笔记</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/Java/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">Java</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><h2 id="Day-1"><a href="#Day-1" class="headerlink" title="Day 1"></a>Day 1</h2><ol>
<li>项目背景</li>
<li>项目采用的商业模式</li>
<li>项目实现的功能模块</li>
<li>项目使用的技术</li>
<li>学习技术 MyBatis-Plus</li>
</ol>
<h3 id="商业模式"><a href="#商业模式" class="headerlink" title="商业模式"></a>商业模式</h3><h4 id="B2C"><a href="#B2C" class="headerlink" title="B2C"></a>B2C</h4><blockquote>
<p>两个角色：<strong>管理员</strong>和<strong>普通用户</strong></p>
</blockquote>
<p>管理员：添加 修改 删除</p>
<p>普通用户：查询</p>
<p><u><strong>本项目采用此模式。</strong></u></p>
<h4 id="B2B2C"><a href="#B2B2C" class="headerlink" title="B2B2C"></a>B2B2C</h4><p>举例电商平台</p>
<p>京东：商家：消费者</p>
<h3 id="项目功能模块"><a href="#项目功能模块" class="headerlink" title="项目功能模块"></a>项目功能模块</h3><blockquote>
<p>b2c模式</p>
</blockquote>
<p>系统后台：(管理员使用)</p>
<ol>
<li><p>讲师管理模块</p>
</li>
<li><p>课程分类管理模块</p>
</li>
<li><p>课程管理模块</p>
<p>视频</p>
</li>
<li><p>统计分析模块</p>
</li>
<li><p>订单管理</p>
</li>
<li><p>banner管理</p>
</li>
<li><p>权限管理</p>
</li>
</ol>
<p>系统前台：(普通用户使用)</p>
<ol>
<li><p>首页数据显示</p>
</li>
<li><p>讲师列表和详情</p>
</li>
<li><p>课程列表和课程详情</p>
<p>视频在线播放</p>
</li>
<li><p>注册和登录功能</p>
</li>
<li><p>微信扫描登录</p>
</li>
<li><p>微信扫描支付</p>
</li>
</ol>
<h3 id="项目技术点"><a href="#项目技术点" class="headerlink" title="项目技术点"></a>项目技术点</h3><blockquote>
<p>采用前后端分离开发</p>
</blockquote>
<p>后端技术</p>
<ul>
<li>springboot</li>
<li>springcloud</li>
<li>mybatis-plus</li>
<li>spring security</li>
<li>redis</li>
<li>maven</li>
<li>easyExcel</li>
<li>jwt</li>
<li>OAuth2</li>
</ul>
<p>前端技术</p>
<ul>
<li>vue</li>
<li>element-ui</li>
<li>axios</li>
<li>nodejs</li>
<li>…</li>
</ul>
<p>其他技术</p>
<ul>
<li>阿里云oss</li>
<li>阿里云视频点播服务</li>
<li>阿里云短信服务</li>
<li>微信支付和登录</li>
<li>docker</li>
<li>jenkins</li>
<li>git</li>
</ul>
<h3 id="mp代码流程"><a href="#mp代码流程" class="headerlink" title="mp代码流程"></a>mp代码流程</h3><blockquote>
<p>mp入门：对mybatis增强，简化开发</p>
</blockquote>
<ol>
<li><p>创建数据库，创建表，添加数据</p>
</li>
<li><p>创建springboot工程</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210422123452.png" alt="image-20210422123452040" loading="lazy"></p>
</li>
<li><p>引入相关依赖</p>
<p>springboot和mp依赖</p>
<pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">></span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.4.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/></span></span> <span class="token comment">&lt;!-- lookup parent from repository --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.atguigu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mpdemo1010<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>mpdemo1010<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">></span></span>Demo project for Spring Boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.junit.vintage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>junit-vintage-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.0.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!--mysql--></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!--lombok用来简化实体类--></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.3.5.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">></span></span></code></pre></li>
<li><p>安装lombok插件(IDEA自带)</p>
</li>
<li><p>application.properties</p>
<pre class="language-properties" data-language="properties"><code class="language-properties"><span class="token comment">#mysql数据库连接,serverTimezone=GMT%2B8指北京时间东八区</span>
<span class="token attr-name">spring.datasource.driver-class-name</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.cj.jdbc.Driver</span>
<span class="token attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://localhost:3306/mybatis_plus?serverTimezone=GMT%2B8</span>
<span class="token attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token attr-value">root</span>
<span class="token attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token attr-value">root</span>

<span class="token comment">#mybatis日志</span>
<span class="token attr-name">mybatis-plus.configuration.log-impl</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.ibatis.logging.stdout.StdOutImpl</span>

<span class="token comment">#环境设置：dev、test、prod</span>
<span class="token attr-name">spring.profiles.active</span><span class="token punctuation">=</span><span class="token attr-value">dev</span></code></pre></li>
<li><p>编写代码</p>
</li>
</ol>
<h3 id="mp实现添加操作"><a href="#mp实现添加操作" class="headerlink" title="mp实现添加操作"></a>mp实现添加操作</h3><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"DDDDWWWW112"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span><span class="token string">"666@123.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> insert <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"insert:"</span> <span class="token operator">+</span> insert<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<ul>
<li><strong>不需要设置id值(主键)</strong></li>
<li>mp自动生成id值(19位)</li>
</ul>
<h3 id="主键生成策略"><a href="#主键生成策略" class="headerlink" title="主键生成策略"></a>主键生成策略</h3><ul>
<li><p>自动增长 AUTO INCREMENT</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210422160035.png" alt="image-20210422160028398" loading="lazy"></p>
</li>
<li><p>UUID 每次生成唯一的随机值</p>
<p>排序不方便</p>
</li>
<li><p>redis实现</p>
</li>
<li><p>mp自带策略_snowflake雪花算法</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span></code></pre>

<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210422160348.png" alt="image-20210422160348627" loading="lazy"></p>
<p>AUTO：自动增长</p>
<p>ID_WORKER / ID_WORKER_STR：mp自带策略，生成19位值，分别对应数字型 / 字符型</p>
<p>INPUT：设置id值</p>
<p>NONE：输入</p>
<p>UUID：随机唯一值</p>
</li>
</ul>
<h3 id="mp实现修改操作"><a href="#mp实现修改操作" class="headerlink" title="mp实现修改操作"></a>mp实现修改操作</h3><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> i <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"update:"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="mp实现自动填充"><a href="#mp实现自动填充" class="headerlink" title="mp实现自动填充"></a>mp实现自动填充</h3><ol>
<li><p>数据库表中添加两个字段</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210422161155.png" alt="image-20210422161155834" loading="lazy"></p>
</li>
<li><p>Java类中添加实体类属性</p>
</li>
</ol>
<blockquote>
<p>不需要set值到对象，使用mp的方式实现添加</p>
</blockquote>
<ol>
<li><p>在实体类里对自动填充属性添加注解</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//注意数据表create_time,update_time与下面命名特点</span>
<span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>fill <span class="token operator">=</span> <span class="token class-name">FieldFill</span><span class="token punctuation">.</span>INSERT<span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>

<span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>fill <span class="token operator">=</span> <span class="token class-name">FieldFill</span><span class="token punctuation">.</span>INSERT_UPDATE<span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span></code></pre></li>
<li><p>创建类，实现接口 MetaObjectHandler，并实现接口里的方法</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>mpdemo1010<span class="token punctuation">.</span>handler</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>handlers<span class="token punctuation">.</span></span><span class="token class-name">MetaObjectHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>reflection<span class="token punctuation">.</span></span><span class="token class-name">MetaObject</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMetaObjectHandler</span> <span class="token keyword">implements</span> <span class="token class-name">MetaObjectHandler</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertFill</span><span class="token punctuation">(</span><span class="token class-name">MetaObject</span> metaObject<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"createTime"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"updateTime"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"version"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"deleted"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateFill</span><span class="token punctuation">(</span><span class="token class-name">MetaObject</span> metaObject<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"updateTime"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ol>
<h3 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h3><ol>
<li><p>数据库表中添加字段versioin，作为乐观锁版本号</p>
</li>
<li><p>Java对应实体类添加版本号属性version,并添加注解<code>@Version</code></p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Version</span> <span class="token comment">//版本号注解</span>
<span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>fill <span class="token operator">=</span> <span class="token class-name">FieldFill</span><span class="token punctuation">.</span>INSERT<span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Integer</span> version<span class="token punctuation">;</span></code></pre></li>
<li><p>在Config配置类中，配置乐观锁插件</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//乐观锁插件</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">OptimisticLockerInterceptor</span> <span class="token function">optimisticLockerInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">OptimisticLockerInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>测试</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * 测试 乐观锁插件
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testOptimisticLocker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//查询</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span><span class="token number">1373611971844370433L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//修改数据</span>
    user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Helen Yao"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span><span class="token string">"helen@qq.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//执行更新</span>
    userMapper<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ol>
<h3 id="mp实现简单查询"><a href="#mp实现简单查询" class="headerlink" title="mp实现简单查询"></a>mp实现简单查询</h3><ol>
<li><p>根据id查询</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">User</span> user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span><span class="token number">1373611971844370433L</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li>
<li><p>多个id批量查询</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//多id批量查询</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">testSelectDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> users <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectBatchIds</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span><span class="token number">2L</span><span class="token punctuation">,</span><span class="token number">3L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ol>
<h3 id="mp实现分页查询"><a href="#mp实现分页查询" class="headerlink" title="mp实现分页查询"></a>mp实现分页查询</h3><ol>
<li><p>在Config配置类中，配置分页插件</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//分页插件</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">PaginationInterceptor</span> <span class="token function">paginationInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PaginationInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>编写分页代码</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//BaseMapper接口的selectPage方法</span>
<span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">selectPage</span><span class="token punctuation">(</span><span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> var1<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"ew"</span><span class="token punctuation">)</span> <span class="token class-name">Wrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> var2<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//创建Page对象，传入参数</span>
<span class="token comment">//参数1：当前页，参数2：每页显示的记录数</span>
<span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> page <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//调用mp的分页查询方法selectPage，把所有数据封装到page对象中</span>
userMapper<span class="token punctuation">.</span><span class="token function">selectPage</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//通过page对象获取分页数据</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">getCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li>
</ol>
<h3 id="mp实现逻辑删除"><a href="#mp实现逻辑删除" class="headerlink" title="mp实现逻辑删除"></a>mp实现逻辑删除</h3><ol>
<li><p>物理删除</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//BaseMapper接口的deleteById方法</span>
<span class="token keyword">int</span> <span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token class-name">Serializable</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li>
<li><p>批量删除</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//BaseMapper接口的deleteBatchIds方法</span>
<span class="token keyword">int</span> <span class="token function">deleteBatchIds</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"coll"</span><span class="token punctuation">)</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Serializable</span><span class="token punctuation">></span></span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li>
<li><p>逻辑删除</p>
<ul>
<li><p>数据库表中添加逻辑删除字段deleted</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210422164854.png" alt="image-20210422164854582" loading="lazy"></p>
</li>
<li><p>Java对应实体类中添加属性和注解</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@TableLogic</span> <span class="token comment">//逻辑删除注解</span>
<span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>fill <span class="token operator">=</span> <span class="token class-name">FieldFill</span><span class="token punctuation">.</span>INSERT<span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Integer</span> deleted<span class="token punctuation">;</span></code></pre></li>
<li><p>配置逻辑删除插件</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//逻辑删除插件</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ISqlInjector</span> <span class="token function">sqlInjector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LogicSqlInjector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>执行代码，deleted值最终变为1</p>
</li>
</ul>
</li>
</ol>
<h3 id="mp实现复杂条件查询"><a href="#mp实现复杂条件查询" class="headerlink" title="mp实现复杂条件查询"></a>mp实现复杂条件查询</h3><blockquote>
<p>使用QueryWrapper构建条件</p>
<p>创建QueryWrapper对象，调用其方法实现各种条件查询</p>
</blockquote>
<ul>
<li>ge &gt;=</li>
<li>gt &gt; </li>
<li>le &lt;= </li>
<li>lt &lt;</li>
<li>eq =</li>
<li>ne !=</li>
<li>like 模糊查询</li>
<li>orderByDesc / orderByAsc 排序</li>
<li>last 语句最后拼接sql语句</li>
<li>between 范围</li>
<li>select 指定列</li>
</ul>
<h2 id="Day-2"><a href="#Day-2" class="headerlink" title="Day 2"></a>Day 2</h2><ol>
<li><p>前后端分离开发概念</p>
</li>
<li><p>讲师管理模块(后端)</p>
<p>讲师CRUD操作</p>
</li>
</ol>
<h3 id="前后端分离开发"><a href="#前后端分离开发" class="headerlink" title="前后端分离开发"></a>前后端分离开发</h3><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210423161041.jpg" alt="未命名文件" loading="lazy"></p>
<h3 id="项目准备工作"><a href="#项目准备工作" class="headerlink" title="项目准备工作"></a>项目准备工作</h3><ol>
<li><p>创建数据库，创建讲师数据表 edu_teacher</p>
<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>edu_teacher<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'讲师ID'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'讲师姓名'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>intro<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'讲师简介'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>career<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'讲师资历,一句话说明讲师'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span><span class="token keyword">level</span><span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'头衔 1高级讲师 2首席讲师'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>avatar<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'讲师头像'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>sort<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'排序'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>is_deleted<span class="token punctuation">`</span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'逻辑删除 1（true）已删除， 0（false）未删除'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'更新时间'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span>uk_name<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'讲师'</span><span class="token punctuation">;</span></code></pre></li>
<li><p>创建项目结构</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210423163603.jpg" alt="项目结构" loading="lazy"></p>
</li>
</ol>
<h3 id="代码生成器"><a href="#代码生成器" class="headerlink" title="代码生成器"></a>代码生成器</h3><ol>
<li><p>创建application.properties配置文件</p>
</li>
<li><p>编写controller service mapper代码内容</p>
<p><strong>mp提供代码生成器，生成相关代码</strong></p>
</li>
</ol>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//CodeGenerator.java</span>
<span class="token comment">//根据实际需要自行更改配置</span>

<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">DbType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">IdType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>generator<span class="token punctuation">.</span></span><span class="token class-name">AutoGenerator</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>generator<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">DataSourceConfig</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>generator<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">GlobalConfig</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>generator<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">PackageConfig</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>generator<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">StrategyConfig</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>generator<span class="token punctuation">.</span>config<span class="token punctuation">.</span>rules<span class="token punctuation">.</span></span><span class="token class-name">DateType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>generator<span class="token punctuation">.</span>config<span class="token punctuation">.</span>rules<span class="token punctuation">.</span></span><span class="token class-name">NamingStrategy</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author
 * @since 2018/12/13
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CodeGenerator</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token comment">// 1、创建代码生成器</span>
        <span class="token class-name">AutoGenerator</span> mpg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AutoGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2、全局配置</span>
        <span class="token class-name">GlobalConfig</span> gc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GlobalConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> projectPath <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"user.dir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gc<span class="token punctuation">.</span><span class="token function">setOutputDir</span><span class="token punctuation">(</span>projectPath <span class="token operator">+</span> <span class="token string">"/src/main/java"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gc<span class="token punctuation">.</span><span class="token function">setAuthor</span><span class="token punctuation">(</span><span class="token string">"testjava"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gc<span class="token punctuation">.</span><span class="token function">setOpen</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//生成后是否打开资源管理器</span>
        gc<span class="token punctuation">.</span><span class="token function">setFileOverride</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//重新生成时文件是否覆盖</span>
        gc<span class="token punctuation">.</span><span class="token function">setServiceName</span><span class="token punctuation">(</span><span class="token string">"%sService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//去掉Service接口的首字母I</span>
        gc<span class="token punctuation">.</span><span class="token function">setIdType</span><span class="token punctuation">(</span><span class="token class-name">IdType</span><span class="token punctuation">.</span>ID_WORKER<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//主键策略</span>
        gc<span class="token punctuation">.</span><span class="token function">setDateType</span><span class="token punctuation">(</span><span class="token class-name">DateType</span><span class="token punctuation">.</span>ONLY_DATE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//定义生成的实体类中日期类型</span>
        gc<span class="token punctuation">.</span><span class="token function">setSwagger2</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//开启Swagger2模式</span>

        mpg<span class="token punctuation">.</span><span class="token function">setGlobalConfig</span><span class="token punctuation">(</span>gc<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3、数据源配置</span>
        <span class="token class-name">DataSourceConfig</span> dsc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dsc<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">"jdbc:mysql://localhost:3306/guli"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dsc<span class="token punctuation">.</span><span class="token function">setDriverName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dsc<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dsc<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dsc<span class="token punctuation">.</span><span class="token function">setDbType</span><span class="token punctuation">(</span><span class="token class-name">DbType</span><span class="token punctuation">.</span>MYSQL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mpg<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dsc<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 4、包配置</span>
        <span class="token class-name">PackageConfig</span> pc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PackageConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pc<span class="token punctuation">.</span><span class="token function">setModuleName</span><span class="token punctuation">(</span><span class="token string">"edu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//模块名</span>
        pc<span class="token punctuation">.</span><span class="token function">setParent</span><span class="token punctuation">(</span><span class="token string">"com.example.demo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pc<span class="token punctuation">.</span><span class="token function">setController</span><span class="token punctuation">(</span><span class="token string">"controller"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pc<span class="token punctuation">.</span><span class="token function">setEntity</span><span class="token punctuation">(</span><span class="token string">"entity"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pc<span class="token punctuation">.</span><span class="token function">setService</span><span class="token punctuation">(</span><span class="token string">"service"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pc<span class="token punctuation">.</span><span class="token function">setMapper</span><span class="token punctuation">(</span><span class="token string">"mapper"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mpg<span class="token punctuation">.</span><span class="token function">setPackageInfo</span><span class="token punctuation">(</span>pc<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 5、策略配置</span>
        <span class="token class-name">StrategyConfig</span> strategy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StrategyConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        strategy<span class="token punctuation">.</span><span class="token function">setInclude</span><span class="token punctuation">(</span><span class="token string">"edu_teacher"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        strategy<span class="token punctuation">.</span><span class="token function">setNaming</span><span class="token punctuation">(</span><span class="token class-name">NamingStrategy</span><span class="token punctuation">.</span>underline_to_camel<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//数据库表映射到实体的命名策略</span>
        strategy<span class="token punctuation">.</span><span class="token function">setTablePrefix</span><span class="token punctuation">(</span>pc<span class="token punctuation">.</span><span class="token function">getModuleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"_"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//生成实体时去掉表前缀</span>

        strategy<span class="token punctuation">.</span><span class="token function">setColumnNaming</span><span class="token punctuation">(</span><span class="token class-name">NamingStrategy</span><span class="token punctuation">.</span>underline_to_camel<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//数据库表字段映射到实体的命名策略</span>
        strategy<span class="token punctuation">.</span><span class="token function">setEntityLombokModel</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// lombok 模型 @Accessors(chain = true) setter链式操作</span>

        strategy<span class="token punctuation">.</span><span class="token function">setRestControllerStyle</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//restful api风格控制器</span>
        strategy<span class="token punctuation">.</span><span class="token function">setControllerMappingHyphenStyle</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//url中驼峰转连字符</span>

        mpg<span class="token punctuation">.</span><span class="token function">setStrategy</span><span class="token punctuation">(</span>strategy<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">// 6、执行</span>
        mpg<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</code></pre>

<h3 id="讲师列表接口"><a href="#讲师列表接口" class="headerlink" title="讲师列表接口"></a>讲师列表接口</h3><ol>
<li><p>创建controller</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">"讲师管理"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/eduservice/teacher"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@CrossOrigin</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EduTeacherController</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//访问地址：http://localhost:8001/eduservice/teacher/findAll</span>
    <span class="token comment">//把service注入</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">EduTeacherService</span> teacherService<span class="token punctuation">;</span>

    <span class="token comment">//1 查询讲师表中所有数据</span>
    <span class="token comment">//rest风格</span>
    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"所有讲师列表"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"findAll"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">findAllTeacher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//调用service方法实现查询操作</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EduTeacher</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> teacherService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"items"</span><span class="token punctuation">,</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>创建启动类</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"com.atguigu"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EduApplication</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">EduApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>创建配置类，配置mapper扫描等等</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">"com.atguigu.eduservice.mapper"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EduConfig</span> <span class="token punctuation">&#123;</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>测试，使用端口8001：</p>
<p><a target="_blank" rel="noopener" href="http://localhost:8001/eduservice/teacher/findAll">http://localhost:8001/eduservice/teacher/findAll</a></p>
</li>
</ol>
<h3 id="讲师逻辑删除接口"><a href="#讲师逻辑删除接口" class="headerlink" title="讲师逻辑删除接口"></a>讲师逻辑删除接口</h3><ol>
<li><p>在配置类EduConfig中，配置逻辑删除插件</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//逻辑删除插件</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ISqlInjector</span> <span class="token function">sqlInjector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LogicSqlInjector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>在实体类EduTeacher中，对应逻辑删除属性上添加注解<code>@TableLogic</code></p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"逻辑删除 1（true）已删除， 0（false）未删除"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@TableLogic</span>
<span class="token keyword">private</span> <span class="token class-name">Boolean</span> isDeleted<span class="token punctuation">;</span></code></pre></li>
<li><p>编写controller内的方法</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//2 逻辑删除讲师</span>
<span class="token comment">//@PathVariable:得到浏览器路径中的值id（必要）</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"根据ID删除讲师"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">"&#123;id&#125;"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">removeTeacher</span><span class="token punctuation">(</span>
        <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"讲师ID"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">boolean</span> flag <span class="token operator">=</span> teacherService<span class="token punctuation">.</span><span class="token function">removeById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p><code>@DeleteMapping(&quot;&#123;id&#125;&quot;)</code>：id值需要通过路径传递</p>
<p><code>@PathVariable String id</code>：获取路径中的id值</p>
<p>例：<code>localhost:8001/edu/delete/114514</code></p>
</li>
<li><p>如何测试？</p>
<blockquote>
<p>delete提交<strong>不同于</strong>get\post提交</p>
</blockquote>
<p>借助一些工具：</p>
<p><strong>swagger测试(重点)</strong></p>
<p>postman(了解)</p>
</li>
</ol>
<h3 id="swagger整合"><a href="#swagger整合" class="headerlink" title="swagger整合"></a>swagger整合</h3><blockquote>
<p>优点：</p>
<ol>
<li>生成在线接口文档</li>
<li>方便接口测试</li>
</ol>
</blockquote>
<ol>
<li><p>创建公共模块，整合swagger，以便所有模块都能使用</p>
<p>父工程guli_parent -&gt; 子模块common -&gt; 子模块service_base，创建配置类SwaggerConfig</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span> <span class="token comment">//配置类</span>
<span class="token annotation punctuation">@EnableSwagger2</span> <span class="token comment">//swagger注解</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SwaggerConfig</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Docket</span> <span class="token function">webApiConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Docket</span><span class="token punctuation">(</span><span class="token class-name">DocumentationType</span><span class="token punctuation">.</span>SWAGGER_2<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">groupName</span><span class="token punctuation">(</span><span class="token string">"webApi"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token function">webApiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">paths</span><span class="token punctuation">(</span><span class="token class-name">Predicates</span><span class="token punctuation">.</span><span class="token function">not</span><span class="token punctuation">(</span><span class="token class-name">PathSelectors</span><span class="token punctuation">.</span><span class="token function">regex</span><span class="token punctuation">(</span><span class="token string">"/admin/.*"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">paths</span><span class="token punctuation">(</span><span class="token class-name">Predicates</span><span class="token punctuation">.</span><span class="token function">not</span><span class="token punctuation">(</span><span class="token class-name">PathSelectors</span><span class="token punctuation">.</span><span class="token function">regex</span><span class="token punctuation">(</span><span class="token string">"/error.*"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token class-name">ApiInfo</span> <span class="token function">webApiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ApiInfoBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">"网站-课程中心API文档"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">"本文档描述了课程中心微服务接口定义"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">"1.0"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">contact</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Contact</span><span class="token punctuation">(</span><span class="token string">"Helen"</span><span class="token punctuation">,</span> <span class="token string">"http://atguigu.com"</span><span class="token punctuation">,</span>
                        <span class="token string">"55317332@qq.com"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>在service_edu中，引入service_base依赖</p>
<pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.atguigu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>service_base<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre></li>
<li><p>在service_edu启动类添加注解，设置包扫描规则</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"com.atguigu"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EduApplication</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">EduApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>访问swagger</p>
<p>固定页面：<a href="http://localhost:xxxx/swagger-ui.html">http://localhost:xxxx/swagger-ui.html</a></p>
</li>
</ol>
<h3 id="统一结果返回"><a href="#统一结果返回" class="headerlink" title="统一结果返回"></a>统一结果返回</h3><p>json数据格式有2种：</p>
<p><strong>对象 数组</strong></p>
<p>这两种格式一般混合使用</p>
<pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token property">"success"</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span> <span class="token comment">//响应是否成功</span>
    <span class="token property">"code"</span><span class="token operator">:</span> num<span class="token punctuation">,</span> <span class="token comment">//响应码</span>
    <span class="token property">"message"</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token comment">//返回消息</span>
    <span class="token property">"data"</span><span class="token operator">:</span> HashMap <span class="token comment">//返回数据，存放在键值对中</span>
<span class="token punctuation">&#125;</span></code></pre>

<ol>
<li><p>在common模块，创建子模块 common_utils</p>
</li>
<li><p>创建interface，定义数据返回状态码</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ResultCode</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> SUCCESS <span class="token operator">=</span> <span class="token number">20000</span><span class="token punctuation">;</span><span class="token comment">//成功</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> ERROR <span class="token operator">=</span> <span class="token number">20001</span><span class="token punctuation">;</span><span class="token comment">//失败</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>定义数据返回格式</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//统一返回结果类</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">R</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"是否成功"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> success<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"返回码"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"返回消息"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"返回数据"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>使用统一结果</p>
<ul>
<li><p>在service中，引入 common_utils</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>com<span class="token punctuation">.</span>atguigu<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>common_utils<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">></span></span><span class="token number">0.0</span><span class="token number">.1</span><span class="token operator">-</span>SNAPSHOT<span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span></code></pre></li>
<li><p>设置接口返回结果都是<code>R</code></p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">findAllTeacher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token comment">//调用service方法实现查询操作</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EduTeacher</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> teacherService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"items"</span><span class="token punctuation">,</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ul>
</li>
</ol>
<h3 id="讲师分页查询和条件查询"><a href="#讲师分页查询和条件查询" class="headerlink" title="讲师分页查询和条件查询"></a>讲师分页查询和条件查询</h3><blockquote>
<p>讲师分页功能</p>
</blockquote>
<ol>
<li><p>在配置类EduConfig中，配置mp分页插件</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//分页插件</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">PaginationInterceptor</span> <span class="token function">paginationInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PaginationInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>编写讲师分页查询接口方法</p>
<pre class="language-java" data-language="java"><code class="language-java">    <span class="token comment">//3 分页查询讲师方法</span>
    <span class="token comment">//current 当前页</span>
    <span class="token comment">//limit 每页记录数</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"pageTeacher/&#123;current&#125;/&#123;limit&#125;"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">pageListTeacher</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token keyword">long</span> current<span class="token punctuation">,</span>
                             <span class="token annotation punctuation">@PathVariable</span> <span class="token keyword">long</span> limit<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        <span class="token comment">//创建page对象</span>
        <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EduTeacher</span><span class="token punctuation">></span></span> pageTeacher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>current<span class="token punctuation">,</span>limit<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//调用方法实现分页</span>
        <span class="token comment">//调用方法时，底层封装，把分页所有数据封装到pageTeacher对象里面</span>
        teacherService<span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span>pageTeacher<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">long</span> total <span class="token operator">=</span> pageTeacher<span class="token punctuation">.</span><span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//总记录数</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EduTeacher</span><span class="token punctuation">></span></span> records <span class="token operator">=</span> pageTeacher<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//每页数据List集合</span>

<span class="token comment">//        Map map = new HashMap&lt;>();</span>
<span class="token comment">//        map.put("total",total);</span>
<span class="token comment">//        map.put("rows",records);</span>
<span class="token comment">//        return R.ok().data(map); //利用map存放返回数据，二选一均可</span>

        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"total"</span><span class="token punctuation">,</span>total<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"rows"</span><span class="token punctuation">,</span>records<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span></code></pre></li>
</ol>
<blockquote>
<p>多条件组合查询带分页</p>
</blockquote>
<p>实现效果：</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210425154308.jpg" alt="未命名文件 (1)" loading="lazy"></p>
<ol>
<li><p>把条件值传递到接口里面</p>
<p><strong>条件值封装到对象，对象传递到接口</strong></p>
</li>
<li><p>根据条件值进行判断，拼接条件</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//4 条件查询带分页的方法</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"pageTeacherCondition/&#123;current&#125;/&#123;limit&#125;"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">pageTeacherCondition</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token keyword">long</span> current<span class="token punctuation">,</span>
                              <span class="token annotation punctuation">@PathVariable</span> <span class="token keyword">long</span> limit<span class="token punctuation">,</span>
                              <span class="token annotation punctuation">@RequestBody</span><span class="token punctuation">(</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">TeacherQuery</span> teacherQuery<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span></code></pre>

<ul>
<li><p>RequestBody：</p>
<p>需要使用post提交方式</p>
<p>使用json传递数据，把json数据封装到对应对象里</p>
<p><code>@RequestBody(required = false)</code>，即参数值可以为空</p>
</li>
<li><p>ResponseBody：</p>
<p>返回json数据</p>
</li>
</ul>
</li>
</ol>
<h3 id="讲师添加功能"><a href="#讲师添加功能" class="headerlink" title="讲师添加功能"></a>讲师添加功能</h3><ol>
<li><p>自动填充配置</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMetaObjectHandler</span> <span class="token keyword">implements</span> <span class="token class-name">MetaObjectHandler</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertFill</span><span class="token punctuation">(</span><span class="token class-name">MetaObject</span> metaObject<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//属性名称，不是数据库表字段名称</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"gmtCreate"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"gmtModified"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateFill</span><span class="token punctuation">(</span><span class="token class-name">MetaObject</span> metaObject<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"gmtModified"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"创建时间"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>fill <span class="token operator">=</span> <span class="token class-name">FieldFill</span><span class="token punctuation">.</span>INSERT<span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Date</span> gmtCreate<span class="token punctuation">;</span>
   
<span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"更新时间"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>fill <span class="token operator">=</span> <span class="token class-name">FieldFill</span><span class="token punctuation">.</span>INSERT_UPDATE<span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Date</span> gmtModified<span class="token punctuation">;</span></code></pre></li>
<li><p>编写controller</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//5 添加讲师接口方法</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"addTeacher"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">addTeacher</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">EduTeacher</span> eduTeacher<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">boolean</span> save <span class="token operator">=</span> teacherService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>eduTeacher<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>save<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ol>
<h3 id="讲师修改功能"><a href="#讲师修改功能" class="headerlink" title="讲师修改功能"></a>讲师修改功能</h3><ol>
<li><p>根据讲师id进行查询</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//6 根据讲师id进行查询</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"getTeacher/&#123;id&#125;"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">getTeacher</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">EduTeacher</span> eduTeacher <span class="token operator">=</span> teacherService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"teacher"</span><span class="token punctuation">,</span>eduTeacher<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>讲师修改</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//7 讲师修改</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"updateTeacher"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">updateTeacher</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">EduTeacher</span> eduTeacher<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">boolean</span> flag <span class="token operator">=</span> teacherService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>eduTeacher<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ol>
<h2 id="Day-3"><a href="#Day-3" class="headerlink" title="Day 3"></a>Day 3</h2><ol>
<li>统一异常处理<ul>
<li>全局异常处理</li>
<li>特定异常处理</li>
<li>自定义异常处理</li>
</ul>
</li>
<li>统一日志处理<ul>
<li>Logback</li>
</ul>
</li>
<li>前端知识<ul>
<li>es6语法</li>
<li>vue指令</li>
</ul>
</li>
</ol>
<h3 id="统一异常处理"><a href="#统一异常处理" class="headerlink" title="统一异常处理"></a>统一异常处理</h3><ol>
<li><p>全局异常处理</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ControllerAdvice</span> <span class="token comment">//全局异常处理注解</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalExceptionHandler</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"执行了全局异常处理"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>特定异常处理</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//特定异常</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">ArithmeticException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">ArithmeticException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"执行了ArithmeticException异常处理"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>自定义异常处理</p>
<ul>
<li><p>创建自定义异常类，继承RuntimeException</p>
<p>编写异常属性</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span> <span class="token comment">//生成有参构造器</span>
<span class="token annotation punctuation">@NoArgsConstructor</span> <span class="token comment">//生成无参构造器</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GuliException</span> <span class="token keyword">extends</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span><span class="token comment">//状态码</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span><span class="token comment">//异常信息</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>在统一异常类添加规则</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//自定义异常</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">GuliException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">GuliException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>执行自定义异常</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">GuliException</span><span class="token punctuation">(</span><span class="token number">20001</span><span class="token punctuation">,</span><span class="token string">"执行了自定义异常"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ul>
</li>
</ol>
<h3 id="统一日志处理"><a href="#统一日志处理" class="headerlink" title="统一日志处理"></a>统一日志处理</h3><ol>
<li><p>日志级别</p>
<blockquote>
<p>ERROR WARN INFO DEBUG</p>
</blockquote>
<pre class="language-properties" data-language="properties"><code class="language-properties"><span class="token comment">#设置日志级别</span>
<span class="token attr-name">logging.level.root</span><span class="token punctuation">=</span><span class="token attr-value">WARN</span></code></pre></li>
<li><p>把日志输出到控制台和文件中，使用日志工具</p>
<p>log4j</p>
<p>logback日志工具</p>
<ul>
<li><p>删除application.properties中的日志配置</p>
<pre class="language-properties" data-language="properties"><code class="language-properties"><span class="token comment">#mybatis日志</span>
<span class="token comment">#mybatis-plus.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl</span>

<span class="token comment">#设置日志级别</span>
<span class="token comment">#logging.level.root=DEBUG</span></code></pre></li>
<li><p>在resources目录，创建logback-spring.xml</p>
</li>
</ul>
</li>
<li><p>如果程序运行出现异常，则把异常信息输出到文件中</p>
<p><code>log.error(e.getMessage());</code></p>
</li>
</ol>
<h3 id="es6介绍"><a href="#es6介绍" class="headerlink" title="es6介绍"></a>es6介绍</h3><blockquote>
<p>es6，即ECMAScript 6.0</p>
</blockquote>
<ol>
<li>es6与es5<ul>
<li>es6代码简洁，es5代码复杂</li>
<li>es6浏览器兼容性差，es5浏览器兼容性好</li>
</ul>
</li>
<li>es6是一套标准规范，JavaScript遵守了这套规范</li>
</ol>
<h3 id="vue入门"><a href="#vue入门" class="headerlink" title="vue入门"></a>vue入门</h3><blockquote>
<p>vue是一个构建页面前端的框架</p>
</blockquote>
<ol>
<li><p>使用vscode快捷生成html页面</p>
</li>
<li><p>引入vue的js文件，类似于JQuery</p>
<pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vue.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre></li>
<li><p>在html页面创建div标签，并添加id属性</p>
<pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre></li>
<li><p>编写vue代码，是一套固定的结构</p>
<pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
	<span class="token comment">//创建一个vue对象</span>
    <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span> <span class="token comment">//绑定vue的作用范围</span>
        data<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token comment">//定义页面中显示的模型数据</span>
            message<span class="token operator">:</span> <span class="token string">'Hello Vue!'</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre></li>
<li><p>使用<strong>插值表达式</strong><code>&#123;&#123;xxxx&#125;&#125;</code>，获取data里面定义的值</p>
<pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    &#123;&#123;message&#125;&#125;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre></li>
</ol>
<h2 id="Day-4"><a href="#Day-4" class="headerlink" title="Day 4"></a>Day 4</h2><ol>
<li><strong>axios，在vue中发送ajax请求(重点)</strong></li>
<li>element-ui</li>
<li><strong>nodejs</strong></li>
<li><strong>npm(重点)</strong></li>
<li>babel</li>
<li><strong>模块化(重点)</strong></li>
<li>webpack</li>
<li><strong>搭建项目前端环境(重点)</strong></li>
</ol>
<h3 id="axios"><a href="#axios" class="headerlink" title="axios"></a>axios</h3><ol>
<li><p>axios是独立的项目，不是vue里的一部分，只是axios经常与vue一起使用，实现ajax操作</p>
</li>
<li><p>使用axios应用场景</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210428083606.png" alt="image-20210428083606230" loading="lazy"></p>
</li>
<li><p>axios使用</p>
<ul>
<li><p>创建html页面，引入js文件，包含两个js文件：vue和axios</p>
<pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vue.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>axios.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre></li>
<li><p>编写axios代码</p>
<ul>
<li><p>创建json文件，创建数据</p>
<pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token property">"success"</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"code"</span><span class="token operator">:</span><span class="token number">20000</span><span class="token punctuation">,</span>
    <span class="token property">"message"</span><span class="token operator">:</span>成功<span class="token punctuation">,</span>
    <span class="token property">"data"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
        <span class="token property">"items"</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"lucy"</span><span class="token punctuation">,</span><span class="token property">"age"</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"mary"</span><span class="token punctuation">,</span><span class="token property">"age"</span><span class="token operator">:</span><span class="token number">30</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"jack"</span><span class="token punctuation">,</span><span class="token property">"age"</span><span class="token operator">:</span><span class="token number">40</span><span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>使用axios发送ajax请求，请求文件得到数据，在页面显示</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210428084107.png" alt="image-20210428084107339" loading="lazy"></p>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="nodejs"><a href="#nodejs" class="headerlink" title="nodejs"></a>nodejs</h3><ol>
<li><p>nodejs是什么</p>
<ul>
<li><p>类比学过的 java，运行 java 需要 jdk 环境</p>
<p>正在学的 nodejs，是 JavaScript 的运行环境，用于执行 JavaScript 代码</p>
</li>
<li><p>不需要浏览器，直接使用 nodejs 运行 JavaScript 代码</p>
</li>
<li><p>模拟服务器效果，比如tomcat</p>
</li>
</ul>
</li>
<li><p>安装nodejs</p>
</li>
<li><p>使用nodejs执行 JavaScript 代码</p>
<p><code>node xxx.js</code></p>
</li>
<li><p>在vscode中打开终端窗口(cmd窗口)，执行js代码</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210428084944.png" alt="image-20210428084817993" loading="lazy"></p>
</li>
</ol>
<h3 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h3><ol>
<li><p>npm是什么</p>
<blockquote>
<p>包管理工具</p>
</blockquote>
<ul>
<li>在后端开发中使用过maven，maven构建项目，管理jar依赖，并联网下载依赖</li>
<li>npm类似于maven，用于前端，管理前端js依赖，并联网下载依赖</li>
</ul>
</li>
<li><p>安装npm</p>
<ul>
<li>在安装nodejs时，npm也会一并安装</li>
<li>使用<code>npm -v</code>，查看是否安装成功</li>
</ul>
</li>
<li><p>演示npm具体操作</p>
<ul>
<li><p>npm项目初始化操作</p>
<p>使用命令<code>npm init -y</code></p>
<p>项目初始化之后，生成文件 package.json ，类似于后端pom.xml文件</p>
</li>
<li><p>npm下载指定js依赖，使用命令<code>npm install xxxx(依赖名称)</code></p>
<p>根据package.json下载依赖，使用命令<code>npm install</code></p>
</li>
</ul>
</li>
</ol>
<h3 id="babel"><a href="#babel" class="headerlink" title="babel"></a>babel</h3><ol>
<li><p>babel是什么</p>
<blockquote>
<p>babel是转码器，把es6代码转换成es5代码</p>
<p>因为写的代码是es6代码，es6代码的浏览器兼容性很差，改为使用es5浏览器兼容性好</p>
</blockquote>
</li>
<li><p>babel的使用</p>
<ul>
<li><p>安装babel工具</p>
<p>使用命令<code>npm install --global babel-cli</code></p>
</li>
<li><p>创建js文件，编写es6代码</p>
</li>
<li><p>创建babel配置文件<code>.babelrc</code></p>
<pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token property">"presets"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"es2015"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"plugins"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>安装es2015转码器</p>
<p><code>npm install --save-dev babel-preset-es2015</code></p>
</li>
<li><p>使用命令进行转码(<strong>以下es6 es5均是文件夹名称</strong>)</p>
<p>根据文件转码：<code>babel es6/xxx.js -o es5/xxx.js</code></p>
<p>根据文件夹转码：<code>babel es6 -d es5</code></p>
</li>
</ul>
</li>
</ol>
<h3 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h3><ol>
<li><p>是什么</p>
<ul>
<li>开发后端接口的时候，开发controller service mapper，controller注入service，service注入mapper</li>
<li>在后端中，类与类之间的调用成为后端的模块化操作</li>
<li>在前端中，js与js之间的调用成为前端的模块化操作</li>
</ul>
</li>
<li><p>es5实现模块化操作</p>
<p>在01.js定义js方法</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//1 创建js方法</span>
<span class="token keyword">const</span> <span class="token function-variable function">sum</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> <span class="token function-variable function">subtract</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//2 设置哪些方法可以被其他js调用</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    sum<span class="token punctuation">,</span>
    subtract
<span class="token punctuation">&#125;</span></code></pre>

<p>在02.js调用01.js里的方法</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//调用01.js里面的方法</span>
<span class="token comment">//1 引入01.js文件</span>
<span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./01.js"</span><span class="token punctuation">)</span>
<span class="token comment">//2 调用</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
consule<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token function">subtract</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<p>测试 <code>node 02.js</code></p>
</li>
<li><p>es6模块化代码写法一</p>
<blockquote>
<p>注意：如果使用es6写法实现模块化操作，在nodejs环境中不能直接运行，<strong>需要使用babel把es6代码转换为es5代码，才可以在nodejs运行</strong></p>
</blockquote>
<p>01.js定义方法</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//定义方法，设置哪些方法可以被其他js调用</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"getList..."</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"save..."</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>02.js调用01.js的方法</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//调用01.js的方法，引入01.js文件，进行调用</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span>getList<span class="token punctuation">,</span>save<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./01.js'</span>
<span class="token comment">//调用方法</span>
<span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></li>
<li><p>es6模块化代码写法二</p>
<p>01.js</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//定义方法，设置哪些方法可以被其他js调用</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
    <span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'getList...'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'update...'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>02.js</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//调用01.js的方法，引入01.js文件，进行调用</span>
<span class="token keyword">import</span> m <span class="token keyword">from</span> <span class="token string">'./01.js'</span>
<span class="token comment">//调用方法</span>
m<span class="token punctuation">.</span><span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></li>
</ol>
<h3 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h3><ol>
<li><p>是什么</p>
<blockquote>
<p>打包工具，可以把多个静态资源文件打包成一个文件</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210428093816.png" alt="image-20210428093816780" loading="lazy"></p>
</li>
<li><p>webpack使用</p>
<ul>
<li><p>安装webpack工具</p>
<p><code>npm install -g webpack webpack-cl</code></p>
<p>查看是否安装成功</p>
<p><code>webpack -v</code></p>
</li>
<li><p>创建js文件用于打包操作</p>
<p>创建三个js文件：</p>
<p>在common.js和utils.js定义方法</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript">exports<span class="token punctuation">.</span><span class="token function-variable function">info</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<pre class="language-javascript" data-language="javascript"><code class="language-javascript">exports<span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>在main.js引入common和utils</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> common <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./common'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

common<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'Hello world!'</span> <span class="token operator">+</span> utils<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li>
<li><p>创建webpack配置文件，配置打包信息</p>
<p>webpack.config.js</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Node.js内置模块</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/main.js'</span><span class="token punctuation">,</span> <span class="token comment">//配置入口文件</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//输出路径，__dirname：当前文件所在路径</span>
        filename<span class="token operator">:</span> <span class="token string">'bundle.js'</span> <span class="token comment">//输出文件</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>使用命令执行打包操作</p>
<p><code>webpack #有警告</code></p>
<p><code>webpack --mode=development #没有警告</code></p>
</li>
<li><p>最终测试</p>
<p>创建html文件，引入打包之后的js文件，使用浏览器查看效果</p>
<pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dist/bundle.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre></li>
</ul>
</li>
</ol>
<h4 id="打包css"><a href="#打包css" class="headerlink" title="打包css"></a>打包css</h4><ol>
<li><p>创建css文件，写样式内容</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">&#123;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>在main.js中，引入css文件</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">//css文件引入</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./style.css'</span><span class="token punctuation">)</span></code></pre></li>
<li><p>安装css加载工具</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev style-loader css-loader</code></pre></li>
<li><p>修改webpack配置文件</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Node.js内置模块</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//...</span>
    output<span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span> 
            <span class="token punctuation">&#123;</span> 
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">//打包规则应用到以css结尾的文件上</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ol>
<h3 id="搭建前端页面环境"><a href="#搭建前端页面环境" class="headerlink" title="搭建前端页面环境"></a>搭建前端页面环境</h3><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210508083339.png" alt="image-20210508083321495" loading="lazy"></p>
<blockquote>
<p>选取一个模板(框架)进行环境搭建</p>
<p>vue-admin-template</p>
</blockquote>
<ol>
<li><p>找到模板源文件，并解压至工作区</p>
</li>
<li><p>通过vscode终端，下载依赖</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">//通过配置文件下载依赖
<span class="token function">npm</span> <span class="token function">install</span></code></pre></li>
<li><p>启动模板项目</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> run dev</code></pre></li>
</ol>
<h3 id="前端页面环境说明"><a href="#前端页面环境说明" class="headerlink" title="前端页面环境说明"></a>前端页面环境说明</h3><ol>
<li><p>前端框架入口：</p>
<p>index.html</p>
<p>main.js</p>
</li>
<li><p>前端页面环境使用的框架，主要基于两种技术：</p>
<p>vue-admin-template = vue + element-ui</p>
</li>
<li><p>build目录</p>
<p>存放项目构建的脚本文件</p>
</li>
<li><p>config目录</p>
<p>index.js</p>
<p>修改<code>  useEslint: false</code>为<code>  true</code></p>
<p>dev.env.js</p>
<p>修改<code> BASE_API: &#39;&quot;http://localhost:8001&quot;&#39;</code>，即后端接口地址</p>
</li>
<li><p>src目录</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210508084246.png" alt="image-20210508084239815" loading="lazy"></p>
</li>
</ol>
<h2 id="Day-5"><a href="#Day-5" class="headerlink" title="Day 5"></a>Day 5</h2><p>讲师管理前端开发</p>
<ol>
<li>讲师列表(分页条件查询)</li>
<li>讲师添加</li>
<li>讲师删除功能</li>
<li>讲师修改功能</li>
</ol>
<blockquote>
<p>先把后端管理系统登录改造到本地</p>
<p>后面登录功能添加权限框架 spring security</p>
</blockquote>
<h3 id="改造登录到本地接口"><a href="#改造登录到本地接口" class="headerlink" title="改造登录到本地接口"></a>改造登录到本地接口</h3><ol>
<li><p>把登录请求地址改造到本地，修改配置文件</p>
<p>config目录的dev.env.js</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token constant">BASE_API</span><span class="token operator">:</span> <span class="token string">'"http://localhost:9001"'</span></code></pre></li>
<li><p>登录操作调用两个方法：login登录操作，info登录后获取用户信息</p>
<p>创建接口两个方法实现登录</p>
<ul>
<li>login 返回token值</li>
<li>info 返回roles name avatar</li>
</ul>
</li>
<li><p>开发接口</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/eduservice/user"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@CrossOrigin</span> <span class="token comment">//解决跨域问题</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EduLoginController</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//login</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"login"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>


        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">,</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//info</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"info"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>


        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"roles"</span><span class="token punctuation">,</span><span class="token string">"[admin]"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"avatar"</span><span class="token punctuation">,</span><span class="token string">"https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210202224329.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>修改api目录login.js，修改本地接口路径</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'@/utils/request'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token parameter">username<span class="token punctuation">,</span> password</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    url<span class="token operator">:</span> <span class="token string">'/eduservice/user/login'</span><span class="token punctuation">,</span>
    method<span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      username<span class="token punctuation">,</span>
      password
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token parameter">token</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    url<span class="token operator">:</span> <span class="token string">'/eduservice/user/info'</span><span class="token punctuation">,</span>
    method<span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
    params<span class="token operator">:</span> <span class="token punctuation">&#123;</span> token <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>最终测试出现问题<code>Access-Control-Allow-Origin</code>，即<strong>跨域问题</strong></p>
<ul>
<li><p>跨域问题</p>
<p>通过一个地址去访问另外一个地址，此过程中如果三个地方任何一个不同，便会出现</p>
<ul>
<li>访问协议 http https</li>
<li>ip地址 192.168.1.1 172.11.11.11</li>
<li>端口号 9528 8001</li>
</ul>
</li>
<li><p>解决跨域问题</p>
<ul>
<li><p><strong>在后端controller接口添加注解(常用)</strong></p>
<p><code>@CrossOrigin</code></p>
</li>
<li><p>使用网关解决(后面用到)</p>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="前端框架开发过程介绍"><a href="#前端框架开发过程介绍" class="headerlink" title="前端框架开发过程介绍"></a>前端框架开发过程介绍</h3><ol>
<li><p>添加路由</p>
<p>src/router/index.js 进行配置</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token punctuation">&#123;</span>
  path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
  component<span class="token operator">:</span> Layout<span class="token punctuation">,</span>
  redirect<span class="token operator">:</span> <span class="token string">'/dashboard'</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'Dashboard'</span><span class="token punctuation">,</span>
  hidden<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>
    path<span class="token operator">:</span> <span class="token string">'dashboard'</span><span class="token punctuation">,</span>
    <span class="token comment">//路由对应页面</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/dashboard/index'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span></code></pre></li>
<li><p>实现效果：点击某个路由，显示路由对应页面</p>
<p>在views目录创建vue页面</p>
</li>
<li><p>api目录创建js文件，定义接口地址和参数</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'@/utils/request'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getList</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    url<span class="token operator">:</span> <span class="token string">'/table/list'</span><span class="token punctuation">,</span>
    method<span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
    params
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>在vue页面引入js文件，调用方法实现功能</p>
<ul>
<li><p>引入<code>import user from &#39;...&#39;</code></p>
</li>
<li><p>使用element-ui显示数据内容</p>
<pre class="language-vue" data-language="vue"><code class="language-vue">data:&#123;

&#125;,
created() &#123;

&#125;,
methods:&#123;

&#125;</code></pre></li>
</ul>
</li>
</ol>
<h3 id="讲师列表前端开发"><a href="#讲师列表前端开发" class="headerlink" title="讲师列表前端开发"></a>讲师列表前端开发</h3><ol>
<li><p>添加路由</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token punctuation">&#123;</span>
  path<span class="token operator">:</span> <span class="token string">'/teacher'</span><span class="token punctuation">,</span>
  component<span class="token operator">:</span> Layout<span class="token punctuation">,</span>
  redirect<span class="token operator">:</span> <span class="token string">'/teacher/table'</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'讲师管理'</span><span class="token punctuation">,</span>
  meta<span class="token operator">:</span> <span class="token punctuation">&#123;</span> title<span class="token operator">:</span> <span class="token string">'讲师管理'</span><span class="token punctuation">,</span> icon<span class="token operator">:</span> <span class="token string">'example'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  children<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
      path<span class="token operator">:</span> <span class="token string">'table'</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">'讲师列表'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/edu/teacher/list'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      meta<span class="token operator">:</span> <span class="token punctuation">&#123;</span> title<span class="token operator">:</span> <span class="token string">'讲师列表'</span><span class="token punctuation">,</span> icon<span class="token operator">:</span> <span class="token string">'table'</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      path<span class="token operator">:</span> <span class="token string">'save'</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">'添加讲师'</span><span class="token punctuation">,</span>  
      <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/edu/teacher/save'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      meta<span class="token operator">:</span> <span class="token punctuation">&#123;</span> title<span class="token operator">:</span> <span class="token string">'添加讲师'</span><span class="token punctuation">,</span> icon<span class="token operator">:</span> <span class="token string">'tree'</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      path<span class="token operator">:</span> <span class="token string">'edit/:id'</span><span class="token punctuation">,</span>   
      name<span class="token operator">:</span> <span class="token string">'EduTeacherEdit'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/edu/teacher/save'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      meta<span class="token operator">:</span> <span class="token punctuation">&#123;</span> title<span class="token operator">:</span> <span class="token string">'编辑讲师'</span><span class="token punctuation">,</span> noCache<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      hidden<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span></code></pre></li>
<li><p>创建对应页面</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210508093531.png" alt="image-20210508093449436" loading="lazy"></p>
</li>
<li><p>在api目录创建teacher.js定义访问的接口地址</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'@/utils/request'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//1 讲师列表（条件查询分页）</span>
    <span class="token comment">//current当前页 limit每页记录数 teacherQuery条件对象</span>
    <span class="token function">getTeacherListPage</span><span class="token punctuation">(</span><span class="token parameter">current<span class="token punctuation">,</span>limit<span class="token punctuation">,</span>teacherQuery</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token comment">//url: '/eduservice/teacher/pageTeacherCondition/'+current+"/"+limit,</span>
            url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/eduservice/teacher/pageTeacherCondition/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>current<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>limit<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            method<span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
            <span class="token comment">//teacherQuery条件对象，后端使用RequestBody获取数据</span>
            <span class="token comment">//data表示把对象转换json进行传递到接口里面</span>
            data<span class="token operator">:</span> teacherQuery
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment">//删除讲师</span>
    <span class="token function">deleteTeacherId</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/eduservice/teacher/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            method<span class="token operator">:</span> <span class="token string">'delete'</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment">//添加讲师</span>
    <span class="token function">addTeacher</span><span class="token punctuation">(</span><span class="token parameter">teacher</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/eduservice/teacher/addTeacher</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            method<span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> teacher
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment">//根据id查询讲师</span>
    <span class="token function">getTeacherInfo</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/eduservice/teacher/getTeacher/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            method<span class="token operator">:</span> <span class="token string">'get'</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment">//修改讲师</span>
    <span class="token function">updateTeacherInfo</span><span class="token punctuation">(</span><span class="token parameter">teacher</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/eduservice/teacher/updateTeacher</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            method<span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> teacher
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>在讲师列表页面list.vue，调用定义的接口方法，得到接口返回数据</p>
<pre class="language-vue" data-language="vue"><code class="language-vue">data()&#123;
	return&#123;

	&#125;
&#125;,
created()&#123;

&#125;,
methods:&#123;

&#125;</code></pre></li>
<li><p>把请求接口获取的数据，在页面进行显示</p>
<p>查阅<a target="_blank" rel="noopener" href="https://element.eleme.cn/">element-ui官方文档</a>，copy表格代码</p>
<pre class="language-vue" data-language="vue"><code class="language-vue">&lt;template&gt;
  &lt;el-table
    :data&#x3D;&quot;tableData&quot;
    style&#x3D;&quot;width: 100%&quot;&gt;
    &lt;el-table-column
      prop&#x3D;&quot;date&quot;
      label&#x3D;&quot;日期&quot;
      width&#x3D;&quot;180&quot;&gt;
    &lt;&#x2F;el-table-column&gt;
    &lt;el-table-column
      prop&#x3D;&quot;name&quot;
      label&#x3D;&quot;姓名&quot;
      width&#x3D;&quot;180&quot;&gt;
    &lt;&#x2F;el-table-column&gt;
    &lt;el-table-column
      prop&#x3D;&quot;address&quot;
      label&#x3D;&quot;地址&quot;&gt;
    &lt;&#x2F;el-table-column&gt;
  &lt;&#x2F;el-table&gt;
&lt;&#x2F;template&gt;
   
&lt;script&gt;
  export default &#123;
    data() &#123;
      return &#123;
        tableData: [&#123;
          date: &#39;2016-05-02&#39;,
          name: &#39;王小虎&#39;,
          address: &#39;上海市普陀区金沙江路 1518 弄&#39;
        &#125;, &#123;
          date: &#39;2016-05-04&#39;,
          name: &#39;王小虎&#39;,
          address: &#39;上海市普陀区金沙江路 1517 弄&#39;
        &#125;, &#123;
          date: &#39;2016-05-01&#39;,
          name: &#39;王小虎&#39;,
          address: &#39;上海市普陀区金沙江路 1519 弄&#39;
        &#125;, &#123;
          date: &#39;2016-05-03&#39;,
          name: &#39;王小虎&#39;,
          address: &#39;上海市普陀区金沙江路 1516 弄&#39;
        &#125;]
      &#125;
    &#125;
  &#125;
&lt;&#x2F;script&gt;</code></pre></li>
<li><p>讲师列表添加分页实现</p>
<pre class="language-vue" data-language="vue"><code class="language-vue">&lt;!-- 分页 --&gt;
  &lt;el-pagination
    :current-page&#x3D;&quot;page&quot;
    :page-size&#x3D;&quot;limit&quot;
    :total&#x3D;&quot;total&quot;
    style&#x3D;&quot;padding: 30px 0; text-align: center;&quot;
    layout&#x3D;&quot;total, prev, pager, next, jumper&quot;
    @current-change&#x3D;&quot;getList&quot;
  &#x2F;&gt;</code></pre>

<p>分页方法修改，添加页码参数</p>
<pre class="language-vue" data-language="vue"><code class="language-vue">   methods:&#123;
       &#x2F;&#x2F;讲师列表的方法
       getList(page&#x3D;1) &#123;
           this.page &#x3D; page
	&#125;
&#125;</code></pre></li>
<li><p>添加条件查询</p>
<p>使用element-ui组件实现</p>
<p>在列表上面添加条件输入表单，使用v-model数据绑定</p>
<pre class="language-vue" data-language="vue"><code class="language-vue">&lt;el-form-item&gt;
  &lt;el-input v-model&#x3D;&quot;teacherQuery.name&quot; placeholder&#x3D;&quot;讲师名&quot;&#x2F;&gt;
&lt;&#x2F;el-form-item&gt;</code></pre>

<pre class="language-vue" data-language="vue"><code class="language-vue">&lt;el-button type&#x3D;&quot;primary&quot; icon&#x3D;&quot;el-icon-search&quot; @click&#x3D;&quot;getList()&quot;&gt;查询&lt;&#x2F;el-button&gt;</code></pre>

<p>清空功能</p>
<ul>
<li>先清空表单输入的条件</li>
<li>再查询所有数据</li>
</ul>
<pre class="language-vue" data-language="vue"><code class="language-vue">resetData() &#123;&#x2F;&#x2F;清空的方法
    &#x2F;&#x2F;表单输入项数据清空
    this.teacherQuery &#x3D; &#123;&#125;
    &#x2F;&#x2F;查询所有讲师数据
    this.getList()
&#125;</code></pre></li>
</ol>
<h3 id="讲师删除功能前端实现"><a href="#讲师删除功能前端实现" class="headerlink" title="讲师删除功能前端实现"></a>讲师删除功能前端实现</h3><ol>
<li><p>在每条记录后面添加删除按钮，按钮绑定事件，并在绑定事件的方法传递删除讲师的id值</p>
<pre class="language-vue" data-language="vue"><code class="language-vue">&lt;el-button type&#x3D;&quot;danger&quot; size&#x3D;&quot;mini&quot; icon&#x3D;&quot;el-icon-delete&quot; @click&#x3D;&quot;removeDataById(scope.row.id)&quot;&gt;删除&lt;&#x2F;el-button&gt;</code></pre></li>
<li><p>在api目录teacher.js定义删除接口的地址</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">//删除讲师</span>
<span class="token function">deleteTeacherId</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/eduservice/teacher/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        method<span class="token operator">:</span> <span class="token string">'delete'</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span></code></pre></li>
<li><p>vue页面调用，实现删除</p>
<pre class="language-vue" data-language="vue"><code class="language-vue">&#x2F;&#x2F;删除讲师的方法
removeDataById(id) &#123;
    this.$confirm(&#39;此操作将永久删除讲师记录, 是否继续?&#39;, &#39;提示&#39;, &#123;
        confirmButtonText: &#39;确定&#39;,
        cancelButtonText: &#39;取消&#39;,
        type: &#39;warning&#39;
    &#125;).then(() &#x3D;&gt; &#123;  &#x2F;&#x2F;点击确定，执行then方法
        &#x2F;&#x2F;调用删除的方法
        teacher.deleteTeacherId(id)
            .then(response &#x3D;&gt;&#123;&#x2F;&#x2F;删除成功
            &#x2F;&#x2F;提示信息
            this.$message(&#123;
                type: &#39;success&#39;,
                message: &#39;删除成功!&#39;
            &#125;);
            &#x2F;&#x2F;回到列表页面
            this.getList()
        &#125;)
    &#125;) &#x2F;&#x2F;点击取消，执行catch方法
&#125;</code></pre></li>
</ol>
<h3 id="讲师添加功能前端实现"><a href="#讲师添加功能前端实现" class="headerlink" title="讲师添加功能前端实现"></a>讲师添加功能前端实现</h3><blockquote>
<p>点击”添加讲师”按钮，进入表单页面，输入讲师信息</p>
<p>在表单页面，点击”保存”，提交接口，添加至数据库</p>
</blockquote>
<ol>
<li><p>api定义接口地址</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">//添加讲师</span>
<span class="token function">addTeacher</span><span class="token punctuation">(</span><span class="token parameter">teacher</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/eduservice/teacher/addTeacher</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        method<span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> teacher
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>在vue页面实现调用</p>
<pre class="language-vue" data-language="vue"><code class="language-vue">&#x2F;&#x2F;添加讲师的方法
saveTeacher() &#123;
  teacherApi.addTeacher(this.teacher)
    .then(response &#x3D;&gt; &#123;&#x2F;&#x2F;添加成功
      &#x2F;&#x2F;提示信息
      this.$message(&#123;
          type: &#39;success&#39;,
          message: &#39;添加成功!&#39;
      &#125;);
      &#x2F;&#x2F;回到列表页面 路由跳转
      this.$router.push(&#123;path:&#39;&#x2F;teacher&#x2F;table&#39;&#125;)
    &#125;)
&#125;</code></pre></li>
</ol>
<h3 id="讲师修改功能-1"><a href="#讲师修改功能-1" class="headerlink" title="讲师修改功能"></a>讲师修改功能</h3><ol>
<li><p>每条记录后面添加”修改”按钮</p>
</li>
<li><p>点击”修改”按钮，进入表单页面，进行<strong>数据回显</strong></p>
<blockquote>
<p>根据讲师id查询所有讲师，实现数据回显</p>
</blockquote>
</li>
<li><p>通过路由跳转，进入数据回显页面，在路由index页面添加路由</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token punctuation">&#123;</span>
  path<span class="token operator">:</span> <span class="token string">'edit/:id'</span><span class="token punctuation">,</span>   
  name<span class="token operator">:</span> <span class="token string">'EduTeacherEdit'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/edu/teacher/save'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  meta<span class="token operator">:</span> <span class="token punctuation">&#123;</span> title<span class="token operator">:</span> <span class="token string">'编辑讲师'</span><span class="token punctuation">,</span> noCache<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  hidden<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">&#125;</span></code></pre>

<pre class="language-vue" data-language="vue"><code class="language-vue">&lt;router-link :to&#x3D;&quot;&#39;&#x2F;teacher&#x2F;edit&#x2F;&#39;+scope.row.id&quot;&gt;
  &lt;el-button type&#x3D;&quot;primary&quot; size&#x3D;&quot;mini&quot; icon&#x3D;&quot;el-icon-edit&quot;&gt;修改&lt;&#x2F;el-button&gt;
&lt;&#x2F;router-link&gt;
   </code></pre></li>
<li><p>在表单页面实现数据回显</p>
<ul>
<li><p>teacher.js中定义根据id查询接口</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">//根据id查询讲师</span>
<span class="token function">getTeacherInfo</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/eduservice/teacher/getTeacher/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        method<span class="token operator">:</span> <span class="token string">'get'</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>vue页面中调用接口，实现数据回显</p>
<pre class="language-vue" data-language="vue"><code class="language-vue">&#x2F;&#x2F;根据讲师id查询的方法
getInfo(id) &#123;
  teacherApi.getTeacherInfo(id)
    .then(response &#x3D;&gt; &#123;
      this.teacher &#x3D; response.data.teacher
    &#125;)
&#125;</code></pre></li>
<li><p>调用<strong>根据id查询</strong>方法</p>
<blockquote>
<p>由于”添加”和”修改”均使用save.vue页面，如何区别添加还是修改？</p>
<p>只有修改的时候才进行数据回显。</p>
<p>即：<strong>判断路径里是否有讲师id，如果有id为修改，否则为添加</strong></p>
</blockquote>
<pre class="language-vue" data-language="vue"><code class="language-vue">created() &#123; &#x2F;&#x2F;页面渲染之前执行
	this.init()
&#125;</code></pre>

<pre class="language-vue" data-language="vue"><code class="language-vue">methods:&#123;
    init() &#123;
      &#x2F;&#x2F;判断路径有id值,做修改
      if(this.$route.params &amp;&amp; this.$route.params.id) &#123;
          &#x2F;&#x2F;从路径获取id值
          const id &#x3D; this.$route.params.id
          &#x2F;&#x2F;调用根据id查询的方法
          this.getInfo(id)
      &#125; else &#123; &#x2F;&#x2F;路径没有id值，做添加
        &#x2F;&#x2F;清空表单
        this.teacher &#x3D; &#123;&#125;
      &#125;
    &#125;
&#125;</code></pre></li>
</ul>
</li>
</ol>
<h4 id="最终修改实现"><a href="#最终修改实现" class="headerlink" title="最终修改实现"></a>最终修改实现</h4><ol>
<li><p>在api的teacher.js定义修改接口</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">//修改讲师</span>
<span class="token function">updateTeacherInfo</span><span class="token punctuation">(</span><span class="token parameter">teacher</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/eduservice/teacher/updateTeacher</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        method<span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> teacher
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>在vue页面调用修改方法</p>
<pre class="language-vue" data-language="vue"><code class="language-vue">saveOrUpdate() &#123;
  &#x2F;&#x2F;判断修改还是添加
  &#x2F;&#x2F;根据teacher是否有id
  if(!this.teacher.id) &#123;
    &#x2F;&#x2F;添加
    this.saveTeacher()
  &#125; else &#123;
    &#x2F;&#x2F;修改
    this.updateTeacher()
  &#125;
&#125;</code></pre>

<pre class="language-vue" data-language="vue"><code class="language-vue">&#x2F;&#x2F;修改讲师的方法
updateTeacher() &#123;
  teacherApi.updateTeacherInfo(this.teacher)
    .then(response &#x3D;&gt; &#123;
      &#x2F;&#x2F;提示信息
      this.$message(&#123;
          type: &#39;success&#39;,
          message: &#39;修改成功!&#39;
      &#125;);
      &#x2F;&#x2F;回到列表页面 路由跳转
      this.$router.push(&#123;path:&#39;&#x2F;teacher&#x2F;table&#39;&#125;)
    &#125;)</code></pre></li>
</ol>
<h3 id="路由切换问题"><a href="#路由切换问题" class="headerlink" title="路由切换问题"></a>路由切换问题</h3><blockquote>
<p>第一次：点击”修改”，数据回显</p>
<p>第二次：再次点击”添加讲师”，进入表单页面，出现问题</p>
<p>问题：回显数据仍然存在，没有进行表单数据清空</p>
</blockquote>
<p>原因：</p>
<p><strong>多次路由跳转到同一页面，页面中的created()方法只执行一次，后续跳转不会执行</strong></p>
<p>解决方式：</p>
<p>添加讲师时，清空表单数据</p>
<pre class="language-vue" data-language="vue"><code class="language-vue">init() &#123;
  &#x2F;&#x2F;判断路径有id值,做修改
  if(this.$route.params &amp;&amp; this.$route.params.id) &#123;
      &#x2F;&#x2F;从路径获取id值
      const id &#x3D; this.$route.params.id
      &#x2F;&#x2F;调用根据id查询的方法
      this.getInfo(id)
  &#125; else &#123; &#x2F;&#x2F;路径没有id值，做添加
    &#x2F;&#x2F;清空表单
    this.teacher &#x3D; &#123;&#125;
  &#125;
&#125;</code></pre>

<p>最终解决：</p>
<p>使用vue监听</p>
<pre class="language-vue" data-language="vue"><code class="language-vue">watch: &#123;  &#x2F;&#x2F;监听
  $route(to, from) &#123; &#x2F;&#x2F;路由变化方式，路由发生变化，方法就会执行
    this.init()
  &#125;
&#125;</code></pre>

<h2 id="Day-6"><a href="#Day-6" class="headerlink" title="Day 6"></a>Day 6</h2><ol>
<li>添加讲师实现头像上传功能<ul>
<li>阿里云oss存储服务</li>
<li>Nginx使用</li>
</ul>
</li>
<li>添加课程分类功能<ul>
<li>使用EasyExcel，读取excel内容，添加数据</li>
</ul>
</li>
<li>课程分类列表<ul>
<li>树形结构显示</li>
</ul>
</li>
</ol>
<h3 id="阿里云oss"><a href="#阿里云oss" class="headerlink" title="阿里云oss"></a>阿里云oss</h3><h4 id="开发准备"><a href="#开发准备" class="headerlink" title="开发准备"></a>开发准备</h4><ol>
<li>在<a target="_blank" rel="noopener" href="https://www.aliyun.com/">阿里云</a>官网，找到对象存储OSS服务，开通</li>
<li>进入阿里云oss管理控制台，创建阿里云oss许可证(AccessKey)</li>
</ol>
<p>阿里云官方参考文档：<a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/32008.html">https://help.aliyun.com/document_detail/32008.html</a></p>
<h4 id="搭建项目环境"><a href="#搭建项目环境" class="headerlink" title="搭建项目环境"></a>搭建项目环境</h4><ol>
<li><p>在service创建子模块service_oss</p>
</li>
<li><p>service_oss中引入oss相关依赖</p>
<pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>
    <span class="token comment">&lt;!-- 阿里云oss依赖 --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.aliyun.oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>aliyun-sdk-oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token comment">&lt;!-- 日期工具栏依赖 --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>joda-time<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>joda-time<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span></code></pre></li>
<li><p>创建配置文件application.properties</p>
<pre class="language-properties" data-language="properties"><code class="language-properties"><span class="token comment">#服务端口</span>
<span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">8002</span>
<span class="token comment">#服务名</span>
<span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">service-oss</span>
<span class="token comment">#环境设置：dev、test、prod</span>
<span class="token attr-name">spring.profiles.active</span><span class="token punctuation">=</span><span class="token attr-value">dev</span>

<span class="token comment">#阿里云 OSS</span>
<span class="token comment">#不同的服务器，地址不同</span>
<span class="token attr-name">aliyun.oss.file.endpoint</span><span class="token punctuation">=</span>
<span class="token attr-name">aliyun.oss.file.keyid</span><span class="token punctuation">=</span>
<span class="token attr-name">aliyun.oss.file.keysecret</span><span class="token punctuation">=</span>
<span class="token comment">#bucket可以在控制台创建，也可以使用java代码创建</span>
<span class="token attr-name">aliyun.oss.file.bucketname</span><span class="token punctuation">=</span></code></pre></li>
<li><p>创建启动类，报错</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210510150354.png" alt="image-20210510150320703" loading="lazy"></p>
<p>原因：</p>
<p>启动时，SpringBoot会去寻找数据库配置，然而现在模块并不需要操作数据库，也没有配置数据库</p>
<p>解决方式：</p>
<ul>
<li><p>添加数据库配置</p>
</li>
<li><p><strong>在启动类添加注解属性，不加载数据库配置</strong>(使用这种方式)</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></code></pre></li>
</ul>
</li>
</ol>
<h4 id="上传文件接口实现"><a href="#上传文件接口实现" class="headerlink" title="上传文件接口实现"></a>上传文件接口实现</h4><ol>
<li><p>创建常量类，读取配置文件内容</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConstantPropertiesUtils</span> <span class="token keyword">implements</span> <span class="token class-name">InitializingBean</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">//读取配置文件内容</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;aliyun.oss.file.endpoint&#125;"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> endpoint<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;aliyun.oss.file.keyid&#125;"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> keyId<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;aliyun.oss.file.keysecret&#125;"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> keySecret<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;aliyun.oss.file.bucketname&#125;"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> bucketName<span class="token punctuation">;</span>

    <span class="token comment">//定义公开静态常量</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> END_POINT<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> ACCESS_KEY_ID<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> ACCESS_KEY_SECRET<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> BUCKET_NAME<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        END_POINT <span class="token operator">=</span> endpoint<span class="token punctuation">;</span>
        ACCESS_KEY_ID <span class="token operator">=</span> keyId<span class="token punctuation">;</span>
        ACCESS_KEY_SECRET <span class="token operator">=</span> keySecret<span class="token punctuation">;</span>
        BUCKET_NAME <span class="token operator">=</span> bucketName<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>创建controller service</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/eduoss/fileoss"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@CrossOrigin</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OssController</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">OssService</span> ossService<span class="token punctuation">;</span>

    <span class="token comment">//上传头像方法</span>
    <span class="token annotation punctuation">@PostMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">uploadOssFile</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//获取上传文件</span>
        <span class="token class-name">String</span> url <span class="token operator">=</span> ossService<span class="token punctuation">.</span><span class="token function">uploadFileAvatar</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span></code></pre>

<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@CrossOrigin</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OssServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OssService</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">//上传头像到oss</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">uploadFileAvatar</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//通过工具类获取值</span>
        <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token class-name">ConstantPropertiesUtils</span><span class="token punctuation">.</span>END_POINT <span class="token punctuation">;</span>
        <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token class-name">ConstantPropertiesUtils</span><span class="token punctuation">.</span>ACCESS_KEY_ID<span class="token punctuation">;</span>
        <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token class-name">ConstantPropertiesUtils</span><span class="token punctuation">.</span>ACCESS_KEY_SECRET<span class="token punctuation">;</span>
        <span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token class-name">ConstantPropertiesUtils</span><span class="token punctuation">.</span>BUCKET_NAME<span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 创建OSSClient实例。</span>
            <span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 获取上传文件输入流</span>
            <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 获取文件名称</span>
            <span class="token class-name">String</span> fileName <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 1 在文件名称中加入随机值(去掉-),防止重名</span>
            <span class="token class-name">String</span> uuid <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileName <span class="token operator">=</span> uuid <span class="token operator">+</span> fileName<span class="token punctuation">;</span>

            <span class="token comment">// 2 文件按照日期进行分类</span>
            <span class="token comment">// 获取当前日期</span>
            <span class="token class-name">String</span> datePath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">"yyyy/MM/dd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 拼接</span>
            fileName <span class="token operator">=</span> datePath <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> fileName<span class="token punctuation">;</span>

            <span class="token comment">// 调用oss方法实现上传</span>
            <span class="token comment">// 参数1 Bucket名称</span>
            <span class="token comment">// 参数2 上传到oss文件路径和文件名称</span>
            <span class="token comment">// 参数3 上传文件输入流</span>
            ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 关闭OSSClient。</span>
            ossClient<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 返回上传文件路径</span>
            <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"https://"</span> <span class="token operator">+</span> bucketName <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> endpoint <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> fileName<span class="token punctuation">;</span>

            <span class="token keyword">return</span> url<span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ol>
<h4 id="上传文件接口完善"><a href="#上传文件接口完善" class="headerlink" title="上传文件接口完善"></a>上传文件接口完善</h4><ol>
<li><p>问题：上传相同名称文件，造成文件覆盖</p>
<p>解决方式：文件名称添加随机唯一值UUID</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">// 1 在文件名称中加入随机值(去掉-),防止重名</span>
<span class="token class-name">String</span> uuid <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileName <span class="token operator">=</span> uuid <span class="token operator">+</span> fileName<span class="token punctuation">;</span></code></pre></li>
<li><p>文件分类管理</p>
<p>根据日期进行分类</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">// 2 文件按照日期进行分类</span>
<span class="token comment">// 获取当前日期</span>
<span class="token class-name">String</span> datePath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">"yyyy/MM/dd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 拼接</span>
fileName <span class="token operator">=</span> datePath <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> fileName<span class="token punctuation">;</span></code></pre></li>
</ol>
<h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h3><blockquote>
<p>反向代理服务器</p>
<ol>
<li>请求转发</li>
<li>负载均衡</li>
<li>动静分离</li>
</ol>
</blockquote>
<blockquote>
<p>注意：如果使用cmd命令行启动nginx，关闭命令行窗口，<strong>nginx并不会停止</strong></p>
<p>需要手动停止：<code>nginx.exe -s stop</code></p>
</blockquote>
<h4 id="什么是请求转发？"><a href="#什么是请求转发？" class="headerlink" title="什么是请求转发？"></a>什么是请求转发？</h4><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210512083008.png" alt="image-20210512083001349" loading="lazy"></p>
<h4 id="什么是负载均衡？"><a href="#什么是负载均衡？" class="headerlink" title="什么是负载均衡？"></a>什么是负载均衡？</h4><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210512083104.png" alt="image-20210512083104460" loading="lazy"></p>
<h4 id="配置nginx，实现请求转发"><a href="#配置nginx，实现请求转发" class="headerlink" title="配置nginx，实现请求转发"></a>配置nginx，实现请求转发</h4><ol>
<li><p>找到nginx配置文件nginx.conf</p>
</li>
<li><p>nginx.conf中进行配置</p>
<ul>
<li><p>修改nginx默认端口，把80改为81</p>
<pre class="language-none"><code class="language-none">   server &#123;
       listen       81;
       server_name  localhost;
&#125;</code></pre></li>
<li><p>配置nginx转发规则</p>
<p>在http {}里，新建配置</p>
<pre class="language-none"><code class="language-none">   server &#123;
       listen       9001;
       server_name  localhost;
     
       location ~ &#x2F;eduservice&#x2F; &#123;
           proxy_pass   http:&#x2F;&#x2F;localhost:8001;
       &#125;
     
       location ~ &#x2F;eduoss&#x2F; &#123;
           proxy_pass   http:&#x2F;&#x2F;localhost:8002;
       &#125;
&#125;</code></pre></li>
</ul>
</li>
<li><p>重启nginx，先停止后启动</p>
</li>
<li><p>修改前端请求地址，改为nginx地址</p>
<p>dev.env.js</p>
<pre class="language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>prodEnv<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
  <span class="token constant">NODE_ENV</span><span class="token operator">:</span> <span class="token string">'"development"'</span><span class="token punctuation">,</span>
  <span class="token constant">BASE_API</span><span class="token operator">:</span> <span class="token string">'"http://localhost:9001"'</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre></li>
</ol>
<h3 id="上传头像前端整合"><a href="#上传头像前端整合" class="headerlink" title="上传头像前端整合"></a>上传头像前端整合</h3><ol>
<li><p>在添加讲师页面，创建上传组件，实现上传</p>
<p>使用element-ui组件实现</p>
<p>在视频提供的源码里找到组件，复制到src\components</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210512084224.png" alt="image-20210512084224767" loading="lazy"></p>
</li>
<li><p>添加讲师页面使用此复制上传组件</p>
</li>
<li><p>使用组件</p>
<p>data()定义变量和初始值</p>
<pre class="language-vue" data-language="vue"><code class="language-vue">data() &#123;
      &#x2F;&#x2F;上传弹框组件是否显示
      imagecropperShow:false,
      imagecropperKey:0,&#x2F;&#x2F;上传组件key值
      BASE_API:process.env.BASE_API, &#x2F;&#x2F;获取dev.env.js里面地址
      saveBtnDisabled:false  &#x2F;&#x2F; 保存按钮是否禁用
&#125;</code></pre></li>
<li><p>引入组件和声明组件</p>
<pre class="language-vue" data-language="vue"><code class="language-vue">import ImageCropper from &#39;@&#x2F;components&#x2F;ImageCropper&#39;
import PanThumb from &#39;@&#x2F;components&#x2F;PanThumb&#39;</code></pre>

<pre class="language-vue" data-language="vue"><code class="language-vue">export default &#123;
  components: &#123; ImageCropper, PanThumb &#125;,
&#125;</code></pre></li>
<li><p>修改上传接口地址</p>
</li>
<li><p>编写close方法和上传成功的方法</p>
<pre class="language-vue" data-language="vue"><code class="language-vue">&lt;el-form-item label&#x3D;&quot;讲师头像&quot;&gt;
   
    &lt;!-- 头衔缩略图 --&gt;
    &lt;pan-thumb :image&#x3D;&quot;teacher.avatar&quot;&#x2F;&gt;
    &lt;!-- 文件上传按钮 --&gt;
    &lt;el-button type&#x3D;&quot;primary&quot; icon&#x3D;&quot;el-icon-upload&quot; @click&#x3D;&quot;imagecropperShow&#x3D;true&quot;&gt;更换头像
    &lt;&#x2F;el-button&gt;
   
    &lt;!--
    v-show：是否显示上传组件
    :key：类似于id，如果一个页面多个图片上传控件，可以做区分
    :url：后台上传的url地址
    @close：关闭上传组件
    @crop-upload-success：上传成功后的回调 
      &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;file&quot;&#x2F;&gt;
    --&gt;
    &lt;image-cropper
                  v-show&#x3D;&quot;imagecropperShow&quot;
                  :width&#x3D;&quot;300&quot;
                  :height&#x3D;&quot;300&quot;
                  :key&#x3D;&quot;imagecropperKey&quot;
                  :url&#x3D;&quot;BASE_API+&#39;&#x2F;eduoss&#x2F;fileoss&#39;&quot;
                  field&#x3D;&quot;file&quot;
                  @close&#x3D;&quot;close&quot;
                  @crop-upload-success&#x3D;&quot;cropSuccess&quot;&#x2F;&gt;
&lt;&#x2F;el-form-item&gt;</code></pre>

<pre class="language-vue" data-language="vue"><code class="language-vue">methods:&#123;
  close() &#123; &#x2F;&#x2F;关闭上传弹框的方法
      this.imagecropperShow&#x3D;false
      &#x2F;&#x2F;上传组件初始化
      this.imagecropperKey &#x3D; this.imagecropperKey+1
  &#125;,
  &#x2F;&#x2F;上传成功方法
  cropSuccess(data) &#123;
    this.imagecropperShow&#x3D;false
    &#x2F;&#x2F;上传之后接口返回图片地址
    this.teacher.avatar &#x3D; data.url
    this.imagecropperKey &#x3D; this.imagecropperKey+1
  &#125;,
&#125;</code></pre></li>
</ol>
<h3 id="课程分类存储结构"><a href="#课程分类存储结构" class="headerlink" title="课程分类存储结构"></a>课程分类存储结构</h3><p>假定有一级分类：前端开发、后端开发</p>
<p>二级分类：vue、js、java、c++</p>
<blockquote>
<p>数据库表如何存储二级分类？</p>
<p>使用parent_id字段。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210512090125.png" loading="lazy"></p>
<h3 id="EasyExcel读写操作"><a href="#EasyExcel读写操作" class="headerlink" title="EasyExcel读写操作"></a>EasyExcel读写操作</h3><h4 id="写操作"><a href="#写操作" class="headerlink" title="写操作"></a>写操作</h4><ol>
<li><p>引入easyexcel依赖</p>
<pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>
    <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/easyexcel --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>easyexcel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span></code></pre></li>
<li><p>创建实体类，与excel数据对应</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoData</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//设置excel表头名称</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"学生编号"</span><span class="token punctuation">,</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> sno<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"学生姓名"</span><span class="token punctuation">,</span>index <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> sname<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>实现写操作</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//实现excel写操作</span>
    <span class="token class-name">String</span> filename <span class="token operator">=</span> <span class="token string">"D:\\write.xlsx"</span><span class="token punctuation">;</span>
   
    <span class="token comment">//调用easyexcel实现写操作</span>
    <span class="token comment">//参数1 文件路径 参数2 实体类class</span>
    <span class="token class-name">EasyExcel</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span><span class="token class-name">DemoData</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sheet</span><span class="token punctuation">(</span><span class="token string">"学生列表"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doWrite</span><span class="token punctuation">(</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li>
</ol>
<h4 id="读操作"><a href="#读操作" class="headerlink" title="读操作"></a>读操作</h4><ol>
<li><p>创建excel对应实体类，标记对应列关系，同上</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoData</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//设置excel表头名称</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"学生编号"</span><span class="token punctuation">,</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> sno<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"学生姓名"</span><span class="token punctuation">,</span>index <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> sname<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>创建监听，读取excel文件</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExcelListener</span> <span class="token keyword">extends</span> <span class="token class-name">AnalysisEventListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DemoData</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>

    <span class="token comment">//逐行读取excel内容</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">DemoData</span> demoData<span class="token punctuation">,</span> <span class="token class-name">AnalysisContext</span> analysisContext<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"****"</span><span class="token operator">+</span>demoData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//读取表头内容</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">invokeHeadMap</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> headMap<span class="token punctuation">,</span> <span class="token class-name">AnalysisContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"表头:"</span><span class="token operator">+</span>headMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//读取完成之后</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doAfterAllAnalysed</span><span class="token punctuation">(</span><span class="token class-name">AnalysisContext</span> analysisContext<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>最终方法调用</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token comment">//实现excel读操作</span>
    <span class="token class-name">String</span> filename <span class="token operator">=</span> <span class="token string">"D:\\write.xlsx"</span><span class="token punctuation">;</span>
    <span class="token class-name">EasyExcel</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span><span class="token class-name">DemoData</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">ExcelListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ol>
<h4 id="读操作分类"><a href="#读操作分类" class="headerlink" title="读操作分类"></a>读操作分类</h4><ol>
<li><p>引入easyexcel依赖</p>
</li>
<li><p>使用代码生成器，生成课程分类代码</p>
</li>
<li><p>创建实体类，对应excel关系</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SubjectData</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> oneSubjectName<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> twoSubjectName<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>实现监听器</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SubjectExcelListener</span> <span class="token keyword">extends</span> <span class="token class-name">AnalysisEventListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SubjectData</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>

    <span class="token comment">//SubjectExcelListener不会交给Spring进行管理，需要自己new，也不能注入其他对象</span>
    <span class="token keyword">public</span> <span class="token class-name">EduSubjectService</span> subjectService<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">SubjectExcelListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">SubjectExcelListener</span><span class="token punctuation">(</span><span class="token class-name">EduSubjectService</span> subjectService<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>subjectService <span class="token operator">=</span> subjectService<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//逐行读取excel内容</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">SubjectData</span> subjectData<span class="token punctuation">,</span> <span class="token class-name">AnalysisContext</span> analysisContext<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>subjectData <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">GuliException</span><span class="token punctuation">(</span><span class="token number">20001</span><span class="token punctuation">,</span><span class="token string">"文件数据为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">//添加一级分类</span>
        <span class="token comment">//逐行读取时每次都有两个值，值1 一级分类，值2 二级分类</span>
        <span class="token comment">//先判断一级分类是否重复</span>
        <span class="token class-name">EduSubject</span> existOneSubject <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">existOneSubject</span><span class="token punctuation">(</span>subjectService<span class="token punctuation">,</span> subjectData<span class="token punctuation">.</span><span class="token function">getOneSubjectName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>existOneSubject <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            existOneSubject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EduSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            existOneSubject<span class="token punctuation">.</span><span class="token function">setParentId</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            existOneSubject<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>subjectData<span class="token punctuation">.</span><span class="token function">getOneSubjectName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            subjectService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>existOneSubject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">//获取一级分类id</span>
        <span class="token class-name">String</span> pid <span class="token operator">=</span> existOneSubject<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//添加二级分类</span>
        <span class="token class-name">EduSubject</span> existTwoSubject <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">existTwoSubject</span><span class="token punctuation">(</span>subjectService<span class="token punctuation">,</span> subjectData<span class="token punctuation">.</span><span class="token function">getTwoSubjectName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>existTwoSubject <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            existTwoSubject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EduSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            existTwoSubject<span class="token punctuation">.</span><span class="token function">setParentId</span><span class="token punctuation">(</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
            existTwoSubject<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>subjectData<span class="token punctuation">.</span><span class="token function">getTwoSubjectName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            subjectService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>existTwoSubject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//判断一级分类不能重复添加</span>
    <span class="token keyword">private</span> <span class="token class-name">EduSubject</span> <span class="token function">existOneSubject</span><span class="token punctuation">(</span><span class="token class-name">EduSubjectService</span> subjectService<span class="token punctuation">,</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EduSubject</span><span class="token punctuation">></span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"parent_id"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EduSubject</span> oneSubject <span class="token operator">=</span> subjectService<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> oneSubject<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//判断二级分类不能重复添加</span>
    <span class="token keyword">private</span> <span class="token class-name">EduSubject</span> <span class="token function">existTwoSubject</span><span class="token punctuation">(</span><span class="token class-name">EduSubjectService</span> subjectService<span class="token punctuation">,</span><span class="token class-name">String</span> name<span class="token punctuation">,</span><span class="token class-name">String</span> pid<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EduSubject</span><span class="token punctuation">></span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"parent_id"</span><span class="token punctuation">,</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EduSubject</span> twoSubject <span class="token operator">=</span> subjectService<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> twoSubject<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doAfterAllAnalysed</span><span class="token punctuation">(</span><span class="token class-name">AnalysisContext</span> analysisContext<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ol>
<h2 id="Day-7"><a href="#Day-7" class="headerlink" title="Day 7"></a>Day 7</h2><ol>
<li>添加课程分类前端实现</li>
<li>课程分类列表显示功能(树形)</li>
<li>课程管理模块需求</li>
<li>添加课程基本信息功能</li>
</ol>
<h3 id="添加课程分类前端实现"><a href="#添加课程分类前端实现" class="headerlink" title="添加课程分类前端实现"></a>添加课程分类前端实现</h3><ol>
<li><p>添加课程分类路由</p>
<p>router/index.js</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210512095144.png" alt="image-20210512095144003" loading="lazy"></p>
</li>
<li><p>创建课程分类页面，修改路由对应的页面路径</p>
<p>views/edu/subject/list.vue</p>
<p>views/edu/subject/save.vue</p>
</li>
<li><p>在添加课程分类页面，实现效果</p>
<p>save.vue添加上传组件</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210512095115.png" alt="image-20210512095056681" loading="lazy"></p>
</li>
</ol>
<h4 id="课程分类列表-树形显示"><a href="#课程分类列表-树形显示" class="headerlink" title="课程分类列表-树形显示"></a>课程分类列表-树形显示</h4><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210512095241.png" alt="image-20210512095240960" loading="lazy"></p>
<ol>
<li><p>参考tree模块，整合前端</p>
<p>TODO: 创建接口，把分类按照要求的格式返回数据</p>
<pre class="language-vue" data-language="vue"><code class="language-vue">data() &#123;
  return &#123;
    filterText: &#39;&#39;,
    data2: [&#123;
      id: 1,
      label: &#39;Level one 1&#39;,
      children: [&#123;
        id: 4,
        label: &#39;Level two 1-1&#39;,
        children: [&#123;
          id: 9,
          label: &#39;Level three 1-1-1&#39;
        &#125;, &#123;
          id: 10,
          label: &#39;Level three 1-1-2&#39;
        &#125;]
      &#125;]
    &#125;, &#123;
      id: 2,
      label: &#39;Level one 2&#39;,
      children: [&#123;
        id: 5,
        label: &#39;Level two 2-1&#39;
      &#125;, &#123;
        id: 6,
        label: &#39;Level two 2-2&#39;
      &#125;]
    &#125;, &#123;
      id: 3,
      label: &#39;Level one 3&#39;,
      children: [&#123;
        id: 7,
        label: &#39;Level two 3-1&#39;
      &#125;, &#123;
        id: 8,
        label: &#39;Level two 3-2&#39;
      &#125;]
    &#125;],
    defaultProps: &#123;
      children: &#39;children&#39;,
      label: &#39;label&#39;
    &#125;
  &#125;
&#125;</code></pre></li>
<li><p>针对返回数据创建对应实体类</p>
<p>两个实体类：一级分类 二级分类</p>
</li>
<li><p>在两个实体类之间表示关系(一级分类包含多个二级分类)</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//一级分类 实体类</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OneSubject</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>

    <span class="token comment">//一级分类包含多个二级分类</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TwoSubject</span><span class="token punctuation">></span></span> children <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>编写具体封装代码</p>
<p><code>List&lt;EduSubject&gt; oneSubjectList</code> ===&gt; <code>List&lt;OneSubject&gt; finalSubjectList</code></p>
</li>
</ol>
<h3 id="课程发布流程"><a href="#课程发布流程" class="headerlink" title="课程发布流程"></a>课程发布流程</h3><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210513160821.png" alt="image-20210513160814175" loading="lazy"></p>
<p>细节：</p>
<ol>
<li><p>创建vo实体类，用于封装表单数据</p>
</li>
<li><p>把表单提交的数据添加至数据库</p>
<p>向两张表添加：课程表和课程描述表</p>
</li>
<li><p>把”讲师”和”分类”用列表显示</p>
<p>“分类”用二级联动效果实现(类似于 xx省 xx市 的关系效果)</p>
</li>
</ol>
<h3 id="课程相关表的关系"><a href="#课程相关表的关系" class="headerlink" title="课程相关表的关系"></a>课程相关表的关系</h3><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210513161224.png" alt="image-20210513161224510" loading="lazy"></p>
<h3 id="添加课程基本信息接口"><a href="#添加课程基本信息接口" class="headerlink" title="添加课程基本信息接口"></a>添加课程基本信息接口</h3><ol>
<li>使用代码生成器生成课程相关代码</li>
<li>创建vo类，封装表单提交的数据</li>
<li>编写 controller service</li>
</ol>
<p>注意：课程描述表对应id需要修改生成策略</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EduCourseDescription</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"课程ID"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>INPUT<span class="token punctuation">)</span> <span class="token comment">//手动设置id</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="添加课程基本信息前端"><a href="#添加课程基本信息前端" class="headerlink" title="添加课程基本信息前端"></a>添加课程基本信息前端</h3><ol>
<li><p>添加课程管理路由</p>
<p>该路由为<strong>隐藏路由</strong>，实现页面跳转</p>
</li>
<li><p>编写表单页面，实现接口</p>
</li>
<li><p>添加完成后返回课程id，便于之后添加大纲</p>
<p>参照后端接口部分：</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//添加课程基本信息</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"addCourseInfo"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">addCourseInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">CourseInfoVo</span> courseInfoVo<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token comment">//返回添加之后的课程id</span>
    <span class="token class-name">String</span> id <span class="token operator">=</span> courseService<span class="token punctuation">.</span><span class="token function">saveCourseInfo</span><span class="token punctuation">(</span>courseInfoVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"courseId"</span><span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ol>
<h3 id="二级联动显示"><a href="#二级联动显示" class="headerlink" title="二级联动显示"></a>二级联动显示</h3><pre class="language-none"><code class="language-none">&#x2F;&#x2F;点击某个一级分类，触发change，显示对应二级分类
      subjectLevelOneChanged(value) &#123;
          &#x2F;&#x2F;value就是一级分类id值
          &#x2F;&#x2F;遍历所有的分类，包含一级和二级
          for(var i&#x3D;0;i&lt;this.subjectOneList.length;i++) &#123;
              &#x2F;&#x2F;每个一级分类
              var oneSubject &#x3D; this.subjectOneList[i]
              &#x2F;&#x2F;判断：所有一级分类id 和 点击一级分类id是否一样
              if(value &#x3D;&#x3D;&#x3D; oneSubject.id) &#123;
                  &#x2F;&#x2F;从一级分类获取里面所有的二级分类
                  this.subjectTwoList &#x3D; oneSubject.children
                  &#x2F;&#x2F;把二级分类id值清空
                  this.courseInfo.subjectId &#x3D; &#39;&#39;
              &#125;
          &#125;
      &#125;,</code></pre>



<h2 id="Day-8"><a href="#Day-8" class="headerlink" title="Day 8"></a>Day 8</h2><ol>
<li><p>添加课程基本信息 完善</p>
<p>整合文本编辑器</p>
<p>修改课程基本信息功能 实现</p>
</li>
<li><p>课程大纲管理</p>
<p>课程大纲列表显示</p>
<p>章节添加 修改 删除</p>
<p>小节添加 修改 删除</p>
</li>
<li><p>课程信息确认</p>
<p>编写sql语句实现</p>
<p>课程最终发布</p>
</li>
</ol>
<h3 id="整合文本编辑器"><a href="#整合文本编辑器" class="headerlink" title="整合文本编辑器"></a>整合文本编辑器</h3><ol>
<li><p>复制文本编辑器组件至项目路径</p>
</li>
<li><p>build/webpack.dev.conf.js添加配置</p>
<pre class="language-js" data-language="js"><code class="language-js">plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token string">'process.env'</span><span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../config/dev.env'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// https://github.com/ampedandwired/html-webpack-plugin</span>
  <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    filename<span class="token operator">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span>
    template<span class="token operator">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span>
    inject<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    favicon<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'favicon.ico'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    title<span class="token operator">:</span> <span class="token string">'vue-admin-template'</span><span class="token punctuation">,</span>
    templateParameters<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token constant">BASE_URL</span><span class="token operator">:</span> config<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>assetsPublicPath <span class="token operator">+</span> config<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>assetsSubDirectory
   <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span></code></pre></li>
<li><p>index.html引入脚本文件</p>
<pre class="language-html" data-language="html"><code class="language-html">&lt;script src=&lt;%= BASE_URL %><span class="token script"><span class="token language-javascript"><span class="token operator">/</span>tinymce4<span class="token punctuation">.</span><span class="token number">7.5</span><span class="token operator">/</span>tinymce<span class="token punctuation">.</span>min<span class="token punctuation">.</span>js<span class="token operator">></span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
&lt;script src=&lt;%= BASE_URL %><span class="token script"><span class="token language-javascript"><span class="token operator">/</span>tinymce4<span class="token punctuation">.</span><span class="token number">7.5</span><span class="token operator">/</span>langs<span class="token operator">/</span>zh_CN<span class="token punctuation">.</span>js<span class="token operator">></span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre></li>
<li><p>使用文本编辑器组件</p>
<pre class="language-vue" data-language="vue"><code class="language-vue">import Tinymce from &#39;@&#x2F;components&#x2F;Tinymce&#39; &#x2F;&#x2F;引入组件

export default &#123;
    &#x2F;&#x2F;声明组件
    components: &#123; Tinymce &#125;,
	...
&#125;</code></pre>

<p>利用标签实现文本编辑器组件</p>
<pre class="language-vue" data-language="vue"><code class="language-vue">&lt;!-- 课程简介--&gt;
&lt;el-form-item label&#x3D;&quot;课程简介&quot;&gt;
    &lt;tinymce :height&#x3D;&quot;300&quot; v-model&#x3D;&quot;courseInfo.description&quot;&#x2F;&gt;
&lt;&#x2F;el-form-item&gt;</code></pre></li>
</ol>
<h3 id="课程大纲列表功能"><a href="#课程大纲列表功能" class="headerlink" title="课程大纲列表功能"></a>课程大纲列表功能</h3><p>参考 Day 7 课程分类列表</p>
<ol>
<li><p>创建两个实体类 章节 小节</p>
<p>章节实体类中，使用list表示小节</p>
</li>
<li><p>编写封装代码</p>
</li>
<li><p>前端整合</p>
</li>
</ol>
<h3 id="课程信息修改功能"><a href="#课程信息修改功能" class="headerlink" title="课程信息修改功能"></a>课程信息修改功能</h3><h4 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h4><ol>
<li>点击 上一步，回显课程基本信息数据</li>
<li>在数据回显页面，修改数据，保存，数据库内容也进行修改</li>
</ol>
<h4 id="后端接口"><a href="#后端接口" class="headerlink" title="后端接口"></a>后端接口</h4><ol>
<li><p>根据课程id查询课程基本信息接口</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//根据课程id查询课程信息</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"getCourseInfo/&#123;courseId&#125;"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">getCourseInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> courseId<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">CourseInfoVo</span> courseInfoVo <span class="token operator">=</span> courseService<span class="token punctuation">.</span><span class="token function">getCourseInfo</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"courseInfoVo"</span><span class="token punctuation">,</span>courseInfoVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>修改课程信息接口</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//修改课程信息</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"updateCourseInfo"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">updateCourseInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">CourseInfoVo</span> courseInfoVo<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    courseService<span class="token punctuation">.</span><span class="token function">updateCourseInfo</span><span class="token punctuation">(</span>courseInfoVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ol>
<h4 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h4><ol>
<li><p>api中course.js定义两个方法</p>
</li>
<li><p>修改chapter页面，跳转路径</p>
</li>
<li><p>info页面实现数据回显</p>
<p>获取路由课程id，调用根据id查询接口，显示数据</p>
</li>
</ol>
<h3 id="章节添加-修改-删除"><a href="#章节添加-修改-删除" class="headerlink" title="章节添加 修改 删除"></a>章节添加 修改 删除</h3><h4 id="添加"><a href="#添加" class="headerlink" title="添加"></a>添加</h4><p>点击 添加章节 按钮，弹出添加框，输入章节信息，点击 保存</p>
<h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><ol>
<li><p>如果章节无小节，直接删除</p>
</li>
<li><p>如果章节有小节，如何删除？</p>
<ul>
<li><p>删除章节，小节全部删除</p>
</li>
<li><p>若存在小节，不允许删除</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">deleteChapter</span><span class="token punctuation">(</span><span class="token class-name">String</span> chapterId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//根据章节id查询小节，如果有数据，则不删除</span>
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EduVideo</span><span class="token punctuation">></span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"chapter_id"</span><span class="token punctuation">,</span>chapterId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> count <span class="token operator">=</span> videoService<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//判断</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">GuliException</span><span class="token punctuation">(</span><span class="token number">20001</span><span class="token punctuation">,</span><span class="token string">"不能删除"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//删除章节</span>
        <span class="token keyword">int</span> result <span class="token operator">=</span> baseMapper<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>chapterId<span class="token punctuation">)</span><span class="token punctuation">;</span>
     
        <span class="token keyword">return</span> result <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//简写</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ul>
</li>
</ol>
<h3 id="课程信息确认"><a href="#课程信息确认" class="headerlink" title="课程信息确认"></a>课程信息确认</h3><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210513171635.png" alt="image-20210513171634905" loading="lazy"></p>
<p>这些数据需要查询多张表，一般编写sql语句来实现</p>
<p>即：<strong>多表连接查询</strong></p>
<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">--sql语句：根据课程id查询课程确认信息--></span>
<span class="token operator">&lt;</span><span class="token keyword">select</span> id<span class="token operator">=</span><span class="token string">"getPublishCourseInfo"</span> resultType<span class="token operator">=</span><span class="token string">"com.atguigu.eduservice.entity.vo.CoursePublishVo"</span><span class="token operator">></span>
    <span class="token keyword">SELECT</span> ec<span class="token punctuation">.</span>id<span class="token punctuation">,</span>ec<span class="token punctuation">.</span>title<span class="token punctuation">,</span>ec<span class="token punctuation">.</span>price<span class="token punctuation">,</span>ec<span class="token punctuation">.</span>lesson_num <span class="token keyword">AS</span> lessonNum<span class="token punctuation">,</span>ec<span class="token punctuation">.</span>cover<span class="token punctuation">,</span>
           et<span class="token punctuation">.</span>name <span class="token keyword">AS</span> teacherName<span class="token punctuation">,</span>
           es1<span class="token punctuation">.</span>title <span class="token keyword">AS</span> subjectLevelOne<span class="token punctuation">,</span>
           es2<span class="token punctuation">.</span>title <span class="token keyword">AS</span> subjectLevelTwo
    <span class="token keyword">FROM</span> edu_course ec <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> edu_course_description ecd <span class="token keyword">ON</span> ec<span class="token punctuation">.</span>id<span class="token operator">=</span>ecd<span class="token punctuation">.</span>id
                       <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> edu_teacher et <span class="token keyword">ON</span> ec<span class="token punctuation">.</span>teacher_id<span class="token operator">=</span>et<span class="token punctuation">.</span>id
                       <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> edu_subject es1 <span class="token keyword">ON</span> ec<span class="token punctuation">.</span>subject_parent_id<span class="token operator">=</span>es1<span class="token punctuation">.</span>id
                       <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> edu_subject es2 <span class="token keyword">ON</span> ec<span class="token punctuation">.</span>subject_id<span class="token operator">=</span>es2<span class="token punctuation">.</span>id
    <span class="token keyword">WHERE</span> ec<span class="token punctuation">.</span>id<span class="token operator">=</span><span class="token comment">#&#123;courseId&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">select</span><span class="token operator">></span></code></pre>

<h4 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h4><p>在mapper包创建xml文件编写sql语句，执行后出现错误</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210513172053.png" alt="image-20210513172053701" loading="lazy"></p>
<p>原因：</p>
<p>maven默认加载机制问题。</p>
<blockquote>
<p>maven加载时，只对src/main/java文件夹里的*.java文件进行编译，其他类型文件不加载</p>
</blockquote>
<p>解决方式：</p>
<ol>
<li><p>xml文件复制到target目录</p>
</li>
<li><p>xml文件放到resources目录</p>
</li>
<li><p>修改配置</p>
<ul>
<li><p>pom.xml</p>
<pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- 项目打包时会将java目录中的*.xml文件也进行打包 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>src/main/java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>**/*.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filtering</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filtering</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span></code></pre></li>
<li><p>application.properties</p>
<pre class="language-properties" data-language="properties"><code class="language-properties"><span class="token comment">#配置mapper xml文件的路径</span>
<span class="token attr-name">mybatis-plus.mapper-locations</span><span class="token punctuation">=</span><span class="token attr-value">classpath:com/atguigu/eduservice/mapper/xml/*.xml</span></code></pre></li>
</ul>
</li>
</ol>
<h2 id="Day-9"><a href="#Day-9" class="headerlink" title="Day 9"></a>Day 9</h2><ol>
<li>课程最终发布 实现<ul>
<li>课程信息确认</li>
<li>课程发布</li>
</ul>
</li>
<li>课程列表<ul>
<li>课程列表显示</li>
<li>课程删除</li>
</ul>
</li>
<li>阿里云视频点播服务</li>
<li>添加小节实现视频上传</li>
</ol>
<h3 id="课程列表功能"><a href="#课程列表功能" class="headerlink" title="课程列表功能"></a>课程列表功能</h3><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210513172841.png" alt="image-20210513172840999" loading="lazy"></p>
<h3 id="课程删除"><a href="#课程删除" class="headerlink" title="课程删除"></a>课程删除</h3><p>课程包含课程描述、章节、小节、视频</p>
<p>删除课程，把上述部分全部删除</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210513173140.png" alt="image-20210513173140371" loading="lazy"></p>
<blockquote>
<p>外键一般不建议声明出来</p>
</blockquote>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeCourse</span><span class="token punctuation">(</span><span class="token class-name">String</span> courseId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//1 根据课程id删除小节</span>
    eduVideoService<span class="token punctuation">.</span><span class="token function">removeVideoByCourseId</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//2 根据课程id删除章节</span>
    chapterService<span class="token punctuation">.</span><span class="token function">removeChapterByCourseId</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//3 根据课程id删除描述</span>
    courseDescriptionService<span class="token punctuation">.</span><span class="token function">removeById</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//4 根据课程id删除课程本身</span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> baseMapper<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">GuliException</span><span class="token punctuation">(</span><span class="token number">20001</span><span class="token punctuation">,</span><span class="token string">"删除失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="阿里云视频点播"><a href="#阿里云视频点播" class="headerlink" title="阿里云视频点播"></a>阿里云视频点播</h3><ol>
<li>阿里云开通视频点播服务，选择按流量计费</li>
<li>视频点播官方文档：<a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/51512.html">https://help.aliyun.com/document_detail/51512.html</a><ul>
<li>服务端：后端接口</li>
<li>客户端：浏览器、Android、ios</li>
<li>API：阿里云提供的固定地址，只需调用这个固定地址，并向地址传递参数，就可以实现某些功能</li>
<li>SDK：<strong>对API方式进行封装，更方便使用</strong>。例如EasyExcel调用阿里云提供的类或接口中方法实现某些功能</li>
<li>HttpClient 技术使得可以调用API地址<code>http://vod.cn-shanghai.aliyuncs.com?Action=GetPlayInfo&amp;VideoId=114514</code></li>
</ul>
</li>
</ol>
<h4 id="SDK-获取视频地址和凭证"><a href="#SDK-获取视频地址和凭证" class="headerlink" title="SDK 获取视频地址和凭证"></a>SDK 获取视频地址和凭证</h4><ol>
<li>获取视频播放地址</li>
<li>获取视频播放凭证</li>
<li>上传到阿里云视频点播服务</li>
</ol>
<blockquote>
<p>阿里云对上传视频可以进行加密，此后使用地址不能播放视频，所以<strong>数据库不是存储地址，而是存储视频id</strong></p>
</blockquote>
<ol>
<li><p>在 service 创建子模块 service_vod，引入相关依赖</p>
<pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>aliyun-java-sdk-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.aliyun.oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>aliyun-sdk-oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>aliyun-java-sdk-vod<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>aliyun-sdk-vod-upload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.json<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>json<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.google.code.gson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>gson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>joda-time<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>joda-time<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span></code></pre></li>
<li><p>初始化操作，创建DefaultAcsClient对象(test目录)</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">DefaultAcsClient</span> <span class="token function">initVodClient</span><span class="token punctuation">(</span><span class="token class-name">String</span> accessKeyId<span class="token punctuation">,</span> <span class="token class-name">String</span> accessKeySecret<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClientException</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">String</span> regionId <span class="token operator">=</span> <span class="token string">"cn-shanghai"</span><span class="token punctuation">;</span>  <span class="token comment">// 点播服务接入区域</span>
    <span class="token class-name">DefaultProfile</span> profile <span class="token operator">=</span> <span class="token class-name">DefaultProfile</span><span class="token punctuation">.</span><span class="token function">getProfile</span><span class="token punctuation">(</span>regionId<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DefaultAcsClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultAcsClient</span><span class="token punctuation">(</span>profile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> client<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>根据视频id，获取视频播放地址</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getPlayUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClientException</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//1 根据视频id获取视频地址</span>
    <span class="token comment">//创建初始化对象</span>
    <span class="token class-name">DefaultAcsClient</span> client <span class="token operator">=</span> <span class="token class-name">InitObject</span><span class="token punctuation">.</span><span class="token function">initVodClient</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//创建获取视频地址request response</span>
    <span class="token class-name">GetPlayInfoRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetPlayInfoRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">GetPlayInfoResponse</span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetPlayInfoResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//向request对象设置视频id</span>
    request<span class="token punctuation">.</span><span class="token function">setVideoId</span><span class="token punctuation">(</span><span class="token string">"a60bc97edc9045618980a758a4f895c8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//调用初始化对象里面的方法，传递request，获取数据</span>
    response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getAcsResponse</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GetPlayInfoResponse<span class="token punctuation">.</span>PlayInfo</span><span class="token punctuation">></span></span> playInfoList <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getPlayInfoList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//播放地址</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">GetPlayInfoResponse<span class="token punctuation">.</span>PlayInfo</span> playInfo <span class="token operator">:</span> playInfoList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"PlayInfo.PlayURL = "</span> <span class="token operator">+</span> playInfo<span class="token punctuation">.</span><span class="token function">getPlayURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//Base信息</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"VideoBase.Title = "</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">getVideoBase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>根据视频id，获取视频播放凭证</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getPlayAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClientException</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//根据视频id获取视频播放凭证</span>
    <span class="token comment">//创建初始化对象</span>
    <span class="token class-name">DefaultAcsClient</span> client <span class="token operator">=</span> <span class="token class-name">InitObject</span><span class="token punctuation">.</span><span class="token function">initVodClient</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//创建获取视频凭证request和response</span>
    <span class="token class-name">GetVideoPlayAuthRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetVideoPlayAuthRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">GetVideoPlayAuthResponse</span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetVideoPlayAuthResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//向request对象设置视频id</span>
    request<span class="token punctuation">.</span><span class="token function">setVideoId</span><span class="token punctuation">(</span><span class="token string">"a60bc97edc9045618980a758a4f895c8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getAcsResponse</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"playauth:"</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">getPlayAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ol>
<h4 id="SDK-上传视频"><a href="#SDK-上传视频" class="headerlink" title="SDK 上传视频"></a>SDK 上传视频</h4><blockquote>
<p>注意：aliyun-java-vod-upload的jar依赖并未开源，需要到<a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/51992.html">官网SDK</a>下载jar包，并安装到本地maven仓库</p>
</blockquote>
<p>通过官方jar包中自带的<code>UploadVideoDemo.java</code>文件，改造想要的功能</p>
<ol>
<li><p>引入依赖</p>
</li>
<li><p>创建 application.properties 配置文件</p>
</li>
<li><p>创建启动类</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"com.atguigu"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VodApplication</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">VodApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>创建controller service</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/eduvod/video"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@CrossOrigin</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VodController</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">VodService</span> vodService<span class="token punctuation">;</span>

    <span class="token comment">//上传视频到阿里云</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"uploadAliVideo"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">uploadAliVideo</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//返回上传视频的id</span>
        <span class="token class-name">String</span> videoId <span class="token operator">=</span> vodService<span class="token punctuation">.</span><span class="token function">uploadVideoAli</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"videoId"</span><span class="token punctuation">,</span>videoId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VodServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">VodService</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">uploadVideoAli</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">//accessKeyId, accessKeySecret</span>

            <span class="token comment">//fileName 上传文件原始名称</span>
            <span class="token class-name">String</span> fileName <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//title 上传之后的名称</span>
            <span class="token class-name">String</span> title <span class="token operator">=</span> fileName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>fileName<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//inputStream 上传文件输入流</span>
            <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">UploadStreamRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UploadStreamRequest</span><span class="token punctuation">(</span><span class="token class-name">ConstantVodUtils</span><span class="token punctuation">.</span>ACCESS_KEY_ID<span class="token punctuation">,</span> <span class="token class-name">ConstantVodUtils</span><span class="token punctuation">.</span>ACCESS_KEY_SECRET<span class="token punctuation">,</span> title<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">UploadVideoImpl</span> uploader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UploadVideoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">UploadStreamResponse</span> response <span class="token operator">=</span> uploader<span class="token punctuation">.</span><span class="token function">uploadStream</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">String</span> videoId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                videoId <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getVideoId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token comment">//如果设置回调URL无效，不影响视频上传，可以返回VideoId同时会返回错误码。其他情况上传失败时，VideoId为空，此时需要根据返回错误码分析具体错误原因</span>
                videoId <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getVideoId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token keyword">return</span> videoId<span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>测试，出现tomcat上传大小问题</p>
<ul>
<li><p>解决方式：</p>
<p>在application.properties中进行配置</p>
<pre class="language-none"><code class="language-none"># 最大上传单个文件大小：默认1M
spring.servlet.multipart.max-file-size&#x3D;1024MB
# 最大置总上传的数据大小 ：默认10M
spring.servlet.multipart.max-request-size&#x3D;1024MB</code></pre></li>
</ul>
</li>
<li><p>前端同样出现问题</p>
<ul>
<li><p>在nginx.conf配置8003端口规则</p>
<pre class="language-none"><code class="language-none">location ~ &#x2F;eduvod&#x2F; &#123;
          proxy_pass   http:&#x2F;&#x2F;localhost:8003;
      &#125;</code></pre></li>
<li><p>nginx支持的上传大小有限制</p>
<blockquote>
<p><code>POST http://localhost:9001/eduvod/video/uploadAliVideo 413(Request Entity Too Large)</code></p>
<p>413：即请求体过大</p>
</blockquote>
<p>在nginx.conf中添加大小设置</p>
<pre class="language-none"><code class="language-none">http &#123;
    include       mime.types;
    default_type  application&#x2F;octet-stream;
    client_max_body_size 1024m;
    ...
&#125;</code></pre></li>
</ul>
</li>
</ol>
<h2 id="Day-10"><a href="#Day-10" class="headerlink" title="Day 10"></a>Day 10</h2><ol>
<li>添加小节删除视频(包括阿里云视频)</li>
<li>springcloud<ul>
<li>删除小节删除视频</li>
<li>删除课程删除视频</li>
</ul>
</li>
</ol>
<h3 id="添加小节删除视频"><a href="#添加小节删除视频" class="headerlink" title="添加小节删除视频"></a>添加小节删除视频</h3><ol>
<li><p>删除阿里云视频接口</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//根据视频id删除阿里云视频</span>
<span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">"removeAliVideo/&#123;id&#125;"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">removeAliVideo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//初始化对象</span>
        <span class="token class-name">DefaultAcsClient</span> client <span class="token operator">=</span> <span class="token class-name">InitVodClient</span><span class="token punctuation">.</span><span class="token function">initVodClient</span><span class="token punctuation">(</span><span class="token class-name">ConstantVodUtils</span><span class="token punctuation">.</span>ACCESS_KEY_ID<span class="token punctuation">,</span> <span class="token class-name">ConstantVodUtils</span><span class="token punctuation">.</span>ACCESS_KEY_SECRET<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建删除视频request对象</span>
        <span class="token class-name">DeleteVideoRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeleteVideoRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//向request设置视频id</span>
        request<span class="token punctuation">.</span><span class="token function">setVideoIds</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//调用初始化对象方法实现删除</span>
        client<span class="token punctuation">.</span><span class="token function">getAcsResponse</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">GuliException</span><span class="token punctuation">(</span><span class="token number">20001</span><span class="token punctuation">,</span><span class="token string">"删除视频失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>前端页面调用接口</p>
<ul>
<li><p>在api定义接口路径</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">//删除视频</span>
<span class="token function">deleteAliyunvod</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        url<span class="token operator">:</span> <span class="token string">'/eduvod/video/removeAliVideo/'</span><span class="token operator">+</span>id<span class="token punctuation">,</span>
        method<span class="token operator">:</span> <span class="token string">'delete'</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>chapter.vue页面调用</p>
<pre class="language-vue" data-language="vue"><code class="language-vue">handleVodRemove() &#123;
    &#x2F;&#x2F;调用接口的删除视频的方法
    video.deleteAliyunvod(this.video.videoSourceId)
        .then(response &#x3D;&gt; &#123;
            &#x2F;&#x2F;提示信息
            this.$message(&#123;
                type: &#39;success&#39;,
                message: &#39;删除视频成功!&#39;
            &#125;);
            &#x2F;&#x2F;把文件列表清空
            this.fileList &#x3D; []
            &#x2F;&#x2F;把video视频id和视频名称值清空
            &#x2F;&#x2F;上传视频id赋值
            this.video.videoSourceId &#x3D; &#39;&#39;
            &#x2F;&#x2F;上传视频名称赋值
            this.video.videoOriginalName &#x3D; &#39;&#39;
        &#125;)
&#125;,</code></pre></li>
</ul>
</li>
</ol>
<h3 id="微服务与SpringCloud"><a href="#微服务与SpringCloud" class="headerlink" title="微服务与SpringCloud"></a>微服务与SpringCloud</h3><h4 id="微服务"><a href="#微服务" class="headerlink" title="微服务"></a>微服务</h4><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210517145854.png" alt="image-20210517145847399" loading="lazy"></p>
<ol>
<li><p>微服务是架构风格</p>
</li>
<li><p>把一个项目拆分成独立的多个服务</p>
<p>多个服务独立运行，每个服务占用独立进程</p>
</li>
</ol>
<h4 id="SpringCloud"><a href="#SpringCloud" class="headerlink" title="SpringCloud"></a>SpringCloud</h4><ol>
<li>SpringCloud并不是一种技术，而是多种技术总称，多种框架集合</li>
<li>使用SpringCloud这些框架，实现微服务操作</li>
<li>使用SpringCloud，需要依赖技术SpringBoot</li>
</ol>
<blockquote>
<p>SpringCloud相关基础服务组件</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210517150224.png" alt="image-20210517150224097" loading="lazy"></p>
<h3 id="Nacos"><a href="#Nacos" class="headerlink" title="Nacos"></a>Nacos</h3><blockquote>
<p>Nacos是注册中心，相当于房产中介</p>
<p>若要实现不同微服务模块之间的调用，需把这些模块注册到注册中心，此后实现相互调用</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210517150617.png" alt="image-20210517150617343" loading="lazy"></p>
<h4 id="Nacos流程"><a href="#Nacos流程" class="headerlink" title="Nacos流程"></a>Nacos流程</h4><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210517150707.png" alt="image-20210517150707275" loading="lazy"></p>
<h4 id="Nacos注册过程"><a href="#Nacos注册过程" class="headerlink" title="Nacos注册过程"></a>Nacos注册过程</h4><blockquote>
<p>访问nacos：</p>
<p><a target="_blank" rel="noopener" href="http://localhost:8848/nacos">http://localhost:8848/nacos</a></p>
<p>用户名：nacos</p>
<p>密码：nacos</p>
</blockquote>
<ol>
<li><p>service的pom引入依赖</p>
<pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.2.5.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-ribbon<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre></li>
<li><p>在注册服务的配置文件application.properties中，配置Nacos地址</p>
<pre class="language-properties" data-language="properties"><code class="language-properties"><span class="token comment"># nacos服务地址</span>
<span class="token attr-name">spring.cloud.nacos.discovery.server-addr</span><span class="token punctuation">=</span><span class="token attr-value">127.0.0.1:8848</span></code></pre></li>
<li><p>在主启动类添加注解<code>@EnableDiscoveryClient</code></p>
</li>
<li><p>访问Nacos控制台的服务列表，查看是否注册成功</p>
</li>
</ol>
<h3 id="OpenFeign"><a href="#OpenFeign" class="headerlink" title="OpenFeign"></a>OpenFeign</h3><h4 id="服务调用实现过程"><a href="#服务调用实现过程" class="headerlink" title="服务调用实现过程"></a>服务调用实现过程</h4><blockquote>
<p>前提：需要互相调用的服务在Nacos进行注册</p>
</blockquote>
<ol>
<li><p>service模块引入依赖</p>
<pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!--服务调用--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre></li>
<li><p>调用端service-edu，主启动类添加注解<code>@EnableFeignClients</code></p>
</li>
<li><p>调用端service-edu，创建interface，使用注解指定调用的服务名称，指定调用的方法路径(<strong>绝对路径</strong>)</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"service-vod"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">VodClient</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">//定义调用的方法路径</span>
    <span class="token comment">//@PathVariable注解一定要指定参数名称，否则出错</span>
    <span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">"/eduvod/video/removeAlyVideo/&#123;id&#125;"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">removeAlyVideo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>实现删除小节，同时删除阿里云视频</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//删除小节</span>
<span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">"&#123;id&#125;"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">deleteVideo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token comment">//参数为小节id，需要根据小节id，得到视频id</span>
    <span class="token class-name">EduVideo</span> eduVideo <span class="token operator">=</span> videoService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> videoSourceId <span class="token operator">=</span> eduVideo<span class="token punctuation">.</span><span class="token function">getVideoSourceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//判断小节里是否有视频id</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>videoSourceId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//根据视频id，"远程调用"实现视频删除</span>
        vodClient<span class="token punctuation">.</span><span class="token function">removeAlyVideo</span><span class="token punctuation">(</span>videoSourceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//删除小节</span>
    videoService<span class="token punctuation">.</span><span class="token function">removeById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ol>
<h3 id="删除课程删除视频"><a href="#删除课程删除视频" class="headerlink" title="删除课程删除视频"></a>删除课程删除视频</h3><blockquote>
<p>一个课程有很多章节，一个章节有很多小节，每个小节有视频</p>
<p>删除课程时，有对应多个视频需要删除</p>
</blockquote>
<ol>
<li><p>在service-vod创建接口</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">VodService</span> <span class="token punctuation">&#123;</span>
	
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword">void</span> <span class="token function">removeMoreAlyVideo</span><span class="token punctuation">(</span><span class="token class-name">List</span> videoIdList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeMoreAlyVideo</span><span class="token punctuation">(</span><span class="token class-name">List</span> videoIdList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//初始化对象</span>
        <span class="token class-name">DefaultAcsClient</span> client <span class="token operator">=</span> <span class="token class-name">InitVodClient</span><span class="token punctuation">.</span><span class="token function">initVodClient</span><span class="token punctuation">(</span><span class="token class-name">ConstantVodUtils</span><span class="token punctuation">.</span>ACCESS_KEY_ID<span class="token punctuation">,</span> <span class="token class-name">ConstantVodUtils</span><span class="token punctuation">.</span>ACCESS_KEY_SECRET<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建删除视频request对象</span>
        <span class="token class-name">DeleteVideoRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeleteVideoRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
        <span class="token comment">//videoIdList中的id转换成 值1,值2,值3 的形式</span>
        <span class="token class-name">String</span> videoIds <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>videoIdList<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
        <span class="token comment">//向request设置视频id</span>
        request<span class="token punctuation">.</span><span class="token function">setVideoIds</span><span class="token punctuation">(</span>videoIds<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
        <span class="token comment">//调用初始化对象的方法实现删除</span>
        client<span class="token punctuation">.</span><span class="token function">getAcsResponse</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">GuliException</span><span class="token punctuation">(</span><span class="token number">20001</span><span class="token punctuation">,</span><span class="token string">"删除视频失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>在service-edu，调用service-vod接口，实现删除多个视频的功能</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeVideoByCourseId</span><span class="token punctuation">(</span><span class="token class-name">String</span> courseId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//根据课程id，查询所有视频id</span>
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EduVideo</span><span class="token punctuation">></span></span> wrapperVideo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapperVideo<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"course_id"</span><span class="token punctuation">,</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapperVideo<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">"video_source_id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EduVideo</span><span class="token punctuation">></span></span> eduVideoList <span class="token operator">=</span> baseMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>wrapperVideo<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token comment">//List&lt;EduVideo>转换为List&lt;String></span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> videoIds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> eduVideoList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">EduVideo</span> eduVideo <span class="token operator">=</span> eduVideoList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> videoSourceId <span class="token operator">=</span> eduVideo<span class="token punctuation">.</span><span class="token function">getVideoSourceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
        <span class="token comment">//判断是否为空，非空则加入</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>videoSourceId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            videoIds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>videoSourceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
   
    <span class="token punctuation">&#125;</span>
   
    <span class="token keyword">if</span> <span class="token punctuation">(</span>videoIds<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//多个视频id，删除对应多个视频</span>
        vodClient<span class="token punctuation">.</span><span class="token function">deleteBatch</span><span class="token punctuation">(</span>videoIds<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
   
   
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EduVideo</span><span class="token punctuation">></span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"course_id"</span><span class="token punctuation">,</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    baseMapper<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>运行代码出现错误：<code>java.util.List&lt;?&gt; Not declared?</code></p>
<p>原因：List泛型没有定义</p>
<p>解决：</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//删除多个阿里云视频</span>
<span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">"/eduvod/video/delete-batch"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">deleteBatch</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"videoIdList"</span><span class="token punctuation">)</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> videoIdList<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li>
</ol>
<h3 id="SpringCloud调用接口过程"><a href="#SpringCloud调用接口过程" class="headerlink" title="SpringCloud调用接口过程"></a>SpringCloud调用接口过程</h3><blockquote>
<p>SpringCloud对于接口调用，大致会经过如下几个组件配合：</p>
<p>Feign -&gt; Hystrix -&gt; Ribbon -&gt; HttpClient (Apache http components 或 Okhttp)</p>
</blockquote>
<p>具体交互流程</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210602000857.png" alt="image-20210602000857550" loading="lazy"></p>
<h3 id="SpringCloud熔断器"><a href="#SpringCloud熔断器" class="headerlink" title="SpringCloud熔断器"></a>SpringCloud熔断器</h3><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210602001002.png" alt="image-20210602001002324" loading="lazy"></p>
<ol>
<li><p>添加熔断器依赖</p>
</li>
<li><p>在调用端配置文件中，开启熔断器</p>
<pre class="language-java" data-language="java"><code class="language-java">#开启熔断机制
feign<span class="token punctuation">.</span>hystrix<span class="token punctuation">.</span>enabled<span class="token operator">=</span><span class="token boolean">true</span></code></pre></li>
<li><p>创建interface后，还需要创建其实现类，出错时实现错误内容输出</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VodFileDegradeFeignClient</span> <span class="token keyword">implements</span> <span class="token class-name">VodClient</span> <span class="token punctuation">&#123;</span>
   <span class="token comment">//出错之后会执行</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">removeAlyVideo</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"删除视频出错了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">deleteBatch</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> videoIdList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"删除多个视频出错了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>在interface添加注解和属性</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"service-vod"</span><span class="token punctuation">,</span>fallback <span class="token operator">=</span> <span class="token class-name">VodFileDegradeFeignClient</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">//调用的服务名称</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">VodClient</span> <span class="token punctuation">&#123;</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ol>
<h2 id="Day-11"><a href="#Day-11" class="headerlink" title="Day 11"></a>Day 11</h2><ol>
<li><p>搭建项目前台环境</p>
<p>NUXT框架</p>
</li>
<li><p>整合前台系统页面</p>
</li>
<li><p>首页显示banner数据</p>
<p>轮播图或幻灯片</p>
</li>
<li><p>首页显示热门课程和名师</p>
</li>
<li><p>首页数据使用redis缓存</p>
</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210602002753.png" alt="image-20210602002753199" loading="lazy"></p>
<h3 id="搭建项目前台环境"><a href="#搭建项目前台环境" class="headerlink" title="搭建项目前台环境"></a>搭建项目前台环境</h3><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210602002833.png" alt="image-20210602002833072" loading="lazy"></p>
<h3 id="NUXT目录结构"><a href="#NUXT目录结构" class="headerlink" title="NUXT目录结构"></a>NUXT目录结构</h3><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210602003436.png" alt="image-20210602003436383" loading="lazy"></p>
<h3 id="NUXT页面加载过程"><a href="#NUXT页面加载过程" class="headerlink" title="NUXT页面加载过程"></a>NUXT页面加载过程</h3><p><code>layouts</code>文件夹下的<code>default.vue</code>只布局头信息、尾信息</p>
<p>而中间信息则是从<code>pages</code>文件夹<code>index.vue</code>引入</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210602003806.png" alt="image-20210602003806528" loading="lazy"></p>
<h3 id="后端首页数据banner"><a href="#后端首页数据banner" class="headerlink" title="后端首页数据banner"></a>后端首页数据banner</h3><ol>
<li><p>service创建子模块service_cms</p>
</li>
<li><p>创建application.properties配置文件</p>
</li>
<li><p>创建数据库crm_banner，根据表使用代码生成器</p>
</li>
<li><p>前台banner显示，后台banner管理</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210602004207.png" alt="image-20210602004207376" loading="lazy"></p>
</li>
<li><p>查询所有banner</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CrmBanner</span><span class="token punctuation">></span></span> <span class="token function">selectAllBanner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//根据id降序排列，显示排列之后的前两条记录</span>
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CrmBanner</span><span class="token punctuation">></span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">orderByDesc</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//last可以拼接sql语句</span>
    wrapper<span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token string">"limit 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CrmBanner</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> baseMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> list<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ol>
<h3 id="首页热门课程和名师接口"><a href="#首页热门课程和名师接口" class="headerlink" title="首页热门课程和名师接口"></a>首页热门课程和名师接口</h3><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//查询前8条热门课程，查询前4条名师</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"index"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token comment">//查询前8条热门课程</span>
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EduCourse</span><span class="token punctuation">></span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">orderByDesc</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token string">"limit 8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EduCourse</span><span class="token punctuation">></span></span> eduList <span class="token operator">=</span> courseService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//查询前4条名师</span>
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EduTeacher</span><span class="token punctuation">></span></span> wrapperTeacher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">orderByDesc</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token string">"limit 4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EduTeacher</span><span class="token punctuation">></span></span> teacherList <span class="token operator">=</span> teacherService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span>wrapperTeacher<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"eduList"</span><span class="token punctuation">,</span>eduList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"teacherList"</span><span class="token punctuation">,</span>teacherList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="首页数据显示-前端"><a href="#首页数据显示-前端" class="headerlink" title="首页数据显示(前端)"></a>首页数据显示(前端)</h3><p>前端环境准备</p>
<ol>
<li><p>下载axios依赖</p>
<pre class="language-none"><code class="language-none">npm install axios</code></pre></li>
<li><p>封装axios</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
<span class="token keyword">import</span> cookie <span class="token keyword">from</span> <span class="token string">'js-cookie'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> MessageBox<span class="token punctuation">,</span> Message <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'element-ui'</span>

<span class="token comment">// 创建axios实例</span>
<span class="token keyword">const</span> service <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  baseURL<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://localhost:9001</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token comment">// api的base_url</span>
  timeout<span class="token operator">:</span> <span class="token number">20000</span> <span class="token comment">// 请求超时时间</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> service</code></pre></li>
</ol>
<p>首页banner数据显示</p>
<ol>
<li><p>创建api文件夹，在api文件夹创建js文件，定义调用接口路径</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'@/utils/request'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
  <span class="token function">getListBanner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      url<span class="token operator">:</span> <span class="token string">'/educms/bannerfront/getAllBanner'</span><span class="token punctuation">,</span>
      method<span class="token operator">:</span> <span class="token string">'get'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>在页面index.vue，调用接口得到数据进行显示</p>
<pre class="language-vue" data-language="vue"><code class="language-vue"> created() &#123;
&#x2F;&#x2F;调用查询banner的方法
   this.getBannerList()
 &#125;
 methods:&#123;
     &#x2F;&#x2F;查询banner数据
   getBannerList() &#123;
     banner.getListBanner()
       .then(response &#x3D;&gt; &#123;
         this.bannerList &#x3D; response.data.data.list
       &#125;)
   &#125;
 &#125;
   </code></pre></li>
<li><p>nginx进行访问规则配置</p>
<pre class="language-none"><code class="language-none">location ~ &#x2F;educms&#x2F; &#123;
    proxy_pass   http:&#x2F;&#x2F;localhost:8004;
&#125;</code></pre></li>
</ol>
<h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><blockquote>
<ul>
<li>基于 key-value 进行存储</li>
<li>支持多种数据结构：string字符串 list列表 hash哈希 set集合 zset有序集合</li>
<li>支持持久化，通过内存进行存储，也可以存到硬盘里</li>
<li>支持过期时间，支持事务</li>
<li>一般情况下，把<strong>经常查询，不经常修改，且不重要</strong>的数据放到redis作为缓存</li>
</ul>
</blockquote>
<ol>
<li><p>创建redis配置类，放到common模块下</p>
<ul>
<li><p>引入SpringBoot整合Redis的相关依赖</p>
<pre class="language-xml" data-language="xml"><code class="language-xml">      <span class="token comment">&lt;!-- redis --></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
     
<span class="token comment">&lt;!--spring2.X集成redis所需common-pool2--></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>commons-pool2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.6.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre></li>
<li><p>创建redis缓存配置类，配置插件</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@EnableCaching</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token keyword">extends</span> <span class="token class-name">CachingConfigurerSupport</span> <span class="token punctuation">&#123;</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ul>
</li>
<li><p>在查询所有banner的方法上，添加缓存注解@Cacheable</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210607150238.png" alt="image-20210607150231153" loading="lazy"></p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>key <span class="token operator">=</span> <span class="token string">"'selectIndexList'"</span><span class="token punctuation">,</span>value <span class="token operator">=</span> <span class="token string">"banner"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CrmBanner</span><span class="token punctuation">></span></span> <span class="token function">selectAllBanner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>application.properties</p>
<pre class="language-properties" data-language="properties"><code class="language-properties"><span class="token comment"># redis</span>
<span class="token attr-name">spring.redis.host</span><span class="token punctuation">=</span><span class="token attr-value">192.168.161.129</span>
<span class="token attr-name">spring.redis.port</span><span class="token punctuation">=</span><span class="token attr-value">6379</span>
<span class="token attr-name">spring.redis.database</span><span class="token punctuation">=</span> <span class="token attr-value">0</span>
<span class="token attr-name">spring.redis.timeout</span><span class="token punctuation">=</span><span class="token attr-value">1800000</span>
<span class="token attr-name">spring.redis.lettuce.pool.max-active</span><span class="token punctuation">=</span><span class="token attr-value">20</span>
<span class="token attr-name">spring.redis.lettuce.pool.max-wait</span><span class="token punctuation">=</span><span class="token attr-value">-1</span>
<span class="token comment">#最大阻塞等待时间(负数表示没限制)</span>
<span class="token attr-name">spring.redis.lettuce.pool.max-idle</span><span class="token punctuation">=</span><span class="token attr-value">5</span>
<span class="token attr-name">spring.redis.lettuce.pool.min-idle</span><span class="token punctuation">=</span><span class="token attr-value">0</span></code></pre></li>
<li><p>虚拟机Linux环境下，启动redis</p>
</li>
</ol>
<h2 id="Day-12"><a href="#Day-12" class="headerlink" title="Day 12"></a>Day 12</h2><ol>
<li>登录实现流程</li>
<li>注册接口<ul>
<li>整合jwt</li>
<li><del>整合阿里云短信服务</del>(<strong>已替换为邮件发送</strong>)</li>
</ul>
</li>
<li>登录接口</li>
<li>注册和登录前端实现</li>
</ol>
<h3 id="单点登录三种方式"><a href="#单点登录三种方式" class="headerlink" title="单点登录三种方式"></a>单点登录三种方式</h3><h4 id="单一服务器模式"><a href="#单一服务器模式" class="headerlink" title="单一服务器模式"></a>单一服务器模式</h4><blockquote>
<p>使用session对象实现</p>
</blockquote>
<ul>
<li>登录成功之后，把用户数据放到session里面</li>
<li>从session获取数据，判断是否登录</li>
</ul>
<pre class="language-java" data-language="java"><code class="language-java">session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<h4 id="集群部署模式"><a href="#集群部署模式" class="headerlink" title="集群部署模式"></a>集群部署模式</h4><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210607151417.png" alt="image-20210607151417616" loading="lazy"></p>
<blockquote>
<p>单点登录三种常见方式</p>
</blockquote>
<ol>
<li><p><strong>session 广播机制实现</strong></p>
<p>即session复制</p>
</li>
<li><p><strong>使用 cookie+redis 实现</strong></p>
<ul>
<li>在项目中任何一个模块进行登录，登陆之后，把数据放到两个地方<ul>
<li>redis：key生成随机唯一值(ip或用户id等)，value存放用户数据</li>
<li>cookie：把redis生成的key放到cookie里</li>
</ul>
</li>
<li>访问项目其他模块，携带cookie进行发送请求<ul>
<li>通过cookie取值，到redis进行查询，根据key查询数据，若存在数据则判断登录</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>使用 token 实现</strong></p>
<blockquote>
<p>什么是token？</p>
<p>按照一定规则生成的字符串。可以包含用户信息</p>
</blockquote>
<ul>
<li>在项目某个模块登录，登录之后，按照特定规则生成字符串，用户信息包含到字符串中，返回字符串<ul>
<li>字符串可以通过cookie返回</li>
<li>也可以通过地址栏返回</li>
</ul>
</li>
<li>访问其他模块，每次访问在地址栏携带生成的字符串，访问模块中获取该字符串，根据字符串获取用户信息</li>
</ul>
</li>
</ol>
<h3 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h3><blockquote>
<p>token是按照一定规则生成的字符串，且包含用户信息</p>
<p>一般采用通用规则 JWT</p>
</blockquote>
<p>JWT生成的字符串包含三部分：</p>
<ol>
<li>JWT头信息</li>
<li>有效载荷，包含主体信息（用户信息）</li>
<li>哈希签名，防伪标志</li>
</ol>
<h4 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h4><ol>
<li><p>引入 JWT 依赖</p>
<pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- JWT--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>io.jsonwebtoken<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jjwt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre></li>
<li><p>创建 JWT 工具类</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JwtUtils</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> EXPIRE <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> APP_SECRET <span class="token operator">=</span> <span class="token string">"ukc8BDbRigUDaY6pZFfWus2jZWLPHO"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getJwtToken</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> nickname<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        <span class="token class-name">String</span> <span class="token class-name">JwtToken</span> <span class="token operator">=</span> <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setHeaderParam</span><span class="token punctuation">(</span><span class="token string">"typ"</span><span class="token punctuation">,</span> <span class="token string">"JWT"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setHeaderParam</span><span class="token punctuation">(</span><span class="token string">"alg"</span><span class="token punctuation">,</span> <span class="token string">"HS256"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span><span class="token string">"guli-user"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setIssuedAt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setExpiration</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> EXPIRE<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span><span class="token string">"nickname"</span><span class="token punctuation">,</span> nickname<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">signWith</span><span class="token punctuation">(</span><span class="token class-name">SignatureAlgorithm</span><span class="token punctuation">.</span>HS256<span class="token punctuation">,</span> APP_SECRET<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token class-name">JwtToken</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 判断token是否存在与有效
     * @param jwtToken
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">checkToken</span><span class="token punctuation">(</span><span class="token class-name">String</span> jwtToken<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>jwtToken<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token function">parser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSigningKey</span><span class="token punctuation">(</span>APP_SECRET<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parseClaimsJws</span><span class="token punctuation">(</span>jwtToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 判断token是否存在与有效
     * @param request
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">checkToken</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">String</span> jwtToken <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>jwtToken<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token function">parser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSigningKey</span><span class="token punctuation">(</span>APP_SECRET<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parseClaimsJws</span><span class="token punctuation">(</span>jwtToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 根据token获取会员id
     * @param request
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getMemberIdByJwtToken</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> jwtToken <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>jwtToken<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token class-name">Jws</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Claims</span><span class="token punctuation">></span></span> claimsJws <span class="token operator">=</span> <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token function">parser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSigningKey</span><span class="token punctuation">(</span>APP_SECRET<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parseClaimsJws</span><span class="token punctuation">(</span>jwtToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Claims</span> claims <span class="token operator">=</span> claimsJws<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>claims<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ol>
<h3 id="阿里云短信服务"><a href="#阿里云短信服务" class="headerlink" title="阿里云短信服务"></a><del>阿里云短信服务</del></h3><h3 id="邮件发送服务"><a href="#邮件发送服务" class="headerlink" title="邮件发送服务"></a>邮件发送服务</h3><p>由于阿里云审核方面的问题，已替换为邮件发送，具体参考另一篇文章</p>
<p><a href="SpringCloud%E5%AE%9E%E7%8E%B0%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81">SpringCloud实现邮件发送</a></p>
<blockquote>
<p>Redis验证码有效时间问题</p>
</blockquote>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//这里的phone只起到账号作用</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/send/&#123;phone&#125;"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">sendMail</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> phone<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token comment">//1 从redis获取验证码，如果获取到直接返回</span>
    <span class="token class-name">String</span> code <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//2 获取不到，生成随机验证码，发送邮件</span>
    code <span class="token operator">=</span> <span class="token class-name">RandomUtil</span><span class="token punctuation">.</span><span class="token function">getFourBitRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Boolean</span> isSend <span class="token operator">=</span> msmService<span class="token punctuation">.</span><span class="token function">sendMail</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//发送成功，账号对应的邮件验证码存入redis，并设置有效时间为5分钟</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isSend<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>phone<span class="token punctuation">,</span>code<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"发送邮件失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="登录接口"><a href="#登录接口" class="headerlink" title="登录接口"></a>登录接口</h3><ol>
<li>在service下面创建子模块service_ucenter</li>
<li>创建用户表，使用代码生成器生成controller entity mapper service</li>
</ol>
<p>controller</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//登录</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"login"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">loginUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">UcenterMember</span> member<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token comment">//member封装手机号和密码</span>
    <span class="token comment">//调用service</span>
    <span class="token comment">//返回token，使用jwt生成</span>
    <span class="token class-name">String</span> token <span class="token operator">=</span> memberService<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>member<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">,</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>service</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">UcenterMember</span> member<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//获取登录手机号和密码</span>
    <span class="token class-name">String</span> mobile <span class="token operator">=</span> member<span class="token punctuation">.</span><span class="token function">getMobile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> password <span class="token operator">=</span> member<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>mobile<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">GuliException</span><span class="token punctuation">(</span><span class="token number">20001</span><span class="token punctuation">,</span><span class="token string">"登录失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//判断手机号是否存在</span>
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UcenterMember</span> <span class="token punctuation">></span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"mobile"</span><span class="token punctuation">,</span>mobile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">UcenterMember</span> ucenterMember <span class="token operator">=</span> baseMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ucenterMember <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">GuliException</span><span class="token punctuation">(</span><span class="token number">20001</span><span class="token punctuation">,</span><span class="token string">"手机号不存在"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//判断密码是否正确</span>
    <span class="token comment">//注意：数据库密码是经过加密的，md5加密</span>
    <span class="token comment">//要先把输入密码加密后进行比较</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>MD5<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>ucenterMember<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">GuliException</span><span class="token punctuation">(</span><span class="token number">20001</span><span class="token punctuation">,</span><span class="token string">"密码错误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//判断账号是否禁用</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ucenterMember<span class="token punctuation">.</span><span class="token function">getIsDisabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">GuliException</span><span class="token punctuation">(</span><span class="token number">20001</span><span class="token punctuation">,</span><span class="token string">"账号被禁用"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//登录成功后生成token字符串</span>
    <span class="token class-name">String</span> jwtToken <span class="token operator">=</span> <span class="token class-name">JwtUtils</span><span class="token punctuation">.</span><span class="token function">getJwtToken</span><span class="token punctuation">(</span>ucenterMember<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ucenterMember<span class="token punctuation">.</span><span class="token function">getNickname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> jwtToken<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="注册接口"><a href="#注册接口" class="headerlink" title="注册接口"></a>注册接口</h3><ol>
<li><p>创建实体类，封装注册数据</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@ApiModel</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"注册对象"</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">"注册对象"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RegisterVo</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"昵称"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> nickname<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"手机号"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> mobile<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"密码"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"验证码"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> code<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>controller</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//注册</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"register"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">registerUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">RegisterVo</span> registerVo<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    memberService<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>registerVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>service</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">RegisterVo</span> registerVo<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//获取注册数据</span>
    <span class="token class-name">String</span> code <span class="token operator">=</span> registerVo<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> mobile <span class="token operator">=</span> registerVo<span class="token punctuation">.</span><span class="token function">getMobile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> nickname <span class="token operator">=</span> registerVo<span class="token punctuation">.</span><span class="token function">getNickname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> password <span class="token operator">=</span> registerVo<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token comment">//非空判断</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>mobile<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span>
    <span class="token operator">||</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>nickname<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">GuliException</span><span class="token punctuation">(</span><span class="token number">20001</span><span class="token punctuation">,</span><span class="token string">"注册失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
   
    <span class="token comment">//判断验证码</span>
    <span class="token class-name">String</span> redisCode <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>mobile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>code<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>redisCode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">GuliException</span><span class="token punctuation">(</span><span class="token number">20001</span><span class="token punctuation">,</span><span class="token string">"注册失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
   
    <span class="token comment">//手机号不能重复</span>
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UcenterMember</span><span class="token punctuation">></span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"mobile"</span><span class="token punctuation">,</span>mobile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Integer</span> count <span class="token operator">=</span> baseMapper<span class="token punctuation">.</span><span class="token function">selectCount</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">GuliException</span><span class="token punctuation">(</span><span class="token number">20001</span><span class="token punctuation">,</span><span class="token string">"注册失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
   
    <span class="token comment">//数据添加至数据库</span>
    <span class="token class-name">UcenterMember</span> ucenterMember <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UcenterMember</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ucenterMember<span class="token punctuation">.</span><span class="token function">setMobile</span><span class="token punctuation">(</span>mobile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ucenterMember<span class="token punctuation">.</span><span class="token function">setNickname</span><span class="token punctuation">(</span>nickname<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ucenterMember<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>MD5<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//密码需要MD5加密</span>
    ucenterMember<span class="token punctuation">.</span><span class="token function">setIsDisabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ucenterMember<span class="token punctuation">.</span><span class="token function">setAvatar</span><span class="token punctuation">(</span><span class="token string">"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoj0hHXhgJNOTSOFsS4uZs8x1ConecaVOB8eIl115xmJZcT4oCicvia7wMEufibKtTLqiaJeanU2Lpg3w/132"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
   
    baseMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>ucenterMember<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>接口：根据token字符串获取用户信息</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//根据token获取用户信息</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"getMemberInfo"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">getMemberInfo</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token comment">//调用jwt工具类，根据request对象获取头信息，返回用户id</span>
    <span class="token class-name">String</span> memberId <span class="token operator">=</span> <span class="token class-name">JwtUtils</span><span class="token punctuation">.</span><span class="token function">getMemberIdByJwtToken</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//查询数据库，根据id获取用户信息</span>
    <span class="token class-name">UcenterMember</span> member <span class="token operator">=</span> memberService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>memberId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"userInfo"</span><span class="token punctuation">,</span>member<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ol>
<h3 id="注册与登录页面前端整合"><a href="#注册与登录页面前端整合" class="headerlink" title="注册与登录页面前端整合"></a>注册与登录页面前端整合</h3><ol>
<li><p>安装插件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> element-ui
<span class="token function">npm</span> <span class="token function">install</span> vue-qriously</code></pre></li>
<li><p>在nuxt中使用插件element-ui</p>
<p>plugins/nuxt-swiper-plugin.js</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> VueAwesomeSwiper <span class="token keyword">from</span> <span class="token string">'vue-awesome-swiper'</span>
<span class="token keyword">import</span> VueQriously <span class="token keyword">from</span> <span class="token string">'vue-qriously'</span>
<span class="token keyword">import</span> ElementUI <span class="token keyword">from</span> <span class="token string">'element-ui'</span> <span class="token comment">//element-ui的全部组件</span>
<span class="token keyword">import</span> <span class="token string">'element-ui/lib/theme-chalk/index.css'</span><span class="token comment">//element-ui的css</span>
Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElementUI<span class="token punctuation">)</span> <span class="token comment">//使用elementUI</span>
Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueQriously<span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueAwesomeSwiper<span class="token punctuation">)</span></code></pre></li>
<li><p>整合注册页面</p>
<ul>
<li><p>layouts文件夹创建登录注册布局页面sign.vue</p>
</li>
<li><p>修改登录和注册地址</p>
<p>layouts/default.vue</p>
<pre class="language-vue" data-language="vue"><code class="language-vue">&lt;li v-if&#x3D;&quot;!loginInfo.id&quot; id&#x3D;&quot;no-login&quot;&gt;
    &lt;a href&#x3D;&quot;&#x2F;login&quot; title&#x3D;&quot;登录&quot;&gt;
        &lt;em class&#x3D;&quot;icon18 login-icon&quot;&gt;&amp;nbsp;&lt;&#x2F;em&gt;
        &lt;span class&#x3D;&quot;vam ml5&quot;&gt;登录&lt;&#x2F;span&gt;
    &lt;&#x2F;a&gt;
    |
    &lt;a href&#x3D;&quot;&#x2F;register&quot; title&#x3D;&quot;注册&quot;&gt;
        &lt;span class&#x3D;&quot;vam ml5&quot;&gt;注册&lt;&#x2F;span&gt;
    &lt;&#x2F;a&gt;
&lt;&#x2F;li&gt;</code></pre></li>
<li><p>创建注册页面register.vue</p>
</li>
</ul>
</li>
<li><p>整合注册功能</p>
<ul>
<li><p>api创建register.js，定义注册接口的方法</p>
</li>
<li><p>实现倒计时效果，使用js定时器方法实现</p>
</li>
<li><p>nginx配置路径匹配规则</p>
<pre class="language-none"><code class="language-none">location ~ &#x2F;edumsm&#x2F; &#123;
    proxy_pass   http:&#x2F;&#x2F;localhost:8005;
&#125;
     
location ~ &#x2F;educenter&#x2F; &#123;
    proxy_pass   http:&#x2F;&#x2F;localhost:8006;
&#125;</code></pre></li>
</ul>
</li>
</ol>
<h2 id="Day-13"><a href="#Day-13" class="headerlink" title="Day 13"></a>Day 13</h2><ol>
<li>登录前端整合</li>
<li>微信扫描登录<ul>
<li>OAuth2</li>
<li>微信登录</li>
</ul>
</li>
</ol>
<h3 id="登录前端整合"><a href="#登录前端整合" class="headerlink" title="登录前端整合"></a>登录前端整合</h3><ol>
<li><p>在api创建login.js，定义接口地址</p>
</li>
<li><p>安装插件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> js-cookie</code></pre></li>
<li><p>登录及登录之后，首页显示数据实现过程分析</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210627214048.png" alt="image-20210627214041507" loading="lazy"></p>
</li>
</ol>
<h3 id="OAuth2"><a href="#OAuth2" class="headerlink" title="OAuth2"></a>OAuth2</h3><blockquote>
<p>OAuth2是针对特定问题的一种解决方案</p>
<ol>
<li>开放系统间的授权</li>
<li>分布式访问</li>
</ol>
</blockquote>
<p>开放系统间的授权</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210627214302.png" alt="image-20210627214302363" loading="lazy"></p>
<p>分布式访问(单点登录)</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210627214334.png" alt="image-20210627214334851" loading="lazy"></p>
<h3 id="微信扫描登录"><a href="#微信扫描登录" class="headerlink" title="微信扫描登录"></a>微信扫描登录</h3><blockquote>
<p>准备工作：</p>
<ol>
<li>注册开发者资质</li>
<li>申请网站应用名称</li>
<li>需要域名地址</li>
</ol>
</blockquote>
<ol>
<li><p>service-ucenter模块配置文件，微信id、秘钥和域名地址</p>
</li>
<li><p>创建类读取配置文件内容</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"login"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getWxCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">String</span> baseUrl <span class="token operator">=</span> <span class="token string">"https://open.weixin.qq.com/connect/qrconnect"</span> <span class="token operator">+</span>
            <span class="token string">"?appid=%s"</span> <span class="token operator">+</span>
            <span class="token string">"&amp;redirect_uri=%s"</span> <span class="token operator">+</span>
            <span class="token string">"&amp;response_type=code"</span> <span class="token operator">+</span>
            <span class="token string">"&amp;scope=snsapi_login"</span> <span class="token operator">+</span>
            <span class="token string">"&amp;state=%s"</span> <span class="token operator">+</span>
            <span class="token string">"#wechat_redirect"</span><span class="token punctuation">;</span>
   
    <span class="token comment">//对redirect_url进行编码</span>
    <span class="token class-name">String</span> redirect_url <span class="token operator">=</span> <span class="token class-name">ConstantWxUtils</span><span class="token punctuation">.</span>WX_OPEN_REDIRECT_URL<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        redirect_url <span class="token operator">=</span> <span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>redirect_url<span class="token punctuation">,</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnsupportedEncodingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
   
    <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>
            baseUrl<span class="token punctuation">,</span>
            <span class="token class-name">ConstantWxUtils</span><span class="token punctuation">.</span>WX_OPEN_APP_ID<span class="token punctuation">,</span>
            redirect_url<span class="token punctuation">,</span>
            <span class="token string">"atguigu"</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//重定向到请求微信地址</span>
    <span class="token keyword">return</span> <span class="token string">"redirect:"</span> <span class="token operator">+</span> url<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>生成微信扫描二维码</p>
<ul>
<li>直接请求微信提供的固定地址，向地址后面拼接参数</li>
</ul>
</li>
</ol>
<h4 id="扫描之后获取扫描人信息"><a href="#扫描之后获取扫描人信息" class="headerlink" title="扫描之后获取扫描人信息"></a>扫描之后获取扫描人信息</h4><blockquote>
<p>技术点：</p>
<ol>
<li><p>httpclient</p>
</li>
<li><p>json转换工具</p>
<p>fast json, gson, jackson</p>
</li>
</ol>
</blockquote>
<ol>
<li><p>扫描之后，执行本地的callback方法，获取两个值，跳转时进行传递</p>
<ul>
<li>state:原样传递</li>
<li>code:类似于手机验证码，唯一随机值(临时票据)</li>
</ul>
</li>
<li><p>通过code值，请求微信提供的固定地址，获取另外两个值</p>
<ul>
<li>access_token:访问凭证</li>
<li>openid:每个微信唯一标识</li>
</ul>
</li>
<li><p>通过access_token和openid，再去请求微信提供的固定地址，获取扫描人信息(昵称、头像等)</p>
</li>
<li><p>在首页显示微信信息，如昵称、头像</p>
<ul>
<li><p>把扫描后的信息放到cookie，跳转到首页显示</p>
</li>
<li><p>但是存在一个问题：cookie无法实现跨域访问</p>
</li>
<li><p>解决方式：使用jwt，生成token字符串，通过路径传递到首页</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//使用jwt，根据member对象，生成token字符串</span>
<span class="token class-name">String</span> jwtToken <span class="token operator">=</span> <span class="token class-name">JwtUtils</span><span class="token punctuation">.</span><span class="token function">getJwtToken</span><span class="token punctuation">(</span>member<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> member<span class="token punctuation">.</span><span class="token function">getNickname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token string">"redirect:http://localhost:3000?token="</span> <span class="token operator">+</span> jwtToken<span class="token punctuation">;</span></code></pre></li>
</ul>
</li>
</ol>
<h4 id="首页显示数据"><a href="#首页显示数据" class="headerlink" title="首页显示数据"></a>首页显示数据</h4><ol>
<li>首页路径中有token字符串，获取token</li>
<li>token值放入cookie<ul>
<li>前端拦截器，判断cookie是否有token，若有，获取token，放到header里</li>
</ul>
</li>
<li>调用后端接口，根据token值获取用户信息，用户信息存入cookie</li>
</ol>
<h2 id="Day-14"><a href="#Day-14" class="headerlink" title="Day 14"></a>Day 14</h2><ol>
<li>名师列表功能</li>
<li>名师详情功能</li>
<li>课程列表功能</li>
<li>课程详情功能</li>
<li>整合阿里云视频播放器</li>
<li>课程评论功能</li>
</ol>
<h3 id="名师列表功能"><a href="#名师列表功能" class="headerlink" title="名师列表功能"></a>名师列表功能</h3><ol>
<li><p>分页查询名师接口</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">getTeacherFrontList</span><span class="token punctuation">(</span><span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EduTeacher</span><span class="token punctuation">></span></span> pageParam<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EduTeacher</span><span class="token punctuation">></span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">orderByDesc</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//把分页数据封装到pageTeacher对象</span>
    baseMapper<span class="token punctuation">.</span><span class="token function">selectPage</span><span class="token punctuation">(</span>pageParam<span class="token punctuation">,</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EduTeacher</span><span class="token punctuation">></span></span> records <span class="token operator">=</span> pageParam<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> current <span class="token operator">=</span> pageParam<span class="token punctuation">.</span><span class="token function">getCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> pages <span class="token operator">=</span> pageParam<span class="token punctuation">.</span><span class="token function">getPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> size <span class="token operator">=</span> pageParam<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> total <span class="token operator">=</span> pageParam<span class="token punctuation">.</span><span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token keyword">boolean</span> hasNext <span class="token operator">=</span> pageParam<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> hasPrevious <span class="token operator">=</span> pageParam<span class="token punctuation">.</span><span class="token function">hasPrevious</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token comment">//分页数据放到map集合</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"items"</span><span class="token punctuation">,</span> records<span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"current"</span><span class="token punctuation">,</span> current<span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"pages"</span><span class="token punctuation">,</span> pages<span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"size"</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"total"</span><span class="token punctuation">,</span> total<span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"hasNext"</span><span class="token punctuation">,</span> hasNext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"hasPrevious"</span><span class="token punctuation">,</span> hasPrevious<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token keyword">return</span> map<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>整合前端页面</p>
<ul>
<li>在api创建js文件，定义接口地址</li>
<li>在页面引入js文件，调用方法进行显示</li>
</ul>
</li>
</ol>
<h3 id="讲师详情功能"><a href="#讲师详情功能" class="headerlink" title="讲师详情功能"></a>讲师详情功能</h3><ol>
<li><p>修改前端讲师列表页面超链接，改成讲师id</p>
</li>
<li><p>后端讲师详情接口</p>
<ul>
<li><p>根据讲师id查询讲师基本信息</p>
</li>
<li><p>根据讲师id查询讲师所讲课程</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"getTeacherFrontInfo/&#123;teacherId&#125;"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">getTeacherFrontInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> teacherId<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token comment">//1 根据讲师id，查询讲师基本信息</span>
    <span class="token class-name">EduTeacher</span> eduTeacher <span class="token operator">=</span> teacherService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>teacherId<span class="token punctuation">)</span><span class="token punctuation">;</span>
     
    <span class="token comment">//2 根据讲师id，查询所讲课程</span>
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EduCourse</span><span class="token punctuation">></span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"teacher_id"</span><span class="token punctuation">,</span>teacherId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EduCourse</span><span class="token punctuation">></span></span> courseList <span class="token operator">=</span> courseService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
     
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"teacher"</span><span class="token punctuation">,</span>eduTeacher<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"courseList"</span><span class="token punctuation">,</span>courseList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ul>
</li>
</ol>
<h3 id="课程列表功能-1"><a href="#课程列表功能-1" class="headerlink" title="课程列表功能"></a>课程列表功能</h3><h4 id="条件查询带分页功能"><a href="#条件查询带分页功能" class="headerlink" title="条件查询带分页功能"></a>条件查询带分页功能</h4><ol>
<li><p>创建 vo 对象，封装条件数据</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CourseFrontVo</span><span class="token punctuation">&#123;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>编写 controller service</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"getFrontCourseList/&#123;page&#125;/&#123;limit&#125;"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">getFrontCourseList</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token keyword">long</span> page<span class="token punctuation">,</span> <span class="token annotation punctuation">@PathVariable</span> <span class="token keyword">long</span> limit<span class="token punctuation">,</span>
                            <span class="token annotation punctuation">@RequestBody</span><span class="token punctuation">(</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">CourseFrontVo</span> courseFrontVo<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EduCourse</span><span class="token punctuation">></span></span> pageCourse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>page<span class="token punctuation">,</span>limit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> courseService<span class="token punctuation">.</span><span class="token function">getCourseFrontList</span><span class="token punctuation">(</span>pageCourse<span class="token punctuation">,</span>courseFrontVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//返回分页所有数据</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>课程列表前端整合</p>
</li>
</ol>
<h3 id="课程详情功能"><a href="#课程详情功能" class="headerlink" title="课程详情功能"></a>课程详情功能</h3><ol>
<li><p>编写 sql 语句，根据课程 id 查询课程信息</p>
<ul>
<li>课程基本信息</li>
<li>课程分类</li>
<li>课程描述</li>
<li>所属讲师</li>
</ul>
</li>
<li><p>根据课程 id 查询章节和小节</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"getFrontCourseInfo/&#123;courseId&#125;"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">getFrontCourseInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> courseId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//根据课程id，编写sql语句查询课程信息</span>
    <span class="token class-name">CourseWebVo</span> courseWebVo <span class="token operator">=</span> courseService<span class="token punctuation">.</span><span class="token function">getBaseCourseInfo</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token comment">//根据课程id查询章节和小节</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ChapterVo</span><span class="token punctuation">></span></span> chapterVideoList <span class="token operator">=</span> chapterService<span class="token punctuation">.</span><span class="token function">getChapterVideoByCourseId</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"courseWebVo"</span><span class="token punctuation">,</span>courseWebVo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"chapterVideoList"</span><span class="token punctuation">,</span>chapterVideoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ol>
<h3 id="整合阿里云播放器"><a href="#整合阿里云播放器" class="headerlink" title="整合阿里云播放器"></a>整合阿里云播放器</h3><ol>
<li><p>创建接口，根据视频 id 获取视频播放凭证</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//根据视频id获取视频凭证</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"getPlayAuth/&#123;id&#125;"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">getPlayAuth</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//创建初始化对象</span>
        <span class="token class-name">DefaultAcsClient</span> client <span class="token operator">=</span>
                <span class="token class-name">InitVodCilent</span><span class="token punctuation">.</span><span class="token function">initVodClient</span><span class="token punctuation">(</span><span class="token class-name">ConstantVodUtils</span><span class="token punctuation">.</span>ACCESS_KEY_ID<span class="token punctuation">,</span> <span class="token class-name">ConstantVodUtils</span><span class="token punctuation">.</span>ACCESS_KEY_SECRET<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建获取凭证request和response对象</span>
        <span class="token class-name">GetVideoPlayAuthRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetVideoPlayAuthRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//向request设置视频id</span>
        request<span class="token punctuation">.</span><span class="token function">setVideoId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//调用方法得到凭证</span>
        <span class="token class-name">GetVideoPlayAuthResponse</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getAcsResponse</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> playAuth <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getPlayAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"playAuth"</span><span class="token punctuation">,</span>playAuth<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">GuliException</span><span class="token punctuation">(</span><span class="token number">20001</span><span class="token punctuation">,</span><span class="token string">"获取凭证失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>修改前端，实现点击某个小节，打开新的页面进行视频播放</p>
</li>
</ol>
<h2 id="Day15"><a href="#Day15" class="headerlink" title="Day15"></a>Day15</h2><ol>
<li>课程评论功能</li>
<li>课程支付功能</li>
</ol>
<h3 id="课程评论功能"><a href="#课程评论功能" class="headerlink" title="课程评论功能"></a>课程评论功能</h3><p>实现以下效果：</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211030232302.png" alt="image-20211030232302114" loading="lazy"></p>
<h4 id="具体实现过程"><a href="#具体实现过程" class="headerlink" title="具体实现过程"></a>具体实现过程</h4><ol>
<li>创建课程评论表 edu_comment</li>
<li>创建接口和两个方法<ul>
<li>分页查询课程评论方法</li>
<li>添加评论方法</li>
</ul>
</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211030233235.png" alt="image-20211030233235446" loading="lazy"></p>
<p>注意：评论前必须先登录</p>
<ol>
<li>从 header 获取 token（从 request 获取）</li>
<li>根据 token 获取用户 id（使用 jwt）</li>
<li>根据用户 id 查询用户表，获取数据</li>
</ol>
<h3 id="课程支付功能"><a href="#课程支付功能" class="headerlink" title="课程支付功能"></a>课程支付功能</h3><h4 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h4><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211101172058.png" alt="image-20211101172058132" loading="lazy"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211101172010.png" alt="image-20211101172010346" loading="lazy"></p>
<h4 id="支付相关接口汇总"><a href="#支付相关接口汇总" class="headerlink" title="支付相关接口汇总"></a>支付相关接口汇总</h4><ol>
<li>生成订单接口</li>
<li>根据订单 id 查询订单信息接口</li>
<li>微信支付二维码生成接口</li>
<li>订单支付状态查询接口</li>
</ol>
<h4 id="生成订单接口"><a href="#生成订单接口" class="headerlink" title="生成订单接口"></a>生成订单接口</h4><p>生成订单需要：课程信息、用户信息</p>
<h5 id="远程调用-Nacos"><a href="#远程调用-Nacos" class="headerlink" title="远程调用-Nacos"></a>远程调用-Nacos</h5><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211101173220.png" alt="image-20211101173219899" loading="lazy"></p>
<p>service_order</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//1 生成订单的方法</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"createOrder/&#123;courseId&#125;"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">saveOrder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> courseId<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//创建订单，返回订单号</span>
    <span class="token class-name">String</span> orderNo <span class="token operator">=</span>
            orderService<span class="token punctuation">.</span><span class="token function">createOrders</span><span class="token punctuation">(</span>courseId<span class="token punctuation">,</span><span class="token class-name">JwtUtils</span><span class="token punctuation">.</span><span class="token function">getMemberIdByJwtToken</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"orderId"</span><span class="token punctuation">,</span>orderNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>service_edu</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//根据课程id查询课程信息</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"getCourseInfoOrder/&#123;id&#125;"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CourseWebVoOrder</span> <span class="token function">getCourseInfoOrder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">CourseWebVo</span> courseInfo <span class="token operator">=</span> courseService<span class="token punctuation">.</span><span class="token function">getBaseCourseInfo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">CourseWebVoOrder</span> courseWebVoOrder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CourseWebVoOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>courseInfo<span class="token punctuation">,</span>courseWebVoOrder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> courseWebVoOrder<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>service_ucenter</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//根据用户id获取用户信息</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"getUserInfoOrder/&#123;id&#125;"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">UcenterMemberOrder</span> <span class="token function">getUserInfoOrder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">UcenterMember</span> member <span class="token operator">=</span> memberService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//把member对象里面值复制给UcenterMemberOrder对象</span>
    <span class="token class-name">UcenterMemberOrder</span> ucenterMemberOrder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UcenterMemberOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>member<span class="token punctuation">,</span>ucenterMemberOrder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ucenterMemberOrder<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h4 id="根据订单-id-查询订单信息"><a href="#根据订单-id-查询订单信息" class="headerlink" title="根据订单 id 查询订单信息"></a>根据订单 id 查询订单信息</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//2 根据订单id查询订单信息</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"getOrderInfo/&#123;orderId&#125;"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">getOrderInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> orderId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">></span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"order_no"</span><span class="token punctuation">,</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Order</span> order <span class="token operator">=</span> orderService<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"item"</span><span class="token punctuation">,</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="微信支付二维码生成接口"><a href="#微信支付二维码生成接口" class="headerlink" title="微信支付二维码生成接口"></a>微信支付二维码生成接口</h3><p>准备：微信支付 id，商户号，商户 key</p>
<p>引入微信支付 maven 依赖</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependencies<span class="token punctuation">></span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>wxpay<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>wxpay<span class="token operator">-</span>sdk<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">></span></span><span class="token number">0.0</span><span class="token number">.3</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>

    <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>com<span class="token punctuation">.</span>alibaba<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>fastjson<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">></span></code></pre>

<p>编写接口</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//生成微信支付二维码接口</span>
<span class="token comment">//参数是订单号</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"createNative/&#123;orderNo&#125;"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">createNative</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> orderNo<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//返回信息，包含二维码地址，还有其他需要的信息</span>
    <span class="token class-name">Map</span> map <span class="token operator">=</span> payLogService<span class="token punctuation">.</span><span class="token function">createNatvie</span><span class="token punctuation">(</span>orderNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"****返回二维码map集合:"</span><span class="token operator">+</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h2 id="Day-16"><a href="#Day-16" class="headerlink" title="Day 16"></a>Day 16</h2><ol>
<li>支付后执行过程总结</li>
<li>课程详情页面观看和购买功能完善</li>
<li>系统后台统计分析模块<ul>
<li>统计分析模块需求</li>
<li>生成统计数据</li>
<li>使用图表显示统计数据</li>
</ul>
</li>
</ol>
<h3 id="支付后流程"><a href="#支付后流程" class="headerlink" title="支付后流程"></a>支付后流程</h3><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211103143616.png" loading="lazy"></p>
<p>在课程详情页面，有<code>立即购买</code>/<code>立即观看</code>按钮</p>
<ul>
<li>如果课程是免费的，按钮为<code>立即观看</code></li>
<li>如果课程是付费的，且已支付，按钮为<code>立即观看</code></li>
<li>如果课程是付费的，但未支付，按钮为<code>立即购买</code></li>
</ul>
<blockquote>
<p>如何判断课程是否已支付</p>
</blockquote>
<p>根据课程 id 和用户 id，查询订单表中的订单状态</p>
<p>若状态值为 1，表示已支付，否则未支付</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//根据课程id和用户id查询订单表中订单状态</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"isBuyCourse/&#123;courseId&#125;/&#123;memberId&#125;"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isBuyCourse</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> courseId<span class="token punctuation">,</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> memberId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">></span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"course_id"</span><span class="token punctuation">,</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"member_id"</span><span class="token punctuation">,</span>memberId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"status"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//支付状态 1代表已经支付</span>
    <span class="token keyword">int</span> count <span class="token operator">=</span> orderService<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>count<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//已经支付</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>在课程详情页面显示立即购买/立即观看，需要修改课程详情查询接口</p>
<p>添加返回值，返回当前显示详情的课程是否已被购买</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//2 课程详情的方法</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"getFrontCourseInfo/&#123;courseId&#125;"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">getFrontCourseInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> courseId<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//根据课程id，编写sql语句查询课程信息</span>
    <span class="token class-name">CourseWebVo</span> courseWebVo <span class="token operator">=</span> courseService<span class="token punctuation">.</span><span class="token function">getBaseCourseInfo</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//根据课程id查询章节和小节</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ChapterVo</span><span class="token punctuation">></span></span> chapterVideoList <span class="token operator">=</span> chapterService<span class="token punctuation">.</span><span class="token function">getChapterVideoByCourseId</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//根据课程id和用户id查询当前课程是否已经支付过了</span>
    <span class="token keyword">boolean</span> buyCourse <span class="token operator">=</span> ordersClient<span class="token punctuation">.</span><span class="token function">isBuyCourse</span><span class="token punctuation">(</span>courseId<span class="token punctuation">,</span> <span class="token class-name">JwtUtils</span><span class="token punctuation">.</span><span class="token function">getMemberIdByJwtToken</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"courseWebVo"</span><span class="token punctuation">,</span>courseWebVo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"chapterVideoList"</span><span class="token punctuation">,</span>chapterVideoList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"isBuy"</span><span class="token punctuation">,</span>buyCourse<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="统计分析模块"><a href="#统计分析模块" class="headerlink" title="统计分析模块"></a>统计分析模块</h3><ol>
<li>统计项目中每天有多少注册人数</li>
<li>将其用图表显示出来</li>
</ol>
<h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><p>创建表，用于存储统计数据</p>
<h4 id="统计某一天注册人数"><a href="#统计某一天注册人数" class="headerlink" title="统计某一天注册人数"></a>统计某一天注册人数</h4><p>查询用户表<code>ucenter_member</code>，得到需要的数据</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">SELECT COUNT(*) FROM ucenter_member uc WHERE DATE(uc.gmt_create)&#x3D;&#39;2020-03-09&#39;</code></pre>

<h4 id="最终实现过程"><a href="#最终实现过程" class="headerlink" title="最终实现过程"></a>最终实现过程</h4><p>生成统计数据</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211103144645.png" loading="lazy"></p>
<p>图表显示数据</p>
<p>把统计分析表中存储的数据，使用图表显示</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211103144807.png" loading="lazy"></p>
<h3 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h3><blockquote>
<p>定时任务，就是特定时候自动执行程序</p>
<p>类似闹钟</p>
</blockquote>
<ol>
<li><p>在启动类添加注解</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@EnableScheduling</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaApplication</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">StaApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
<li><p>创建定时任务类，在类中利用 cron 表达式设置执行规则</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduledTask</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">StatisticsDailyService</span> staService<span class="token punctuation">;</span>

    <span class="token comment">// 0/5 * * * * ?表示每隔5秒执行一次这个方法</span>
    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">"0/5 * * * * ?"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">task1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"**************task1执行了.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//在每天凌晨1点，把前一天数据进行数据查询添加</span>
    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">"0 0 1 * * ?"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">task2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        staService<span class="token punctuation">.</span><span class="token function">registerCount</span><span class="token punctuation">(</span><span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">formatDate</span><span class="token punctuation">(</span><span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">addDays</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ol>
<h2 id="Day-17"><a href="#Day-17" class="headerlink" title="Day 17"></a>Day 17</h2><ol>
<li>canal 数据同步工具</li>
<li>SpringCloud 组件—— Gateway 网关</li>
<li>权限管理模块<ul>
<li>权限管理需求</li>
<li>权限管理接口</li>
</ul>
</li>
</ol>
<h3 id="canal-数据同步工具"><a href="#canal-数据同步工具" class="headerlink" title="canal 数据同步工具"></a>canal 数据同步工具</h3><blockquote>
<p>canal 是阿里巴巴的一个开源项目，基于 Java 开发，支持 MySQL 数据库</p>
</blockquote>
<h4 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h4><p>把远程库内容同步到本地库</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211103145848.png" loading="lazy"></p>
<h4 id="canal-同步过程"><a href="#canal-同步过程" class="headerlink" title="canal 同步过程"></a>canal 同步过程</h4><ul>
<li><p>linux 系统</p>
<ul>
<li><p>安装 MySQL 数据库</p>
<p>创建数据库和数据表</p>
</li>
<li><p>安装 canal 数据同步工具</p>
</li>
</ul>
</li>
<li><p>本地 windows 系统</p>
<ul>
<li>创建数据库和数据表</li>
</ul>
</li>
</ul>
<h5 id="修改-linux-系统-MySQL-数据库配置"><a href="#修改-linux-系统-MySQL-数据库配置" class="headerlink" title="修改 linux 系统 MySQL 数据库配置"></a>修改 linux 系统 MySQL 数据库配置</h5><blockquote>
<p>检查 binlog 功能是否开启</p>
</blockquote>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">show variables like &#39;log_bin&#39;</code></pre>

<p>若 Value 为 OFF，表示未开启</p>
<p>若 Value 为 ON，表示已开启</p>
<blockquote>
<p>修改 MySQL 配置文件 my.cnf</p>
</blockquote>
<pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">vi</span> /etc/my.cnf</code></pre>

<p>追加内容</p>
<pre class="language-shell" data-language="shell"><code class="language-shell">log-bin<span class="token operator">=</span>mysql-bin
<span class="token assign-left variable">binlog_format</span><span class="token operator">=</span>ROW
<span class="token assign-left variable">server_id</span><span class="token operator">=</span><span class="token number">1</span></code></pre>

<blockquote>
<p>重启 MySQL 数据库</p>
</blockquote>
<p>重启后再去查看 binlog，若变为 ON，则已经开启</p>
<h5 id="安装-canal-工具"><a href="#安装-canal-工具" class="headerlink" title="安装 canal 工具"></a>安装 canal 工具</h5><ol>
<li><p>把 canal 压缩文件上传到 linux 系统</p>
</li>
<li><p>解压缩</p>
</li>
<li><p>修改 canal 配置文件</p>
<pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">vi</span> conf/example/instance.properties</code></pre>

<pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># 需要改成自己的数据库信息</span>
canal.instance.master.address<span class="token operator">=</span>
canal.instance.dbUsername<span class="token operator">=</span>
canal.instance.dbPassword<span class="token operator">=</span>
canal.instance.filter.regex<span class="token operator">=</span></code></pre></li>
<li><p>启动 canal</p>
</li>
</ol>
<h4 id="canal-代码编写"><a href="#canal-代码编写" class="headerlink" title="canal 代码编写"></a>canal 代码编写</h4><ol>
<li>创建模块 <code>canal_clientedu</code></li>
<li>在该模块中引入依赖</li>
<li>创建 application.properties 配置文件</li>
<li>创建 canal 客户端类 <code>CanalClient</code>，执行启动类 <code>CanalApplication</code></li>
</ol>
<h3 id="Gateway-网关"><a href="#Gateway-网关" class="headerlink" title="Gateway 网关"></a>Gateway 网关</h3><h4 id="什么是网关"><a href="#什么是网关" class="headerlink" title="什么是网关"></a>什么是网关</h4><p>在客户端和服务端中间隔一面墙，其作用：请求转发、负载均衡、权限控制等</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211103163345.png" alt="image-20211103163338962" loading="lazy"></p>
<h4 id="Gateway"><a href="#Gateway" class="headerlink" title="Gateway"></a>Gateway</h4><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211103163818.png" alt="image-20211103163816506" loading="lazy"></p>
<h4 id="Gateway-具体使用"><a href="#Gateway-具体使用" class="headerlink" title="Gateway 具体使用"></a>Gateway 具体使用</h4><ol>
<li><p>创建微服务模块 <code>api_gateway</code></p>
</li>
<li><p>在模块中引入相关依赖</p>
</li>
<li><p>创建启动类和配置文件，在配置文件中配置网关规则</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApiGatewayApplication</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ApiGatewayApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<pre class="language-properties" data-language="properties"><code class="language-properties"><span class="token comment"># 服务端口</span>
<span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">8222</span>
<span class="token comment"># 服务名</span>
<span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">service-gateway</span>
<span class="token comment"># nacos服务地址</span>
<span class="token attr-name">spring.cloud.nacos.discovery.server-addr</span><span class="token punctuation">=</span><span class="token attr-value">127.0.0.1:8848</span>

<span class="token comment">#使用服务发现路由</span>
<span class="token attr-name">spring.cloud.gateway.discovery.locator.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span>

<span class="token comment">#设置路由id</span>
<span class="token attr-name">spring.cloud.gateway.routes[0].id</span><span class="token punctuation">=</span><span class="token attr-value">service-acl</span>
<span class="token comment">#设置路由的uri   lb://nacos注册服务名称</span>
<span class="token attr-name">spring.cloud.gateway.routes[0].uri</span><span class="token punctuation">=</span><span class="token attr-value">lb://service-acl</span>
<span class="token comment">#设置路由断言,代理servicerId为auth-service的/auth/路径</span>
<span class="token attr-name">spring.cloud.gateway.routes[0].predicates</span><span class="token punctuation">=</span> <span class="token attr-value">Path=/*/acl/**</span>

<span class="token comment">#配置service-edu服务</span>
<span class="token attr-name">spring.cloud.gateway.routes[1].id</span><span class="token punctuation">=</span><span class="token attr-value">service-edu</span>
<span class="token attr-name">spring.cloud.gateway.routes[1].uri</span><span class="token punctuation">=</span><span class="token attr-value">lb://service-edu</span>
<span class="token attr-name">spring.cloud.gateway.routes[1].predicates</span><span class="token punctuation">=</span> <span class="token attr-value">Path=/eduservice/**</span>

<span class="token comment">#配置service-edu服务</span>
<span class="token attr-name">spring.cloud.gateway.routes[2].id</span><span class="token punctuation">=</span><span class="token attr-value">service-msm</span>
<span class="token attr-name">spring.cloud.gateway.routes[2].uri</span><span class="token punctuation">=</span><span class="token attr-value">lb://service-msm</span>
<span class="token attr-name">spring.cloud.gateway.routes[2].predicates</span><span class="token punctuation">=</span> <span class="token attr-value">Path=/edumsm/**</span></code></pre></li>
</ol>
<h4 id="Gateway-负载均衡"><a href="#Gateway-负载均衡" class="headerlink" title="Gateway 负载均衡"></a>Gateway 负载均衡</h4><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211103164932.png" alt="image-20211103164930033" loading="lazy"></p>
<h3 id="权限管理模块"><a href="#权限管理模块" class="headerlink" title="权限管理模块"></a>权限管理模块</h3><h4 id="权限管理需求"><a href="#权限管理需求" class="headerlink" title="权限管理需求"></a>权限管理需求</h4><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20211103165134.png" alt="image-20211103165131861" loading="lazy"></p>
<h4 id="后端接口整合"><a href="#后端接口整合" class="headerlink" title="后端接口整合"></a>后端接口整合</h4><ol>
<li><p>创建子模块，在 <code>service</code> 里创建 <code>service_acl</code></p>
</li>
<li><p>该模块引入依赖</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependencies<span class="token punctuation">></span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>com<span class="token punctuation">.</span>atguigu<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>spring_security<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">></span></span><span class="token number">0.0</span><span class="token number">.1</span><span class="token operator">-</span>SNAPSHOT<span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>com<span class="token punctuation">.</span>alibaba<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>fastjson<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">></span></code></pre></li>
<li><p>引入<code>service_acl</code> 模块的核心代码，包含 <code>application.properties</code></p>
</li>
<li><p>在 <code>common</code> 模块中引入 <code>spring_security</code> 代码，包含 <code>pom.xml</code></p>
</li>
</ol>
<h4 id="递归查询菜单"><a href="#递归查询菜单" class="headerlink" title="递归查询菜单"></a>递归查询菜单</h4><p><img src="C:\Users\yinwu\AppData\Roaming\Typora\typora-user-images\image-20211104150550276.png" alt="image-20211104150550276" loading="lazy"></p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//========================递归查询所有菜单================================================</span>
<span class="token comment">//获取全部菜单</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Permission</span><span class="token punctuation">></span></span> <span class="token function">queryAllMenuGuli</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//1 查询菜单表所有数据</span>
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Permission</span><span class="token punctuation">></span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">orderByDesc</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Permission</span><span class="token punctuation">></span></span> permissionList <span class="token operator">=</span> baseMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//2 把查询所有菜单list集合按照要求进行封装</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Permission</span><span class="token punctuation">></span></span> resultList <span class="token operator">=</span> <span class="token function">bulidPermission</span><span class="token punctuation">(</span>permissionList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> resultList<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//把返回所有菜单list集合进行封装的方法</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Permission</span><span class="token punctuation">></span></span> <span class="token function">bulidPermission</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Permission</span><span class="token punctuation">></span></span> permissionList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">//创建list集合，用于数据最终封装</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Permission</span><span class="token punctuation">></span></span> finalNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//把所有菜单list集合遍历，得到顶层菜单 pid=0菜单，设置level是1</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Permission</span> permissionNode <span class="token operator">:</span> permissionList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//得到顶层菜单 pid=0菜单</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>permissionNode<span class="token punctuation">.</span><span class="token function">getPid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">//设置顶层菜单的level是1</span>
            permissionNode<span class="token punctuation">.</span><span class="token function">setLevel</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//根据顶层菜单，向里面进行查询子菜单，封装到finalNode里面</span>
            finalNode<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">selectChildren</span><span class="token punctuation">(</span>permissionNode<span class="token punctuation">,</span>permissionList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> finalNode<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Permission</span> <span class="token function">selectChildren</span><span class="token punctuation">(</span><span class="token class-name">Permission</span> permissionNode<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Permission</span><span class="token punctuation">></span></span> permissionList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//1 因为向一层菜单里面放二层菜单，二层里面还要放三层，把对象初始化</span>
    permissionNode<span class="token punctuation">.</span><span class="token function">setChildren</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Permission</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//2 遍历所有菜单list集合，进行判断比较，比较id和pid值是否相同</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Permission</span> it <span class="token operator">:</span> permissionList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//判断 id和pid值是否相同</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>permissionNode<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">getPid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">//把父菜单的level值+1</span>
            <span class="token keyword">int</span> level <span class="token operator">=</span> permissionNode<span class="token punctuation">.</span><span class="token function">getLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
            it<span class="token punctuation">.</span><span class="token function">setLevel</span><span class="token punctuation">(</span>level<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//如果children为空，进行初始化操作</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>permissionNode<span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                permissionNode<span class="token punctuation">.</span><span class="token function">setChildren</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Permission</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token comment">//把查询出来的子菜单放到父菜单里面</span>
            permissionNode<span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">selectChildren</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span>permissionList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> permissionNode<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h4 id="递归删除菜单"><a href="#递归删除菜单" class="headerlink" title="递归删除菜单"></a>递归删除菜单</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//============递归删除菜单==================================</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeChildByIdGuli</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//1 创建list集合，用于封装所有删除菜单id值</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> idList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//2 向idList集合设置删除菜单id</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">selectPermissionChildById</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>idList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//把当前id封装到list里面</span>
    idList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    baseMapper<span class="token punctuation">.</span><span class="token function">deleteBatchIds</span><span class="token punctuation">(</span>idList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//2 根据当前菜单id，查询菜单里面子菜单id，封装到list集合</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">selectPermissionChildById</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> idList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//查询菜单里面子菜单id</span>
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Permission</span><span class="token punctuation">></span></span>  wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"pid"</span><span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Permission</span><span class="token punctuation">></span></span> childIdList <span class="token operator">=</span> baseMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//把childIdList里面菜单id值获取出来，封装idList里面，做递归查询</span>
    childIdList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//封装idList里面</span>
        idList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//递归查询</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">selectPermissionChildById</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>idList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h4 id="角色分配菜单"><a href="#角色分配菜单" class="headerlink" title="角色分配菜单"></a>角色分配菜单</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//=========================给角色分配菜单=======================</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveRolePermissionRealtionShipGuli</span><span class="token punctuation">(</span><span class="token class-name">String</span> roleId<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> permissionIds<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//roleId角色id</span>
    <span class="token comment">//permissionId菜单id 数组形式</span>
    <span class="token comment">//1 创建list集合，用于封装添加数据</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RolePermission</span><span class="token punctuation">></span></span> rolePermissionList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//遍历所有菜单数组</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">String</span> perId <span class="token operator">:</span> permissionIds<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//RolePermission对象</span>
        <span class="token class-name">RolePermission</span> rolePermission <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RolePermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rolePermission<span class="token punctuation">.</span><span class="token function">setRoleId</span><span class="token punctuation">(</span>roleId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        rolePermission<span class="token punctuation">.</span><span class="token function">setPermissionId</span><span class="token punctuation">(</span>perId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//封装到list集合</span>
        rolePermissionList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rolePermission<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//添加到角色菜单关系表</span>
    rolePermissionService<span class="token punctuation">.</span><span class="token function">saveBatch</span><span class="token punctuation">(</span>rolePermissionList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h2 id="Day-18"><a href="#Day-18" class="headerlink" title="Day 18"></a>Day 18</h2><ol>
<li>整合 Spring Security 权限框架</li>
<li>Nacos 配置中心</li>
<li>提交项目到远程 Git 仓库( Gitee / GitHub )</li>
</ol>
<h3 id="Spring-Security"><a href="#Spring-Security" class="headerlink" title="Spring Security"></a>Spring Security</h3><h4 id="框架介绍"><a href="#框架介绍" class="headerlink" title="框架介绍"></a>框架介绍</h4><p>Spring Security 主要包含两部分：<strong>用户认证</strong>和<strong>用户授权</strong></p>
<ul>
<li><p>用户认证</p>
<p>用户进行登录时，输入用户名及密码，后端查询数据库，验证用户名和密码是否正确，若正确则认证成功</p>
</li>
<li><p>用户授权</p>
<p>用户登录系统后，该登录用户可能是不同的角色，若为管理员，则具有所有操作功能，若为普通用户，则只拥有部分操作功能</p>
</li>
</ul>
<p><strong>Spring Security 本质上就是过滤器（Filter），对请求进行过滤</strong></p>
<h4 id="授权过程"><a href="#授权过程" class="headerlink" title="授权过程"></a><span id="授权过程">授权过程</span></h4><p><img src="C:\Users\yinwu\AppData\Roaming\Typora\typora-user-images\image-20211104151234053.png" alt="image-20211104151234053" loading="lazy"></p>
<h4 id="代码执行过程"><a href="#代码执行过程" class="headerlink" title="代码执行过程"></a><span id="代码执行过程">代码执行过程</span></h4><p><img src="C:\Users\yinwu\AppData\Roaming\Typora\typora-user-images\image-20211104151339393.png" alt="image-20211104151339393" loading="lazy"></p>
<h3 id="Nacos-配置中心"><a href="#Nacos-配置中心" class="headerlink" title="Nacos 配置中心"></a>Nacos 配置中心</h3><h4 id="配置中心的作用"><a href="#配置中心的作用" class="headerlink" title="配置中心的作用"></a>配置中心的作用</h4><p><img src="C:\Users\yinwu\AppData\Roaming\Typora\typora-user-images\image-20211104151432726.png" alt="image-20211104151432726" loading="lazy"></p>
<h3 id="Spring-Boot-配置文件"><a href="#Spring-Boot-配置文件" class="headerlink" title="Spring Boot 配置文件"></a>Spring Boot 配置文件</h3><h4 id="配置文件的加载顺序"><a href="#配置文件的加载顺序" class="headerlink" title="配置文件的加载顺序"></a>配置文件的加载顺序</h4><ol>
<li><p><code>bootstrap.properties</code></p>
</li>
<li><p><code>application.properties</code></p>
<ul>
<li><pre><code class="properties">spring.profiles.active=dev
</code></pre>
</li>
</ul>
</li>
<li><p><code>application-dev.properties</code></p>
</li>
</ol>
<h2 id="Day-19"><a href="#Day-19" class="headerlink" title="Day 19"></a>Day 19</h2><p>持续化部署工具 jenkins</p>
<ul>
<li>手动打包运行</li>
<li>自动打包运行</li>
</ul>
<h2 id="Day-20-总结"><a href="#Day-20-总结" class="headerlink" title="Day 20 总结"></a>Day 20 总结</h2><ol>
<li>总结项目功能</li>
<li>总结项目技术点</li>
<li>总结项目问题</li>
</ol>
<h3 id="项目描述"><a href="#项目描述" class="headerlink" title="项目描述"></a>项目描述</h3><h4 id="对项目总体介绍"><a href="#对项目总体介绍" class="headerlink" title="对项目总体介绍"></a>对项目总体介绍</h4><p>在线教育项目采用 B2C 商业模块，使用微服务架构，项目采用前后端分离开发</p>
<h4 id="项目功能模块-1"><a href="#项目功能模块-1" class="headerlink" title="项目功能模块"></a>项目功能模块</h4><p>在线教育项目分为前台系统和后台系统</p>
<ul>
<li>前台系统<ul>
<li>首页数据显示</li>
<li>课程列表和详情</li>
<li>课程支付</li>
<li>课程视频播放</li>
<li>微信登录</li>
<li>微信支付</li>
<li>…</li>
</ul>
</li>
<li>后台系统<ul>
<li>权限管理</li>
<li>课程管理</li>
<li>统计分析</li>
<li>课程分类管理</li>
<li>…</li>
</ul>
</li>
</ul>
<h4 id="项目涉及技术"><a href="#项目涉及技术" class="headerlink" title="项目涉及技术"></a>项目涉及技术</h4><p>项目采用前后端分离开发</p>
<ul>
<li>前端技术<ul>
<li>vue</li>
<li>element-ui</li>
<li>nuxt</li>
<li>babel</li>
</ul>
</li>
<li>后端技术<ul>
<li>Spring Boot</li>
<li>Spring Cloud</li>
<li>EasyExcel</li>
<li>…</li>
</ul>
</li>
<li>第三方技术<ul>
<li>阿里云 OSS</li>
<li>视频点播</li>
<li>短信服务</li>
</ul>
</li>
</ul>
<h3 id="总结项目功能"><a href="#总结项目功能" class="headerlink" title="总结项目功能"></a>总结项目功能</h3><h4 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h4><ol>
<li>启动后端接口</li>
<li>启动前端项目（前台系统和后台系统）</li>
</ol>
<h4 id="项目后台管理系统功能"><a href="#项目后台管理系统功能" class="headerlink" title="项目后台管理系统功能"></a>项目后台管理系统功能</h4><h5 id="登录功能"><a href="#登录功能" class="headerlink" title="登录功能"></a>登录功能</h5><p>Spring Security 框架</p>
<h5 id="权限管理模块-1"><a href="#权限管理模块-1" class="headerlink" title="权限管理模块"></a>权限管理模块</h5><ol>
<li><p>菜单管理</p>
<ul>
<li>列表总览、添加、修改、删除</li>
</ul>
</li>
<li><p>角色管理</p>
<ul>
<li><p>列表总览、添加、修改、删除（批量删除）</p>
</li>
<li><p>为角色分配菜单</p>
</li>
</ul>
</li>
<li><p>用户管理</p>
<ul>
<li><p>列表总览、添加、修改、删除（批量删除）</p>
</li>
<li><p>为用户分配角色</p>
</li>
</ul>
</li>
<li><p>权限管理表和关系</p>
<ul>
<li><p>使用五张表</p>
<p><code>acl_permission</code></p>
<p><code>acl_role</code></p>
<p><code>acl_role_permission</code></p>
<p><code>acl_user</code></p>
<p><code>acl_user_role</code></p>
</li>
</ul>
</li>
</ol>
<h5 id="讲师管理模块"><a href="#讲师管理模块" class="headerlink" title="讲师管理模块"></a>讲师管理模块</h5><p>条件查询分页列表、添加、修改、删除</p>
<h5 id="课程分类模块"><a href="#课程分类模块" class="headerlink" title="课程分类模块"></a>课程分类模块</h5><ol>
<li>添加课程分类<ul>
<li>读取 Excel 课程分类数据，并添加到数据库中</li>
</ul>
</li>
<li>课程分类列表<ul>
<li>使用树形结构显示课程分类列表</li>
</ul>
</li>
</ol>
<h5 id="课程管理模块"><a href="#课程管理模块" class="headerlink" title="课程管理模块"></a>课程管理模块</h5><ol>
<li><p>课程列表功能</p>
</li>
<li><p>添加课程</p>
<ul>
<li><p>课程发布流程：</p>
<p>第一步填写课程基本信息</p>
<p>第二步添加课程大纲（章节和小节）</p>
<p>第三步确认课程信息，最终课程发布</p>
</li>
<li><p>如何判断课程是否已被发布</p>
<p>使用 status 字段</p>
</li>
<li><p>添加课程时，中途停止添加，重新添加另一课程，如何找到之前未发布的课程，继续发布？</p>
<p>根据课程状态，到课程列表中查询未发布的课程，点击课程右边超链接，继续发布课程</p>
</li>
</ul>
</li>
<li><p>添加小节，上传课程视频</p>
</li>
</ol>
<h5 id="统计分析模块-1"><a href="#统计分析模块-1" class="headerlink" title="统计分析模块"></a>统计分析模块</h5><ol>
<li>生成统计数据</li>
<li>统计数据图表显示</li>
</ol>
<h4 id="项目前台用户系统功能"><a href="#项目前台用户系统功能" class="headerlink" title="项目前台用户系统功能"></a>项目前台用户系统功能</h4><h5 id="首页数据显示"><a href="#首页数据显示" class="headerlink" title="首页数据显示"></a>首页数据显示</h5><ol>
<li>显示幻灯片</li>
<li>显示热门课程</li>
<li>显示名师</li>
</ol>
<h5 id="注册功能"><a href="#注册功能" class="headerlink" title="注册功能"></a>注册功能</h5><p>获取手机验证码</p>
<h5 id="登录功能-1"><a href="#登录功能-1" class="headerlink" title="登录功能"></a>登录功能</h5><ol>
<li><p>输入用户名和密码登录（一般登录）</p>
<ul>
<li><p>SSO (单点登录)</p>
<p>单点登录常见方式：</p>
<ul>
<li>Session 广播机制</li>
<li>使用 Cookie + Redis</li>
<li>使用 token</li>
</ul>
</li>
<li><p>JWT</p>
<p>使用 JWT 生成 token 字符串</p>
<p>JWT 由三部分组成</p>
</li>
<li><p>登录实现流程</p>
<p>调用登录接口，返回 token，添加到 Cookie</p>
<p>创建前端拦截器进行判断，若 Cookie 中包含 token，把 token 添加到 Header，调用接口，根据 token 获取用户信息，添加到 Cookie，显示用户信息</p>
</li>
</ul>
</li>
<li><p>微信扫描登录</p>
<ul>
<li><p>OAuth 2</p>
<p>用于解决两个问题：开放系统间授权和分布式访问</p>
</li>
<li><p>如何获取扫描人信息？</p>
<p>扫描后调用微信接口，返回 code (临时票据)，请求微信 URL，得到 access_token (访问凭证)和 openid (微信唯一标识)，再次请求微信 URL，得到扫描人信息（昵称、头像等）</p>
</li>
</ul>
</li>
</ol>
<h5 id="名师列表功能-1"><a href="#名师列表功能-1" class="headerlink" title="名师列表功能"></a>名师列表功能</h5><h5 id="名师详情功能"><a href="#名师详情功能" class="headerlink" title="名师详情功能"></a>名师详情功能</h5><h5 id="课程列表功能-2"><a href="#课程列表功能-2" class="headerlink" title="课程列表功能"></a>课程列表功能</h5><p>条件分页查询</p>
<h5 id="课程详情页"><a href="#课程详情页" class="headerlink" title="课程详情页"></a>课程详情页</h5><ol>
<li>课程信息显示（包括课程概要、分类、讲师、课程大纲）</li>
<li>判断课程是否需要购买</li>
</ol>
<h5 id="课程视频在线播放"><a href="#课程视频在线播放" class="headerlink" title="课程视频在线播放"></a>课程视频在线播放</h5><h5 id="课程支付功能（微信支付）"><a href="#课程支付功能（微信支付）" class="headerlink" title="课程支付功能（微信支付）"></a><span id="微信支付">课程支付功能（微信支付）</span></h5><ol>
<li>生成课程订单</li>
<li>生成微信支付二维码</li>
<li>微信支付</li>
</ol>
<blockquote>
<p>微信支付实现流程</p>
</blockquote>
<p>若课程是收费课程，点击立即购买，生成订单，点击订单进行支付，生成微信二维码，扫描二维码实现支付</p>
<p>支付后，每隔 3 秒查询支付状态（是否支付成功），若未支付则继续等待，若支付成功，则更新订单状态，向支付记录表添加支付成功记录</p>
<h3 id="总结项目技术点（前端）"><a href="#总结项目技术点（前端）" class="headerlink" title="总结项目技术点（前端）"></a>总结项目技术点（前端）</h3><h4 id="vue"><a href="#vue" class="headerlink" title="vue"></a>vue</h4><ul>
<li><p>基本语法</p>
</li>
<li><p>常见指令：<code>v-bind</code> <code>v-model</code> <code>v-if</code> <code>v-for</code> <code>v-html</code></p>
</li>
<li><p>绑定事件：<code>v-on-click</code> <code>@click</code></p>
</li>
<li><p>生命周期：<code>created()</code> 页面渲染前 <code>mounted()</code> 页面渲染后</p>
</li>
<li><p>ES6 规范</p>
</li>
</ul>
<h4 id="Element-ui"><a href="#Element-ui" class="headerlink" title="Element-ui"></a>Element-ui</h4><h4 id="nodejs-1"><a href="#nodejs-1" class="headerlink" title="nodejs"></a>nodejs</h4><p>nodejs 是 JavaScript 运行环境，无需浏览器就可直接运行 js 代码，模拟服务器效果</p>
<h4 id="NPM"><a href="#NPM" class="headerlink" title="NPM"></a>NPM</h4><ul>
<li>包管理工具，类似 Maven</li>
<li>npm命令：<code>npm init</code> <code>npm install xxxx</code></li>
</ul>
<h4 id="Babel"><a href="#Babel" class="headerlink" title="Babel"></a>Babel</h4><p>转码器，可以把 ES6 代码转换成 ES5 代码</p>
<h4 id="前端模块化"><a href="#前端模块化" class="headerlink" title="前端模块化"></a>前端模块化</h4><p>通过一个页面或一个 js 文件，调用另一个 js 文件里的方法</p>
<p>出现的问题：ES6 的模块化无法在 Node.js 中执行，需要用 Babel 编辑成 ES5 后再执行</p>
<h4 id="后台系统"><a href="#后台系统" class="headerlink" title="后台系统"></a>后台系统</h4><p>使用 <code>vue-admin-template</code>，基于 <code>vue</code> + <code>Element-ui</code></p>
<h4 id="前台系统"><a href="#前台系统" class="headerlink" title="前台系统"></a>前台系统</h4><p>使用 <code>Nuxt</code>，基于 <code>vue</code></p>
<p>服务器渲染技术</p>
<h4 id="Echarts"><a href="#Echarts" class="headerlink" title="Echarts"></a>Echarts</h4><p>图表工具</p>
<h3 id="总结项目技术点（后端）"><a href="#总结项目技术点（后端）" class="headerlink" title="总结项目技术点（后端）"></a>总结项目技术点（后端）</h3><p>项目采用微服务架构</p>
<h4 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h4><ol>
<li>SpringBoot 本质就是 Spring，只是快速构建 Spring 工程的脚手架</li>
<li>细节<ul>
<li>启动类包扫描机制</li>
<li>设置扫描规则 <code>@ComponentScan(&quot;包路径&quot;)</code></li>
<li>配置类</li>
</ul>
</li>
<li>SpringBoot 配置文件<ul>
<li>配置文件类型：properties 和 yml</li>
<li>配置文件加载顺序：<code>bootstrap</code> <code>application</code> <code>applicaiton-dev</code></li>
</ul>
</li>
</ol>
<h4 id="SpringCloud-1"><a href="#SpringCloud-1" class="headerlink" title="SpringCloud"></a>SpringCloud</h4><ol>
<li><p>是很多框架的总称，使用这些框架可以实现微服务架构</p>
</li>
<li><p>框架组成</p>
<ul>
<li>服务发现 <code>Netflix Eureka</code> <code>Nacos</code></li>
<li>服务调用 <code>Netflix Feign</code></li>
<li>熔断器 <code>Netflix Hystrix</code></li>
<li>服务网关 <code>Spring Cloud Gateway</code></li>
<li>分布式配置 <code>Spring Cloud Config</code> <code>Nacos</code></li>
<li>消息总线 <code>Spring Cloud Bus</code> <code>Nacos</code></li>
</ul>
</li>
<li><p>项目中使用 <code>Alibaba Nacos</code> 替代 SpringCloud 一些组件</p>
<ul>
<li>Nacos 作为注册中心</li>
<li>Nacos 作为配置中心</li>
</ul>
</li>
<li><p>Feign</p>
<p>服务调用，一个微服务调用另一个微服务，即远程调用</p>
</li>
<li><p>熔断器</p>
</li>
<li><p>Gateway 网关</p>
<p>SpringCloud 之前使用 zuul 网关，目前使用 Gateway 网关</p>
</li>
</ol>
<h4 id="MyBatisPlus"><a href="#MyBatisPlus" class="headerlink" title="MyBatisPlus"></a>MyBatisPlus</h4><ol>
<li>MyBatisPlus 就是 MyBatis 增强版</li>
<li>自动填充</li>
<li>乐观锁</li>
<li>逻辑删除</li>
<li>代码生成器</li>
</ol>
<h4 id="EasyExcel"><a href="#EasyExcel" class="headerlink" title="EasyExcel"></a>EasyExcel</h4><ol>
<li>阿里巴巴提供的操作 Excel 工具，代码简洁且效率高</li>
<li>对 POI 进行封装，采用 SAX 方式解析</li>
<li>项目中应用场景：添加课程分类，读取 Excel 数据</li>
</ol>
<h4 id="SpringSecurity"><a href="#SpringSecurity" class="headerlink" title="SpringSecurity"></a>SpringSecurity</h4><ol>
<li>在项目整合框架实现权限管理功能</li>
<li>SpringSecurity 框架组成：认证和授权</li>
<li><a href="#%E6%8E%88%E6%9D%83%E8%BF%87%E7%A8%8B">SpringSecurity 认证过程</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B">SpringSecurity 代码执行过程</a></li>
</ol>
<h4 id="Redis-1"><a href="#Redis-1" class="headerlink" title="Redis"></a>Redis</h4><ol>
<li>首页数据通过 Redis 进行缓存</li>
<li>Redis 数据类型</li>
<li>Redis 缓存适用于不太重要或不经常更改的数据</li>
</ol>
<h4 id="Nginx-1"><a href="#Nginx-1" class="headerlink" title="Nginx"></a>Nginx</h4><ol>
<li>反向代理服务器</li>
<li>请求转发，负载均衡，动静分离</li>
</ol>
<h4 id="OAuth2-JWT"><a href="#OAuth2-JWT" class="headerlink" title="OAuth2 + JWT"></a>OAuth2 + JWT</h4><ol>
<li>OAuth2 是一套特定问题的解决方案</li>
<li>JWT 三个组成部分</li>
</ol>
<h4 id="HttpClient"><a href="#HttpClient" class="headerlink" title="HttpClient"></a>HttpClient</h4><ol>
<li>发送请求返回响应的工具，无需浏览器完成请求和响应的过程</li>
<li>应用场景：微信登录获取扫描人信息，微信支付查询支付状态</li>
</ol>
<h4 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h4><ol>
<li>客户端技术</li>
<li>每次发送请求携带 Cookie</li>
<li>Cookie 有默认会话级别，一般关闭浏览器 Cookie 则消失</li>
<li>Cookie 可以设置有效时长 <code>setMaxAge()</code></li>
</ol>
<p>参考另一篇文章 Cookie 和 Session</p>
<h4 id="微信支付"><a href="#微信支付" class="headerlink" title="微信支付"></a><a href="#%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98">微信支付</a></h4><h4 id="阿里云-OSS"><a href="#阿里云-OSS" class="headerlink" title="阿里云 OSS"></a>阿里云 OSS</h4><ol>
<li>文件存储服务器</li>
<li>应用场景：添加讲师时上传讲师头像</li>
</ol>
<h4 id="阿里云视频点播-1"><a href="#阿里云视频点播-1" class="headerlink" title="阿里云视频点播"></a>阿里云视频点播</h4><ol>
<li>视频上传、播放、删除</li>
<li>整合阿里云视频播放器</li>
</ol>
<h4 id="阿里云短信服务-1"><a href="#阿里云短信服务-1" class="headerlink" title="阿里云短信服务"></a>阿里云短信服务</h4><p>注册时发送手机验证码</p>
<h4 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h4><p>代码提交到远程 GIt 仓库</p>
<h4 id="Docker-Jenkins"><a href="#Docker-Jenkins" class="headerlink" title="Docker + Jenkins"></a>Docker + Jenkins</h4><ol>
<li>手动打包运行</li>
<li>IDEA 打包</li>
<li>Jenkins 自动化部署</li>
</ol>
<h3 id="总结项目问题"><a href="#总结项目问题" class="headerlink" title="总结项目问题"></a>总结项目问题</h3><h4 id="前端：路由切换问题"><a href="#前端：路由切换问题" class="headerlink" title="前端：路由切换问题"></a>前端：路由切换问题</h4><p>多次路由跳转到同一 vue 界面，页面 <code>created()</code> 方法只会执行一次</p>
<p>解决：使用 vue 监听</p>
<h4 id="前端：ES6-模块化运行问题"><a href="#前端：ES6-模块化运行问题" class="headerlink" title="前端：ES6 模块化运行问题"></a>前端：ES6 模块化运行问题</h4><p>Nodejs 不能直接运行 ES6 模块化代码，需要使用 Babel 把 ES6 代码转换为 ES5 代码执行</p>
<h4 id="MyBatisPlus-生成19位-id-值问题"><a href="#MyBatisPlus-生成19位-id-值问题" class="headerlink" title="MyBatisPlus 生成19位 id 值问题"></a>MyBatisPlus 生成19位 id 值问题</h4><p>MyBatisPlus 生成 id 值为 19 位，JavaScript 处理数字类型时，只会处理到 16 位</p>
<h4 id="跨域问题"><a href="#跨域问题" class="headerlink" title="跨域问题"></a>跨域问题</h4><p>访问协议、ip地址、端口号，三者有任一不一样，就会产生跨域问题</p>
<p>解决：</p>
<ol>
<li>在 Controller 添加注解 <code>@CrossOrigin</code></li>
<li>通过网关解决</li>
</ol>
<h4 id="413-问题"><a href="#413-问题" class="headerlink" title="413 问题"></a>413 问题</h4><p>上传视频时，由于 Nginx 有上传文件大小限制，若超过其大小，则会出现 413 问题</p>
<blockquote>
<p>413：请求体过大</p>
</blockquote>
<p>解决：</p>
<p>在 Nginx 配置文件中设置客户端大小</p>
<h4 id="Maven-加载问题"><a href="#Maven-加载问题" class="headerlink" title="Maven 加载问题"></a>Maven 加载问题</h4><p>Maven 加载项目时，默认不会加载 <code>src/java</code> 中的 <code>.xml</code> 类型文件</p>
<p>解决：</p>
<ol>
<li>直接复制 xml 文件到 target 目录（不推荐）</li>
<li>通过配置实现</li>
</ol>
</div><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author: </strong>Rayucan</li><li class="post-copyright-link"><strong>Post link: </strong><a href="http://example.com/2021/07/01/Cloud-Learning/" title="云课项目">http://example.com/2021/07/01/Cloud-Learning/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> unless otherwise stated.</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2021/09/20/JUnit%E6%B5%8B%E8%AF%95Quartz%E5%A4%B1%E8%B4%A5/" rel="prev" title="JUnit 测试 Quartz 失败"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">JUnit 测试 Quartz 失败</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2021/06/19/Eclipse%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE/" rel="next" title="Eclipse配置"><span class="post-nav-text">Eclipse配置</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>要不要和我说些什么？</span><br></div></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2020 – 2023 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> Rayucan</span></div><div class="powered"><span>Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> v5.4.0</span><span class="footer-separator">|</span><span>Theme - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.6.1</span></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></div></body></html>