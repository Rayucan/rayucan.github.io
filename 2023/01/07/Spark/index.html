<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="rayucan"><meta name="copyright" content="rayucan"><meta name="generator" content="Hexo 5.4.0"><meta name="theme" content="hexo-theme-yun"><title>Spark | null</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.25/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link id="light-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism.css" media="(prefers-color-scheme: light)"><link id="dark-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism-tomorrow.css" media="(prefers-color-scheme: dark)"><link rel="icon" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"example.com","root":"/","title":null,"version":"1.6.1","mode":"dark","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}.","hits":"${hits} results found","hits_time":"${hits} results found in ${time} ms"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><meta property="og:type" content="article">
<meta property="og:title" content="Spark">
<meta property="og:url" content="http://example.com/2023/01/07/Spark/index.html">
<meta property="og:site_name">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302181721476.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301262248986.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301072233317.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301072236644.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301072241630.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301151551701.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301251709807.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301251731274.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301261549630.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301261557083.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301261558191.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301261622672.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301261628117.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301261712105.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301261711887.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301261716326.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301261653967.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301261655898.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301262300141.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301262351595.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302091705504.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302091705344.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302091712456.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302091731919.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302091732650.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302091753853.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302091754211.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302091741399.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302101720543.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302101721345.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302132144518.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302132144369.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302132144548.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302132214130.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302132156508.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302191540611.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302191540945.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302191542019.png">
<meta property="article:published_time" content="2023-01-07T09:07:48.000Z">
<meta property="article:modified_time" content="2023-02-19T07:50:32.000Z">
<meta property="article:author" content="rayucan">
<meta property="article:tag" content="BigData">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302181721476.png"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="rayucan"><img width="96" loading="lazy" src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/20210515231431.jpg" alt="rayucan"><span class="site-author-status" title="ç½‘ä¸Šå†²æµª">ğŸ„</span></a><div class="site-author-name"><a href="/about/">rayucan</a></div><a class="site-name" href="/about/site.html"></a><sub class="site-subtitle">å±±è€Œ</sub><div class="site-desciption">å±±æµ·æ‚ æ‚ ï¼Œè€Œäººåœ¨æ¼«æ­¥è¡Œèµ°</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="Home"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">53</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">3</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">8</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="æ–‡æ¡£"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/Rayucan" title="GitHub" target="_blank" style="color:#181717"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a></div></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Spark-%E4%B8%8E-Hadoop"><span class="toc-number">1.</span> <span class="toc-text">Spark ä¸ Hadoop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spark-%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97"><span class="toc-number">2.</span> <span class="toc-text">Spark æ ¸å¿ƒæ¨¡å—</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Word-Count"><span class="toc-number">3.</span> <span class="toc-text">Word Count</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-number">3.1.</span> <span class="toc-text">åŠŸèƒ½å®ç°æµç¨‹å›¾</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Word-Count-%E4%BC%98%E5%8C%96"><span class="toc-number">4.</span> <span class="toc-text">Word Count ä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B9%E8%BF%9B"><span class="toc-number">4.1.</span> <span class="toc-text">æ”¹è¿›</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spark-%E5%AE%9E%E7%8E%B0-Word-Count"><span class="toc-number">5.</span> <span class="toc-text">Spark å®ç° Word Count</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spark-%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83"><span class="toc-number">6.</span> <span class="toc-text">Spark è¿è¡Œç¯å¢ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Local-%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.1.</span> <span class="toc-text">Local æ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Standalone-%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.2.</span> <span class="toc-text">Standalone æ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Yarn-%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.3.</span> <span class="toc-text">Yarn æ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#K8S-amp-Mesos-%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.4.</span> <span class="toc-text">K8S &amp; Mesos æ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows-%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.5.</span> <span class="toc-text">Windows æ¨¡å¼</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spark-%E8%BF%90%E8%A1%8C%E6%9E%B6%E6%9E%84"><span class="toc-number">7.</span> <span class="toc-text">Spark è¿è¡Œæ¶æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-number">7.1.</span> <span class="toc-text">æ ¸å¿ƒç»„ä»¶</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Driver"><span class="toc-number">7.1.1.</span> <span class="toc-text">Driver</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Executor"><span class="toc-number">7.1.2.</span> <span class="toc-text">Executor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Master-amp-Worker"><span class="toc-number">7.1.3.</span> <span class="toc-text">Master &amp; Worker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ApplicationMaster"><span class="toc-number">7.1.4.</span> <span class="toc-text">ApplicationMaster</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">7.2.</span> <span class="toc-text">æ ¸å¿ƒæ¦‚å¿µ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Executor-%E4%B8%8E-Core"><span class="toc-number">7.2.1.</span> <span class="toc-text">Executor ä¸ Core</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B9%B6%E8%A1%8C%E5%BA%A6%EF%BC%88Parallelism%EF%BC%89"><span class="toc-number">7.2.2.</span> <span class="toc-text">å¹¶è¡Œåº¦ï¼ˆParallelismï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89%E5%90%91%E6%97%A0%E7%8E%AF%E5%9B%BE%EF%BC%88DAG%EF%BC%89"><span class="toc-number">7.2.3.</span> <span class="toc-text">æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spark-%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B"><span class="toc-number">8.</span> <span class="toc-text">Spark æ ¸å¿ƒç¼–ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RDD"><span class="toc-number">8.1.</span> <span class="toc-text">RDD</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RDD-%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">8.1.1.</span> <span class="toc-text">RDD çš„ç‰¹ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RDD-%E4%B8%8E-IO-%E6%B5%81%E7%9A%84%E8%81%94%E7%B3%BB"><span class="toc-number">8.1.2.</span> <span class="toc-text">RDD ä¸ IO æµçš„è”ç³»</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IO"><span class="toc-number">8.1.2.1.</span> <span class="toc-text">IO</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#RDD-1"><span class="toc-number">8.1.2.2.</span> <span class="toc-text">RDD</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RDD-%E5%88%9B%E5%BB%BA"><span class="toc-number">8.1.3.</span> <span class="toc-text">RDD åˆ›å»º</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%8E%E5%86%85%E5%AD%98%E4%B8%AD%E5%88%9B%E5%BB%BA-RDD"><span class="toc-number">8.1.3.1.</span> <span class="toc-text">ä»å†…å­˜ä¸­åˆ›å»º RDD</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%8E%E5%A4%96%E5%AD%98%E4%B8%AD%E5%88%9B%E5%BB%BA-RDD"><span class="toc-number">8.1.3.2.</span> <span class="toc-text">ä»å¤–å­˜ä¸­åˆ›å»º RDD</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%8E%E5%85%B6%E4%BB%96-RDD-%E5%88%9B%E5%BB%BA"><span class="toc-number">8.1.3.3.</span> <span class="toc-text">ä»å…¶ä»– RDD åˆ›å»º</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E5%88%9B%E5%BB%BA-RDD%EF%BC%88new%EF%BC%89"><span class="toc-number">8.1.3.4.</span> <span class="toc-text">ç›´æ¥åˆ›å»º RDDï¼ˆnewï¼‰</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RDD-%E5%88%86%E5%8C%BA"><span class="toc-number">8.1.4.</span> <span class="toc-text">RDD åˆ†åŒº</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RDD-%E7%AE%97%E5%AD%90"><span class="toc-number">8.2.</span> <span class="toc-text">RDD ç®—å­</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RDD-%E8%BD%AC%E6%8D%A2%E7%AE%97%E5%AD%90"><span class="toc-number">8.2.1.</span> <span class="toc-text">RDD è½¬æ¢ç®—å­</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Value%E7%B1%BB%E5%9E%8B"><span class="toc-number">8.2.1.1.</span> <span class="toc-text">Valueç±»å‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%8C-Value-%E7%B1%BB%E5%9E%8B"><span class="toc-number">8.2.1.2.</span> <span class="toc-text">åŒ Value ç±»å‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Key-Value-%E7%B1%BB%E5%9E%8B"><span class="toc-number">8.2.1.3.</span> <span class="toc-text">Key - Value ç±»å‹</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RDD-%E8%A1%8C%E5%8A%A8%E7%AE%97%E5%AD%90"><span class="toc-number">8.2.2.</span> <span class="toc-text">RDD è¡ŒåŠ¨ç®—å­</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RDD-%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">8.3.</span> <span class="toc-text">RDD åºåˆ—åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Kryo-%E5%BA%8F%E5%88%97%E5%8C%96%E6%A1%86%E6%9E%B6"><span class="toc-number">8.3.1.</span> <span class="toc-text">Kryo åºåˆ—åŒ–æ¡†æ¶</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RDD-%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB"><span class="toc-number">8.4.</span> <span class="toc-text">RDD ä¾èµ–å…³ç³»</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB"><span class="toc-number">8.4.1.</span> <span class="toc-text">ä¾èµ–å…³ç³»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%80%E7%BC%98%E5%85%B3%E7%B3%BB"><span class="toc-number">8.4.2.</span> <span class="toc-text">è¡€ç¼˜å…³ç³»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AA%84%E4%BE%9D%E8%B5%96"><span class="toc-number">8.4.3.</span> <span class="toc-text">çª„ä¾èµ–</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%BD%E4%BE%9D%E8%B5%96"><span class="toc-number">8.4.4.</span> <span class="toc-text">å®½ä¾èµ–</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RDD-%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">8.5.</span> <span class="toc-text">RDD æŒä¹…åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RDD-Cache-%E7%BC%93%E5%AD%98"><span class="toc-number">8.5.1.</span> <span class="toc-text">RDD Cache ç¼“å­˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RDD-CheckPoint-%E6%A3%80%E6%9F%A5%E7%82%B9"><span class="toc-number">8.5.2.</span> <span class="toc-text">RDD CheckPoint æ£€æŸ¥ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E5%92%8C%E6%A3%80%E6%9F%A5%E7%82%B9%E5%8C%BA%E5%88%AB"><span class="toc-number">8.5.3.</span> <span class="toc-text">ç¼“å­˜å’Œæ£€æŸ¥ç‚¹åŒºåˆ«</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RDD-%E5%88%86%E5%8C%BA%E5%99%A8"><span class="toc-number">8.6.</span> <span class="toc-text">RDD åˆ†åŒºå™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Hash-%E5%88%86%E5%8C%BA"><span class="toc-number">8.6.1.</span> <span class="toc-text">Hash åˆ†åŒº</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Range-%E5%88%86%E5%8C%BA"><span class="toc-number">8.6.2.</span> <span class="toc-text">Range åˆ†åŒº</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RDD-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E4%B8%8E%E4%BF%9D%E5%AD%98"><span class="toc-number">8.7.</span> <span class="toc-text">RDD æ–‡ä»¶è¯»å–ä¸ä¿å­˜</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#text-%E6%96%87%E4%BB%B6"><span class="toc-number">8.7.1.</span> <span class="toc-text">text æ–‡ä»¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sequence-%E6%96%87%E4%BB%B6"><span class="toc-number">8.7.2.</span> <span class="toc-text">sequence æ–‡ä»¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#object-%E5%AF%B9%E8%B1%A1%E6%96%87%E4%BB%B6"><span class="toc-number">8.7.3.</span> <span class="toc-text">object å¯¹è±¡æ–‡ä»¶</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%AF%E5%8A%A0%E5%99%A8"><span class="toc-number">8.8.</span> <span class="toc-text">ç´¯åŠ å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%BF%E6%92%AD%E5%8F%98%E9%87%8F"><span class="toc-number">8.9.</span> <span class="toc-text">å¹¿æ’­å˜é‡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spark-SQL"><span class="toc-number">9.</span> <span class="toc-text">Spark SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Spark-SQL-%E4%B8%8E-Hive"><span class="toc-number">9.1.</span> <span class="toc-text">Spark SQL ä¸ Hive</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spark-SQL-%E7%89%B9%E7%82%B9"><span class="toc-number">9.2.</span> <span class="toc-text">Spark SQL ç‰¹ç‚¹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%93%E6%95%B4%E5%90%88"><span class="toc-number">9.2.1.</span> <span class="toc-text">æ˜“æ•´åˆ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F%E7%BB%9F%E4%B8%80"><span class="toc-number">9.2.2.</span> <span class="toc-text">æ•°æ®è®¿é—®æ–¹å¼ç»Ÿä¸€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%87%E5%87%86%E6%95%B0%E6%8D%AE%E8%BF%9E%E6%8E%A5"><span class="toc-number">9.2.3.</span> <span class="toc-text">æ ‡å‡†æ•°æ®è¿æ¥</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DataFrame"><span class="toc-number">9.3.</span> <span class="toc-text">DataFrame</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Spark-1-x"><span class="toc-number">9.3.1.</span> <span class="toc-text">Spark 1.x</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Spark-2-x"><span class="toc-number">9.3.2.</span> <span class="toc-text">Spark 2.x</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DataFrame-%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="toc-number">9.3.3.</span> <span class="toc-text">DataFrame æŸ¥è¯¢ä¼˜åŒ–</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DataSet"><span class="toc-number">9.4.</span> <span class="toc-text">DataSet</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DataSet-gt-DataFrame"><span class="toc-number">9.4.1.</span> <span class="toc-text">DataSet -&gt; DataFrame</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DataFrame-gt-DataSet"><span class="toc-number">9.4.2.</span> <span class="toc-text">DataFrame -&gt; DataSet</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spark-Session"><span class="toc-number">9.5.</span> <span class="toc-text">Spark Session</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0-UDF"><span class="toc-number">9.6.</span> <span class="toc-text">ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•° UDF</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spark-Streaming"><span class="toc-number">10.</span> <span class="toc-text">Spark Streaming</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84"><span class="toc-number">10.1.</span> <span class="toc-text">æ¶æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%8C%E5%8E%8B%E6%9C%BA%E5%88%B6"><span class="toc-number">10.2.</span> <span class="toc-text">èƒŒå‹æœºåˆ¶</span></a></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://example.com/2023/01/07/Spark/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="rayucan"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Spark</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="Created: 2023-01-07 17:07:48" itemprop="dateCreated datePublished" datetime="2023-01-07T17:07:48+08:00">2023-01-07</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="Modified: 2023-02-19 15:50:32" itemprop="dateModified" datetime="2023-02-19T15:50:32+08:00">2023-02-19</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E7%AC%94%E8%AE%B0/" style="--text-color:dimgray" itemprop="url" rel="index"><span itemprop="text">ç¬”è®°</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/BigData/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">BigData</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302181721476.png" alt="image-20230218172120285" loading="lazy"></p>
<span id="more"></span>

<h2 id="Spark-ä¸-Hadoop"><a href="#Spark-ä¸-Hadoop" class="headerlink" title="Spark ä¸ Hadoop"></a>Spark ä¸ Hadoop</h2><blockquote>
<p>Spark ä¸ Hadoop æœ€ä¸»è¦çš„å·®åˆ«åœ¨äºå¤šä¸ªä½œä¸šé—´çš„æ•°æ®é€šä¿¡</p>
<p>Spark å¤šä¸ªä½œä¸šé—´çš„æ•°æ®é€šä¿¡åŸºäºå†…å­˜ï¼Œè€Œ Hadoop åŸºäºç£ç›˜</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301262248986.png" alt="image-20230126224831357" loading="lazy"></p>
<p>Hadoop: </p>
<p>ä¸€æ¬¡æ€§æ•°æ®è®¡ç®—</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301072233317.png" alt="image-20230107223303269" loading="lazy"></p>
<p>Hadoop åœ¨å¤„ç†æ•°æ®æ—¶ï¼Œå…ˆä»ç£ç›˜ä¸­è¯»å–æ•°æ®ï¼Œç„¶åè¿›è¡Œé€»è¾‘æ“ä½œï¼Œå†å°†å¤„ç†ç»“æœé‡æ–°å­˜å‚¨åˆ°ç£ç›˜ä¸­</p>
<p>é€šè¿‡ç£ç›˜ IO æ¥è¿›è¡Œä½œä¸šï¼Œä¼šæ¶ˆè€—å¤§é‡èµ„æºï¼Œå½±å“æ€§èƒ½</p>
<p>Spark:</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301072236644.png" alt="image-20230107223618591" loading="lazy"></p>
<p>Spark ä¼˜åŒ–äº†è®¡ç®—è¿‡ç¨‹ï¼ŒæŠŠä½œä¸šçš„è®¡ç®—ç»“æœæ”¾å…¥å†…å­˜ä¸­ï¼Œè¿™ç§æ–¹å¼çš„å­˜å–æ•ˆç‡è¾ƒé«˜</p>
<blockquote>
<p>æ€»ç»“ï¼š</p>
<p>åœ¨ç»å¤§å¤šæ•°åœºæ™¯ä¸­ï¼ŒSpark çš„ç¡®æ¯” MapReduce æ›´æœ‰ä¼˜åŠ¿</p>
<p>ä½†æ­£æ˜¯ Spark åŸºäºå†…å­˜æ“ä½œï¼Œåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¯èƒ½ä¼šç”±äºå†…å­˜çš„é™åˆ¶å¯¼è‡´ Job æ‰§è¡Œå¤±è´¥ï¼Œæ­¤æ—¶ MapReduce æ˜¯æ›´å¥½çš„é€‰æ‹©</p>
<p>å³ Spark å¹¶ä¸èƒ½å®Œå…¨æ›¿ä»£ MapReduce</p>
</blockquote>
<h2 id="Spark-æ ¸å¿ƒæ¨¡å—"><a href="#Spark-æ ¸å¿ƒæ¨¡å—" class="headerlink" title="Spark æ ¸å¿ƒæ¨¡å—"></a>Spark æ ¸å¿ƒæ¨¡å—</h2><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301072241630.png" alt="image-20230107224158550" loading="lazy"></p>
<ul>
<li><p>Spark Coreï¼š</p>
<p>æä¾›æœ€åŸºç¡€ã€æœ€æ ¸å¿ƒçš„åŠŸèƒ½</p>
</li>
<li><p>Spark SQLï¼š</p>
<p>ç”¨äºæ“ä½œç»“æ„åŒ–æ•°æ®çš„ç»„ä»¶ï¼Œé€šè¿‡ Spark SQLï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ SQL è¯­è¨€æ¥æŸ¥è¯¢æ•°æ®</p>
</li>
<li><p>Spark Streamingï¼š</p>
<p>ç”¨äºæµå¼è®¡ç®—çš„ç»„ä»¶</p>
</li>
<li><p>Spark MLlibï¼š</p>
<p>ç”¨äºæœºå™¨å­¦ä¹ çš„ç®—æ³•åº“</p>
</li>
<li><p>Spark GraphXï¼š</p>
<p>ç”¨äºå›¾è®¡ç®—çš„æ¡†æ¶å’Œç®—æ³•åº“</p>
</li>
</ul>
<h2 id="Word-Count"><a href="#Word-Count" class="headerlink" title="Word Count"></a>Word Count</h2><pre class="language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">object</span> WordCount <span class="token punctuation">&#123;</span>
    <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// å»ºç«‹ä¸ Spark çš„è¿æ¥</span>
        <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">"local"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">"WordCount"</span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> sparkContext <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>

        <span class="token comment">// æ‰§è¡Œä¸šåŠ¡æ“ä½œ</span>
        <span class="token comment">// 1 è¯»å–æ–‡ä»¶</span>
        <span class="token keyword">val</span> lines <span class="token operator">=</span> sparkContext<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">)</span>
        <span class="token comment">// 2 æ‹†åˆ† "hello world" -> "hello" "world"</span>
        <span class="token keyword">val</span> words <span class="token operator">=</span> lines<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>_<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">// 3 å¯¹å•è¯åˆ†ç»„ (hello, hello) (world, world)</span>
        <span class="token keyword">val</span> group <span class="token operator">=</span> words<span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span>word <span class="token keyword">=></span> word<span class="token punctuation">)</span>
        <span class="token comment">// 4 è½¬æ¢åˆ†ç»„æ•°æ® (hello, hello) (world, world) -> (hello, 2) (world, 2)</span>
        <span class="token keyword">val</span> count <span class="token operator">=</span> group<span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span>
            <span class="token keyword">case</span> <span class="token punctuation">(</span>word<span class="token punctuation">,</span> list<span class="token punctuation">)</span> <span class="token keyword">=></span> <span class="token punctuation">&#123;</span>
                <span class="token punctuation">(</span>word<span class="token punctuation">,</span> list<span class="token punctuation">.</span>size<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// 5 æ‰“å°ç»“æœ</span>
        <span class="token keyword">val</span> array <span class="token operator">=</span> count<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
        array<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">)</span>
        
        <span class="token comment">// å…³é—­è¿æ¥</span>
        sparkContext<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<pre class="language-none"><code class="language-none">(hello,4)
(world,2)
(spark,2)</code></pre>



<h3 id="åŠŸèƒ½å®ç°æµç¨‹å›¾"><a href="#åŠŸèƒ½å®ç°æµç¨‹å›¾" class="headerlink" title="åŠŸèƒ½å®ç°æµç¨‹å›¾"></a>åŠŸèƒ½å®ç°æµç¨‹å›¾</h3><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301151551701.png" alt="image-20230115155109532" loading="lazy"></p>
<h2 id="Word-Count-ä¼˜åŒ–"><a href="#Word-Count-ä¼˜åŒ–" class="headerlink" title="Word Count ä¼˜åŒ–"></a>Word Count ä¼˜åŒ–</h2><pre class="language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">object</span> WordCount <span class="token punctuation">&#123;</span>
    <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">"local"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">"WordCount"</span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> sparkContext <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>


        <span class="token keyword">val</span> lines <span class="token operator">=</span> sparkContext<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">)</span>
        

        <span class="token keyword">val</span> words <span class="token operator">=</span> lines<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>_<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
        <span class="token keyword">val</span> wordToOne <span class="token operator">=</span> words<span class="token punctuation">.</span>map<span class="token punctuation">(</span>
            word <span class="token keyword">=></span> <span class="token punctuation">(</span>word<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment">// æ¶‰åŠ Scala çš„å…ƒç»„å¼•ç”¨ï¼Œ_1 å¼•ç”¨ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œ_2 å¼•ç”¨ç¬¬äºŒä¸ªå…ƒç´ </span>
        <span class="token keyword">val</span> wordGroup <span class="token operator">=</span> wordToOne<span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span>
            t <span class="token keyword">=></span> t<span class="token punctuation">.</span>_1
        <span class="token punctuation">)</span>
        
        <span class="token keyword">val</span> wordToCount <span class="token operator">=</span> wordGroup<span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span>
            <span class="token keyword">case</span> <span class="token punctuation">(</span>word<span class="token punctuation">,</span> list<span class="token punctuation">)</span> <span class="token keyword">=></span> <span class="token punctuation">&#123;</span>
                list<span class="token punctuation">.</span>reduce<span class="token punctuation">(</span>
                    <span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">)</span> <span class="token keyword">=></span> <span class="token punctuation">&#123;</span>
                        <span class="token punctuation">(</span>t1<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>_2 <span class="token operator">+</span> t2<span class="token punctuation">.</span>_2<span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token keyword">val</span> array <span class="token operator">=</span> wordToCount<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
        array<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">)</span>
        
        sparkContext<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<pre class="language-none"><code class="language-none">(hello,4)
(world,2)
(spark,2)</code></pre>



<h3 id="æ”¹è¿›"><a href="#æ”¹è¿›" class="headerlink" title="æ”¹è¿›"></a>æ”¹è¿›</h3><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301251709807.png" alt="image-20230125170914280" loading="lazy"></p>
<h2 id="Spark-å®ç°-Word-Count"><a href="#Spark-å®ç°-Word-Count" class="headerlink" title="Spark å®ç° Word Count"></a>Spark å®ç° Word Count</h2><pre class="language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">object</span> WordCount <span class="token punctuation">&#123;</span>
    <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">"local"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">"WordCount"</span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> sparkContext <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>


        <span class="token keyword">val</span> lines <span class="token operator">=</span> sparkContext<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">)</span>
        

        <span class="token keyword">val</span> words <span class="token operator">=</span> lines<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>_<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
        <span class="token keyword">val</span> wordToOne <span class="token operator">=</span> words<span class="token punctuation">.</span>map<span class="token punctuation">(</span>

            word <span class="token keyword">=></span> <span class="token punctuation">(</span>word<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment">// Spark æä¾›äº†æ›´å¤šåŠŸèƒ½ï¼Œå¯ä»¥å°†åˆ†ç»„å’Œèšåˆç”¨ä¸€ä¸ªæ–¹æ³•å®ç°</span>
        <span class="token comment">// reduceByKey å°±æ˜¯å°†ç›¸åŒçš„ keyï¼Œå¯¹ value è¿›è¡Œèšåˆ</span>
        <span class="token keyword">val</span> wordToCount <span class="token operator">=</span> wordToOne<span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span>_ <span class="token operator">+</span> _<span class="token punctuation">)</span>
        
        <span class="token keyword">val</span> array <span class="token operator">=</span> wordToCount<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
        array<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">)</span>
        
        sparkContext<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<pre class="language-none"><code class="language-none">(hello,4)
(world,2)
(spark,2)</code></pre>

<pre class="language-none"><code class="language-none">_ + _ æ˜¯ç”±ä»¥ä¸‹ä¸¤æ­¥ç®€åŒ–è€Œæ¥ï¼ˆè‡³ç®€åŸåˆ™ï¼‰
wordToOne.reduceByKey((x, y) &#x3D;&gt; &#123;x + y&#125;)
wordToOne.reduceByKey((x, y) &#x3D;&gt; x + y)</code></pre>

<h2 id="Spark-è¿è¡Œç¯å¢ƒ"><a href="#Spark-è¿è¡Œç¯å¢ƒ" class="headerlink" title="Spark è¿è¡Œç¯å¢ƒ"></a>Spark è¿è¡Œç¯å¢ƒ</h2><h3 id="Local-æ¨¡å¼"><a href="#Local-æ¨¡å¼" class="headerlink" title="Local æ¨¡å¼"></a>Local æ¨¡å¼</h3><p>åœ¨ IDEA ä¸­è¿è¡Œä»£ç çš„ç¯å¢ƒç§°ä¹‹ä¸ºå¼€å‘ç¯å¢ƒï¼Œè€Œ Local æ¨¡å¼ä¸ä¹‹ä¸åŒ</p>
<p>æ‰€è°“çš„ Local æ¨¡å¼ï¼Œå°±æ˜¯ä¸éœ€è¦å…¶ä»–ä»»ä½•èŠ‚ç‚¹èµ„æºï¼Œå°±å¯ä»¥åœ¨æœ¬åœ°æ‰§è¡Œ Spark ä»£ç çš„ç¯å¢ƒï¼Œä¸€èˆ¬ç”¨äºæ•™å­¦ï¼Œè°ƒè¯•ï¼Œæ¼”ç¤ºç­‰</p>
<h3 id="Standalone-æ¨¡å¼"><a href="#Standalone-æ¨¡å¼" class="headerlink" title="Standalone æ¨¡å¼"></a>Standalone æ¨¡å¼</h3><p>Local æœ¬åœ°æ¨¡å¼åªæ˜¯ç”¨æ¥è¿›è¡Œç»ƒä¹ æ¼”ç¤ºçš„ï¼ŒçœŸå®å·¥ä½œä¸­è¿˜æ˜¯è¦å°†åº”ç”¨æäº¤åˆ°å¯¹åº”çš„é›†ç¾¤ä¸­å»æ‰§è¡Œ</p>
<p>åªä½¿ç”¨ Spark è‡ªèº«èŠ‚ç‚¹è¿è¡Œçš„é›†ç¾¤æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“ç‹¬ç«‹éƒ¨ç½²ï¼ˆStandaloneï¼‰æ¨¡å¼</p>
<p>Spark çš„ <code>Standalone</code> æ¨¡å¼ä½“ç°äº†ç»å…¸çš„ <code>master-slave</code> æ¨¡å¼</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301251731274.png" alt="image-20230125173147108" loading="lazy"></p>
<h3 id="Yarn-æ¨¡å¼"><a href="#Yarn-æ¨¡å¼" class="headerlink" title="Yarn æ¨¡å¼"></a>Yarn æ¨¡å¼</h3><p>ç‹¬ç«‹éƒ¨ç½²ï¼ˆStandaloneï¼‰æ¨¡å¼ç”± Spark è‡ªèº«æä¾›è®¡ç®—èµ„æºï¼Œæ— éœ€å…¶ä»–æ¡†æ¶æä¾›èµ„æºã€‚</p>
<p>è¿™ç§æ–¹å¼é™ä½äº†å’Œå…¶ä»–ç¬¬ä¸‰æ–¹èµ„æºæ¡†æ¶çš„è€¦åˆæ€§ï¼Œç‹¬ç«‹æ€§éå¸¸å¼º</p>
<p>ä½†æ˜¯ Spark ä¸»è¦æ˜¯è®¡ç®—æ¡†æ¶ï¼Œè€Œä¸æ˜¯èµ„æºè°ƒåº¦æ¡†æ¶ï¼Œæ‰€ä»¥æœ¬èº«æä¾›çš„èµ„æºè°ƒåº¦å¹¶ä¸æ˜¯å®ƒçš„å¼ºé¡¹ï¼Œæ‰€ä»¥è¿˜æ˜¯å’Œå…¶ä»–ä¸“ä¸šçš„èµ„æºè°ƒåº¦æ¡†æ¶é›†æˆä¼šæ›´é è°±ä¸€äº›</p>
<h3 id="K8S-amp-Mesos-æ¨¡å¼"><a href="#K8S-amp-Mesos-æ¨¡å¼" class="headerlink" title="K8S &amp; Mesos æ¨¡å¼"></a>K8S &amp; Mesos æ¨¡å¼</h3><p>Mesos æ˜¯ Apache ä¸‹çš„å¼€æºåˆ†å¸ƒå¼èµ„æºç®¡ç†æ¡†æ¶ï¼Œå®ƒè¢«ç§°ä¸ºæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„å†…æ ¸ï¼Œåœ¨ Twitter å¾—åˆ°å¹¿æ³›ä½¿ç”¨ï¼Œç®¡ç†ç€ Twitter è¶…è¿‡ 30,0000 å°æœåŠ¡å™¨ä¸Šçš„åº”ç”¨éƒ¨ç½²ï¼Œä½†æ˜¯åœ¨å›½å†…ä¾ç„¶ä½¿ç”¨ç€ä¼ ç»Ÿçš„ Hadoop å¤§æ•°æ®æ¡†æ¶ï¼Œä½¿ç”¨ Mesos æ¡†æ¶çš„å¹¶ä¸å¤š</p>
<h3 id="Windows-æ¨¡å¼"><a href="#Windows-æ¨¡å¼" class="headerlink" title="Windows æ¨¡å¼"></a>Windows æ¨¡å¼</h3><p>åœ¨è‡ªå·±å­¦ä¹ æ—¶ï¼Œæ¯æ¬¡éƒ½éœ€è¦å¯åŠ¨è™šæ‹Ÿæœºï¼Œå¯åŠ¨é›†ç¾¤ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒç¹ççš„è¿‡ç¨‹ï¼Œ å¹¶ä¸”ä¼šå å¤§é‡çš„ç³»ç»Ÿèµ„æºï¼Œå¯¼è‡´ç³»ç»Ÿæ‰§è¡Œå˜æ…¢ï¼Œä¸ä»…ä»…å½±å“å­¦ä¹ æ•ˆæœï¼Œä¹Ÿå½±å“å­¦ä¹ è¿›åº¦ï¼Œ Spark æä¾›äº†å¯ä»¥åœ¨ Windows ç³»ç»Ÿä¸‹å¯åŠ¨æœ¬åœ°é›†ç¾¤çš„æ–¹å¼</p>
<h2 id="Spark-è¿è¡Œæ¶æ„"><a href="#Spark-è¿è¡Œæ¶æ„" class="headerlink" title="Spark è¿è¡Œæ¶æ„"></a>Spark è¿è¡Œæ¶æ„</h2><p>Spark æ¡†æ¶çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªè®¡ç®—å¼•æ“ï¼Œé‡‡ç”¨äº†æ ‡å‡†çš„ <code>master-slave</code> ç»“æ„</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301261549630.png" alt="image-20230126154922451" loading="lazy"></p>
<p>å›¾ä¸­å±•ç¤ºäº† Spark æ‰§è¡Œæ—¶çš„åŸºæœ¬ç»“æ„</p>
<p>Driver è¡¨ç¤º masterï¼Œ è´Ÿè´£ç®¡ç†æ•´ä¸ªé›†ç¾¤ä¸­çš„ä½œä¸šä»»åŠ¡è°ƒåº¦</p>
<p>Executor è¡¨ç¤º slaveï¼Œè´Ÿè´£å®é™…æ‰§è¡Œä»»åŠ¡</p>
<h3 id="æ ¸å¿ƒç»„ä»¶"><a href="#æ ¸å¿ƒç»„ä»¶" class="headerlink" title="æ ¸å¿ƒç»„ä»¶"></a>æ ¸å¿ƒç»„ä»¶</h3><h4 id="Driver"><a href="#Driver" class="headerlink" title="Driver"></a>Driver</h4><p>Spark é©±åŠ¨å™¨èŠ‚ç‚¹ï¼Œç”¨äºæ‰§è¡Œ Spark ä»»åŠ¡ä¸­çš„ main æ–¹æ³•ï¼Œè´Ÿè´£å®é™…ä»£ç çš„æ‰§è¡Œå·¥ä½œ</p>
<p>Driver åœ¨ Spark ä½œä¸šæ‰§è¡Œæ—¶ä¸»è¦è´Ÿè´£ï¼š </p>
<ul>
<li>å°†ç”¨æˆ·ç¨‹åºè½¬åŒ–ä¸ºä½œä¸šï¼ˆjobï¼‰</li>
<li>åœ¨ Executor ä¹‹é—´è°ƒåº¦ä»»åŠ¡(task)  </li>
<li>è·Ÿè¸ª Executor çš„æ‰§è¡Œæƒ…å†µ </li>
<li>é€šè¿‡ UI å±•ç¤ºæŸ¥è¯¢è¿è¡Œæƒ…å†µ </li>
</ul>
<p>å®é™…ä¸Šï¼Œæˆ‘ä»¬æ— æ³•å‡†ç¡®åœ°æè¿° Driver çš„å®šä¹‰ï¼Œå› ä¸ºåœ¨æ•´ä¸ªçš„ç¼–ç¨‹è¿‡ç¨‹ä¸­æ²¡æœ‰çœ‹åˆ°ä»»ä½•æœ‰å…³ Driver çš„å­—çœ¼</p>
<p>æ‰€ä»¥ç®€å•ç†è§£ï¼Œæ‰€è°“çš„ Driver å°±æ˜¯é©±ä½¿æ•´ä¸ªåº”ç”¨è¿è¡Œèµ·æ¥çš„ç¨‹åºï¼Œä¹Ÿç§°ä¹‹ä¸º Driver ç±»</p>
<h4 id="Executor"><a href="#Executor" class="headerlink" title="Executor"></a>Executor</h4><p>Spark Executor æ˜¯é›†ç¾¤ä¸­å·¥ä½œèŠ‚ç‚¹ï¼ˆWorkerï¼‰ä¸­ä¸€ä¸ª JVM è¿›ç¨‹ï¼Œè´Ÿè´£åœ¨ Spark ä½œä¸šä¸­è¿è¡Œå…·ä½“ä»»åŠ¡ï¼ˆTaskï¼‰ï¼Œä»»åŠ¡å½¼æ­¤ä¹‹é—´ç›¸äº’ç‹¬ç«‹</p>
<p>Spark åº”ç”¨å¯åŠ¨æ—¶ï¼ŒExecutor èŠ‚ç‚¹è¢«åŒæ—¶å¯åŠ¨ï¼Œå¹¶ä¸”å§‹ç»ˆä¼´éšç€æ•´ä¸ª Spark åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸè€Œå­˜åœ¨</p>
<p>å¦‚æœæœ‰ Executor èŠ‚ç‚¹å‘ç”Ÿäº† æ•…éšœæˆ–å´©æºƒï¼ŒSpark åº”ç”¨ä¹Ÿå¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä¼šå°†å‡ºé”™èŠ‚ç‚¹ä¸Šçš„ä»»åŠ¡è°ƒåº¦åˆ°å…¶ä»– Executor èŠ‚ç‚¹ ä¸Šç»§ç»­è¿è¡Œ</p>
<p>Executor æœ‰ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š</p>
<ul>
<li><p>è´Ÿè´£è¿è¡Œç»„æˆ Spark åº”ç”¨çš„ä»»åŠ¡ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™é©±åŠ¨å™¨è¿›ç¨‹</p>
</li>
<li><p>å®ƒä»¬é€šè¿‡è‡ªèº«çš„å—ç®¡ç†å™¨ï¼ˆBlock Managerï¼‰ä¸ºç”¨æˆ·ç¨‹åºä¸­è¦æ±‚ç¼“å­˜çš„ RDD æä¾›å†…å­˜å¼å­˜å‚¨</p>
<p>RDD æ˜¯ç›´æ¥ç¼“å­˜åœ¨ Executor è¿›ç¨‹å†…çš„ï¼Œå› æ­¤ä»»åŠ¡å¯ä»¥åœ¨è¿è¡Œæ—¶å……åˆ†åˆ©ç”¨ç¼“å­˜æ•°æ®åŠ é€Ÿè¿ç®—</p>
</li>
</ul>
<h4 id="Master-amp-Worker"><a href="#Master-amp-Worker" class="headerlink" title="Master &amp; Worker"></a>Master &amp; Worker</h4><p>Spark é›†ç¾¤çš„ç‹¬ç«‹éƒ¨ç½²ç¯å¢ƒä¸­ï¼Œä¸éœ€è¦ä¾èµ–å…¶ä»–çš„èµ„æºè°ƒåº¦æ¡†æ¶ï¼Œè‡ªèº«å°±å®ç°äº†èµ„æºè°ƒåº¦çš„åŠŸèƒ½</p>
<p>æ‰€ä»¥ç¯å¢ƒä¸­è¿˜æœ‰ä¸¤ä¸ªæ ¸å¿ƒç»„ä»¶ï¼šMaster å’Œ Worker</p>
<p>Master æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸»è¦è´Ÿè´£èµ„æºçš„è°ƒåº¦å’Œåˆ†é…ï¼Œè¿›è¡Œé›†ç¾¤çš„ç›‘æ§</p>
<p>Worker ä¹Ÿæ˜¯è¿›ç¨‹ï¼Œä¸€ä¸ª Worker è¿è¡Œåœ¨é›†ç¾¤ä¸­çš„ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œç”± Master åˆ†é…èµ„æºå¯¹æ•°æ®è¿›è¡Œå¹¶è¡Œçš„å¤„ç†å’Œè®¡ç®—</p>
<h4 id="ApplicationMaster"><a href="#ApplicationMaster" class="headerlink" title="ApplicationMaster"></a>ApplicationMaster</h4><p>Hadoop ç”¨æˆ·å‘ YARN é›†ç¾¤æäº¤åº”ç”¨ç¨‹åºæ—¶,æäº¤ç¨‹åºä¸­åº”è¯¥åŒ…å« <code>ApplicationMaster</code>ï¼Œç”¨äºå‘èµ„æºè°ƒåº¦å™¨ç”³è¯·æ‰§è¡Œä»»åŠ¡çš„èµ„æºå®¹å™¨ Containerï¼Œè¿è¡Œç”¨æˆ·è‡ªå·±çš„ç¨‹åºä»»åŠ¡ jobï¼Œç›‘æ§æ•´ä¸ªä»»åŠ¡çš„æ‰§è¡Œï¼Œè·Ÿè¸ªæ•´ä¸ªä»»åŠ¡çš„çŠ¶æ€ï¼Œå¤„ç†ä»»åŠ¡å¤±è´¥ç­‰å¼‚å¸¸æƒ…å†µ</p>
<p>å³ï¼ŒResourceManagerï¼ˆèµ„æºï¼‰å’Œ Driverï¼ˆè®¡ç®—ï¼‰ä¹‹é—´çš„<strong>è§£è€¦åˆ</strong>é çš„å°±æ˜¯ <code>ApplicationMaster</code></p>
<h3 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h3><h4 id="Executor-ä¸-Core"><a href="#Executor-ä¸-Core" class="headerlink" title="Executor ä¸ Core"></a>Executor ä¸ Core</h4><p>Spark Executor æ˜¯é›†ç¾¤ä¸­è¿è¡Œåœ¨å·¥ä½œèŠ‚ç‚¹ï¼ˆWorkerï¼‰ä¸­çš„ä¸€ä¸ª JVM è¿›ç¨‹ï¼Œæ˜¯æ•´ä¸ªé›†ç¾¤ä¸­çš„ä¸“é—¨ç”¨äºè®¡ç®—çš„èŠ‚ç‚¹</p>
<p>åœ¨æäº¤åº”ç”¨ä¸­ï¼Œå¯ä»¥æä¾›å‚æ•°æŒ‡å®šè®¡ç®—èŠ‚ç‚¹çš„ä¸ªæ•°ï¼Œä»¥åŠå¯¹åº”çš„èµ„æº</p>
<p>è¿™é‡Œçš„èµ„æºä¸€èˆ¬æŒ‡çš„æ˜¯å·¥ä½œèŠ‚ç‚¹ Executor çš„å†…å­˜å¤§å°å’Œä½¿ç”¨çš„è™šæ‹Ÿ CPU æ ¸ï¼ˆCoreï¼‰æ•°é‡</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301261557083.png" alt="image-20230126155734010" loading="lazy"></p>
<h4 id="å¹¶è¡Œåº¦ï¼ˆParallelismï¼‰"><a href="#å¹¶è¡Œåº¦ï¼ˆParallelismï¼‰" class="headerlink" title="å¹¶è¡Œåº¦ï¼ˆParallelismï¼‰"></a>å¹¶è¡Œåº¦ï¼ˆParallelismï¼‰</h4><p>åœ¨åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶ä¸­ä¸€èˆ¬éƒ½æ˜¯å¤šä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œï¼Œç”±äºä»»åŠ¡åˆ†å¸ƒåœ¨ä¸åŒçš„è®¡ç®—èŠ‚ç‚¹è¿›è¡Œè®¡ç®—ï¼Œæ‰€ä»¥èƒ½å¤ŸçœŸæ­£åœ°å®ç°å¤šä»»åŠ¡å¹¶è¡Œæ‰§è¡Œ</p>
<p>æ³¨æ„ï¼Œè¿™é‡Œæ˜¯å¹¶è¡Œï¼Œè€Œä¸æ˜¯å¹¶å‘</p>
<p>è¿™é‡Œæˆ‘ä»¬å°†æ•´ä¸ªé›†ç¾¤å¹¶è¡Œæ‰§è¡Œä»»åŠ¡çš„æ•°é‡ç§°ä¹‹ä¸ºå¹¶è¡Œåº¦</p>
<p>ä¸€ä¸ªä½œä¸šçš„å¹¶è¡Œåº¦å–å†³äºæ¡†æ¶çš„é»˜è®¤é…ç½®ï¼Œåº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥åœ¨è¿è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€ä¿®æ”¹</p>
<h4 id="æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰"><a href="#æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰" class="headerlink" title="æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰"></a>æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰</h4><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301261558191.png" alt="image-20230126155858119" loading="lazy"></p>
<p><code>DAGï¼ˆDirected Acyclic Graphï¼‰æœ‰å‘æ— ç¯å›¾</code> æ˜¯ç”±ç‚¹å’Œçº¿ç»„æˆçš„æ‹“æ‰‘å›¾å½¢ï¼Œè¯¥å›¾å½¢å…·æœ‰æ–¹å‘ï¼Œä¸ä¼šé—­ç¯</p>
<p>è¿™é‡Œæ‰€è°“çš„æœ‰å‘æ— ç¯å›¾ï¼Œå¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰çš„å›¾å½¢ï¼Œè€Œæ˜¯ç”± Spark ç¨‹åºç›´æ¥æ˜ å°„æˆçš„æ•°æ®æµçš„é«˜çº§æŠ½è±¡æ¨¡å‹</p>
<p>ç®€å•ç†è§£å°±æ˜¯å°†æ•´ä¸ªç¨‹åºè®¡ç®—çš„æ‰§è¡Œè¿‡ç¨‹ç”¨å›¾å½¢è¡¨ç¤ºå‡ºæ¥ï¼Œè¿™æ ·æ›´ç›´è§‚ä¸”æ›´ä¾¿äºç†è§£ï¼Œå¯ä»¥ç”¨äºè¡¨ç¤ºç¨‹åºçš„æ‹“æ‰‘ç»“æ„</p>
<blockquote>
<p>å¤§æ•°æ®è®¡ç®—å¼•æ“æ¡†æ¶æˆ‘ä»¬æ ¹æ®ä½¿ç”¨æ–¹å¼çš„ä¸åŒä¸€èˆ¬ä¼šåˆ†ä¸ºå››ç±»ï¼Œå…¶ä¸­ç¬¬ä¸€ç±»å°±æ˜¯ Hadoop æ‰€æ‰¿è½½çš„ MapReduceï¼Œå®ƒå°†è®¡ç®—åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼ŒMap é˜¶æ®µ å’Œ Reduce é˜¶æ®µ </p>
<p>å¯¹äºä¸Šå±‚åº”ç”¨æ¥è¯´ï¼Œå°±ä¸å¾—ä¸æƒ³æ–¹è®¾æ³•å»æ‹†åˆ†ç®—æ³•ï¼Œç”šè‡³äºä¸å¾—ä¸åœ¨ä¸Šå±‚åº”ç”¨å®ç°å¤šä¸ª Job çš„ä¸²è”ï¼Œä»¥å®Œæˆä¸€ä¸ªå®Œæ•´çš„ç®—æ³•ï¼Œä¾‹å¦‚è¿­ä»£è®¡ç®—ï¼Œç”±äºè¿™æ ·çš„å¼Šç«¯ï¼Œå‚¬ç”Ÿäº†æ”¯æŒ DAG æ¡†æ¶çš„äº§ç”Ÿ</p>
</blockquote>
<h2 id="Spark-æ ¸å¿ƒç¼–ç¨‹"><a href="#Spark-æ ¸å¿ƒç¼–ç¨‹" class="headerlink" title="Spark æ ¸å¿ƒç¼–ç¨‹"></a>Spark æ ¸å¿ƒç¼–ç¨‹</h2><blockquote>
<p>Spark è®¡ç®—æ¡†æ¶ä¸ºäº†èƒ½å¤Ÿè¿›è¡Œé«˜å¹¶å‘å’Œé«˜ååçš„æ•°æ®å¤„ç†ï¼Œå°è£…äº†ä¸‰å¤§æ•°æ®ç»“æ„ï¼Œç”¨äºå¤„ç†ä¸åŒçš„åº”ç”¨åœºæ™¯ã€‚</p>
<p>ä¸‰å¤§æ•°æ®ç»“æ„åˆ†åˆ«æ˜¯ï¼š </p>
<ul>
<li>RDDï¼šå¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›† </li>
<li>ç´¯åŠ å™¨ï¼šåˆ†å¸ƒå¼å…±äº«åªå†™å˜é‡ </li>
<li>å¹¿æ’­å˜é‡ï¼šåˆ†å¸ƒå¼å…±äº«åªè¯»å˜é‡</li>
</ul>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301261622672.png" alt="image-20230126162247383" loading="lazy"></p>
<p>ä¸Šå›¾æ¨¡æ‹Ÿäº† Spark ä¸­åˆ†å¸ƒå¼è®¡ç®—çš„è¿‡ç¨‹ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è®¡ç®—ä»»åŠ¡</p>
<p>ä»»åŠ¡æ‹†åˆ†ï¼š(1, 2, 3, 4) =&gt; (1, 2)  (3, 4)</p>
<p>è®¡ç®—é€»è¾‘ï¼šn * 2</p>
<h3 id="RDD"><a href="#RDD" class="headerlink" title="RDD"></a>RDD</h3><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301261628117.png" alt="image-20230126162838979" loading="lazy"></p>
<p><code>RDDï¼ˆResilient Distributed Dataseï¼‰</code>å«åšå¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œæ˜¯ Spark ä¸­æœ€åŸºæœ¬çš„æ•°æ®å¤„ç†æ¨¡å‹ï¼Œæºç ä¸­æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»</p>
<h4 id="RDD-çš„ç‰¹ç‚¹"><a href="#RDD-çš„ç‰¹ç‚¹" class="headerlink" title="RDD çš„ç‰¹ç‚¹"></a>RDD çš„ç‰¹ç‚¹</h4><ul>
<li><p>å¼¹æ€§</p>
<ul>
<li>å­˜å‚¨çš„å¼¹æ€§ï¼šå†…å­˜ä¸ç£ç›˜çš„è‡ªåŠ¨åˆ‡æ¢</li>
<li>å®¹é”™çš„å¼¹æ€§ï¼šæ•°æ®ä¸¢å¤±å¯ä»¥è‡ªåŠ¨æ¢å¤ </li>
<li>è®¡ç®—çš„å¼¹æ€§ï¼šè®¡ç®—å‡ºé”™é‡è¯•æœºåˆ¶</li>
<li>åˆ†ç‰‡çš„å¼¹æ€§ï¼šå¯æ ¹æ®éœ€è¦é‡æ–°åˆ†ç‰‡</li>
</ul>
</li>
<li><p>åˆ†å¸ƒå¼ï¼šæ•°æ®å­˜å‚¨åœ¨å¤§æ•°æ®é›†ç¾¤ä¸åŒèŠ‚ç‚¹ä¸Š </p>
</li>
<li><p>æ•°æ®é›†ï¼šRDD å°è£…äº†è®¡ç®—é€»è¾‘ï¼Œå¹¶ä¸ä¿å­˜æ•°æ®</p>
</li>
<li><p>æ•°æ®æŠ½è±¡ï¼šRDD æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œéœ€è¦å­ç±»å…·ä½“å®ç° </p>
</li>
</ul>
<ul>
<li>ä¸å¯å˜ï¼šRDD å°è£…äº†è®¡ç®—é€»è¾‘ï¼Œæ˜¯ä¸å¯ä»¥æ”¹å˜çš„ï¼Œæƒ³è¦æ”¹å˜åªèƒ½äº§ç”Ÿæ–°çš„ RDDï¼Œåœ¨æ–°çš„ RDD é‡Œé¢å°è£…è®¡ç®—é€»è¾‘ </li>
</ul>
<ul>
<li>å¯åˆ†åŒºã€å¹¶è¡Œè®¡ç®—</li>
</ul>
<h4 id="RDD-ä¸-IO-æµçš„è”ç³»"><a href="#RDD-ä¸-IO-æµçš„è”ç³»" class="headerlink" title="RDD ä¸ IO æµçš„è”ç³»"></a>RDD ä¸ IO æµçš„è”ç³»</h4><h5 id="IO"><a href="#IO" class="headerlink" title="IO"></a>IO</h5><blockquote>
<p>IO æ“ä½œä½“ç°äº†è£…é¥°è€…è®¾è®¡æ¨¡å¼</p>
</blockquote>
<p>å­—èŠ‚æµ</p>
<p>ä¸€ä¸ªä¸€ä¸ªå­—èŠ‚è¯»å–ï¼Œè¯»ä¸€ä¸ªæ‰“å°ä¸€ä¸ª</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301261712105.png" alt="image-20230126171245898" loading="lazy"></p>
<p>å­—èŠ‚æµ + ç¼“å†²åŒº</p>
<p>ä¸€æ¬¡è¯»å–ä¸€ä¸ª <code>å­—èŠ‚ç¼“å†²åŒº</code> å¤§å°çš„å­—èŠ‚æ•°ï¼Œå­˜æ»¡åä¸€èµ·æ‰“å°</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301261711887.png" alt="image-20230126171114657" loading="lazy"></p>
<p>å­—ç¬¦æµ</p>
<p>ä¸€æ¬¡è¯»å–ä¸€ä¸ª <code>å­—èŠ‚ç¼“å†²åŒº</code> å¤§å°çš„å­—èŠ‚ï¼Œæ­¤å¤§å°æ­£å¥½ç»„è£…æˆä¸€ä¸ªå­—ç¬¦ï¼Œå†æš‚å­˜åˆ° <code>å­—ç¬¦ç¼“å†²åŒº</code>ï¼Œå­˜æ»¡åä¸€èµ·æ‰“å°</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301261716326.png" alt="image-20230126171626972" loading="lazy"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301261653967.png" alt="image-20230126165309740" loading="lazy"></p>
<h5 id="RDD-1"><a href="#RDD-1" class="headerlink" title="RDD"></a>RDD</h5><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301261655898.png" alt="image-20230126165522532" loading="lazy"></p>
<ul>
<li>RDD çš„æ•°æ®å¤„ç†æ–¹å¼ç±»ä¼¼äº IO æµï¼Œä¹Ÿä½“ç°äº†è£…é¥°è€…è®¾è®¡æ¨¡å¼</li>
<li>RDD çš„æ•°æ®åªæœ‰åœ¨è°ƒç”¨ collect æ–¹æ³•æ—¶ï¼Œæ‰ä¼šçœŸæ­£æ‰§è¡Œä¸šåŠ¡é€»è¾‘æ“ä½œï¼Œä¹‹å‰çš„å°è£…å‡ä¸ºåŠŸèƒ½æ‰©å±•</li>
<li>RDD ä¸ä¿å­˜æ•°æ®ï¼Œä½† IO å¯ä»¥é€šè¿‡ç¼“å†²åŒºæš‚å­˜ä¸€éƒ¨åˆ†æ•°æ®</li>
</ul>
<h4 id="RDD-åˆ›å»º"><a href="#RDD-åˆ›å»º" class="headerlink" title="RDD åˆ›å»º"></a>RDD åˆ›å»º</h4><h5 id="ä»å†…å­˜ä¸­åˆ›å»º-RDD"><a href="#ä»å†…å­˜ä¸­åˆ›å»º-RDD" class="headerlink" title="ä»å†…å­˜ä¸­åˆ›å»º RDD"></a>ä»å†…å­˜ä¸­åˆ›å»º RDD</h5><pre class="language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> sparkConf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">"local[*]"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">"spark"</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> sparkContext <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>sparkConf<span class="token punctuation">)</span>
<span class="token keyword">val</span> rdd1 <span class="token operator">=</span> sparkContext<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>
    List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">val</span> rdd2 <span class="token operator">=</span> sparkContext<span class="token punctuation">.</span>makeRDD<span class="token punctuation">(</span>
    List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
rdd1<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">)</span>
rdd2<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">)</span>
sparkContext<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<p>Spark ä¸»è¦æä¾›äº†ä¸¤ä¸ªæ–¹æ³•ï¼š<code>parallelize</code> å’Œ <code>makeRDD</code></p>
<p>åº•å±‚ä»£ç ä¸­ <code>makeRDD</code> æ–¹æ³•å…¶å®å°±æ˜¯ <code>parallelize</code> æ–¹æ³•ï¼Œä¸”å¤§éƒ¨åˆ†æ—¶å€™ä½¿ç”¨ <code>makeRDD</code> æ–¹æ³•å±…å¤š</p>
<h5 id="ä»å¤–å­˜ä¸­åˆ›å»º-RDD"><a href="#ä»å¤–å­˜ä¸­åˆ›å»º-RDD" class="headerlink" title="ä»å¤–å­˜ä¸­åˆ›å»º RDD"></a>ä»å¤–å­˜ä¸­åˆ›å»º RDD</h5><p>ç”±å¤–éƒ¨å­˜å‚¨ç³»ç»Ÿçš„æ•°æ®é›†åˆ›å»º RDD åŒ…æ‹¬ï¼š</p>
<ul>
<li>æœ¬åœ°çš„æ–‡ä»¶ç³»ç»Ÿ</li>
<li>æ‰€æœ‰ Hadoop æ”¯æŒçš„æ•°æ®é›†ï¼Œæ¯”å¦‚ HDFSã€HBase ç­‰</li>
</ul>
<pre class="language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> sparkConf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">"local[*]"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">"spark"</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> sparkContext <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>sparkConf<span class="token punctuation">)</span>
<span class="token keyword">val</span> fileRDD<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> sparkContext<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">"input"</span><span class="token punctuation">)</span>
fileRDD<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">)</span>
sparkContext<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<h5 id="ä»å…¶ä»–-RDD-åˆ›å»º"><a href="#ä»å…¶ä»–-RDD-åˆ›å»º" class="headerlink" title="ä»å…¶ä»– RDD åˆ›å»º"></a>ä»å…¶ä»– RDD åˆ›å»º</h5><p>é€šè¿‡ä¸€ä¸ª RDD è¿ç®—å®Œåï¼Œå†äº§ç”Ÿæ–°çš„ RDD</p>
<h5 id="ç›´æ¥åˆ›å»º-RDDï¼ˆnewï¼‰"><a href="#ç›´æ¥åˆ›å»º-RDDï¼ˆnewï¼‰" class="headerlink" title="ç›´æ¥åˆ›å»º RDDï¼ˆnewï¼‰"></a>ç›´æ¥åˆ›å»º RDDï¼ˆnewï¼‰</h5><p>ä½¿ç”¨ new çš„æ–¹å¼ç›´æ¥æ„é€  RDDï¼Œä¸€èˆ¬ç”± Spark æ¡†æ¶è‡ªèº«ä½¿ç”¨</p>
<h4 id="RDD-åˆ†åŒº"><a href="#RDD-åˆ†åŒº" class="headerlink" title="RDD åˆ†åŒº"></a>RDD åˆ†åŒº</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpark å¯ä»¥å°†ä¸€ä¸ªä½œä¸šåˆ‡åˆ†å¤šä¸ªä»»åŠ¡åï¼Œå‘é€ç»™ Executor èŠ‚ç‚¹å¹¶è¡Œè®¡ç®—ï¼Œè€Œ<strong>èƒ½å¤Ÿå¹¶è¡Œè®¡ç®—çš„ä»»åŠ¡æ•°é‡</strong>ç§°ä¹‹ä¸ºå¹¶è¡Œåº¦ï¼Œè¿™ä¸ªæ•°é‡å¯ä»¥åœ¨æ„å»º RDD æ—¶æŒ‡å®š</p>
<p>æ³¨æ„ï¼Œè¿™é‡Œæ˜¯æŒ‡<strong>å¹¶è¡Œæ‰§è¡Œçš„ä»»åŠ¡æ•°é‡</strong>ï¼Œå¹¶ä¸æ˜¯æŒ‡<strong>åˆ‡åˆ†ä»»åŠ¡çš„æ•°é‡</strong></p>
<pre class="language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> sparkConf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">"local[*]"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">"spark"</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> sparkContext <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>sparkConf<span class="token punctuation">)</span>
<span class="token keyword">val</span> dataRDD<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span>
    sparkContext<span class="token punctuation">.</span>makeRDD<span class="token punctuation">(</span>
        List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> fileRDD<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span>
    sparkContext<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span>
        <span class="token string">"input"</span><span class="token punctuation">,</span>
        <span class="token number">2</span><span class="token punctuation">)</span>
fileRDD<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">)</span>
sparkContext<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<ul>
<li>è¯»å–<strong>å†…å­˜æ•°æ®</strong>æ—¶ï¼Œæ•°æ®å¯ä»¥æŒ‰ç…§å¹¶è¡Œåº¦çš„è®¾å®šè¿›è¡Œæ•°æ®çš„åˆ†åŒºæ“ä½œ</li>
<li>è¯»å–<strong>æ–‡ä»¶æ•°æ®</strong>æ—¶ï¼Œæ•°æ®æ˜¯æŒ‰ç…§ Hadoop æ–‡ä»¶è¯»å–çš„è§„åˆ™è¿›è¡Œåˆ‡ç‰‡åˆ†åŒºï¼Œè€Œåˆ‡ç‰‡è§„åˆ™å’Œæ•°æ®è¯»å–è§„åˆ™æœ‰å·®å¼‚</li>
</ul>
<h3 id="RDD-ç®—å­"><a href="#RDD-ç®—å­" class="headerlink" title="RDD ç®—å­"></a>RDD ç®—å­</h3><p>RDD ç®—å­å°±æ˜¯ RDD æ–¹æ³•ï¼Œåªæ˜¯åç§°ä¸åŒ</p>
<p>RDD æ–¹æ³•åˆ†ä¸ºè½¬æ¢æ–¹æ³•å’Œè¡ŒåŠ¨æ–¹æ³•</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301262300141.png" alt="image-20230126230055836" loading="lazy"></p>
<h4 id="RDD-è½¬æ¢ç®—å­"><a href="#RDD-è½¬æ¢ç®—å­" class="headerlink" title="RDD è½¬æ¢ç®—å­"></a>RDD è½¬æ¢ç®—å­</h4><p>RDD æ ¹æ®æ•°æ®å¤„ç†æ–¹å¼çš„ä¸åŒå°†ç®—å­æ•´ä½“ä¸Šåˆ†ä¸º </p>
<ul>
<li>Value ç±»å‹</li>
<li>åŒ Value ç±»å‹</li>
<li>Key-Value ç±»å‹</li>
</ul>
<h5 id="Valueç±»å‹"><a href="#Valueç±»å‹" class="headerlink" title="Valueç±»å‹"></a>Valueç±»å‹</h5><ul>
<li><p>map</p>
<p>å°†å¤„ç†çš„æ•°æ®é€æ¡è¿›è¡Œæ˜ å°„è½¬æ¢ï¼Œè¿™é‡Œçš„è½¬æ¢å¯ä»¥æ˜¯ç±»å‹çš„è½¬æ¢ï¼Œä¹Ÿå¯ä»¥æ˜¯å€¼çš„è½¬æ¢</p>
</li>
<li><p>mapPartitions</p>
<p>å°†å¾…å¤„ç†çš„æ•°æ®ä»¥åˆ†åŒºä¸ºå•ä½å‘é€åˆ°è®¡ç®—èŠ‚ç‚¹è¿›è¡Œå¤„ç†ï¼Œè¿™é‡Œçš„å¤„ç†æ˜¯è¿›è¡Œä»»æ„å¤„ç†ï¼Œä¹Ÿå¯ä»¥æ˜¯è¿‡æ»¤æ•°æ®</p>
</li>
</ul>
<blockquote>
<p>map ä¸ mapPartitions çš„åŒºåˆ«</p>
<p>map æ˜¯åˆ†åŒºå†…ä¸€ä¸ªæ•°æ®ä¸€ä¸ªæ•°æ®çš„æ‰§è¡Œï¼Œç±»ä¼¼äºä¸²è¡Œæ“ä½œ</p>
<p>mapPartitions æ˜¯ä»¥åˆ†åŒºä¸ºå•ä½è¿›è¡Œæ‰¹å¤„ç†æ“ä½œ</p>
<p>æ‰€ä»¥ï¼Œmap å› ä¸ºç±»ä¼¼äºä¸²è¡Œæ“ä½œï¼Œæ€§èƒ½æ¯”è¾ƒä½ï¼Œè€Œ mapPartitions ç±»ä¼¼äºæ‰¹å¤„ç†ï¼Œæ€§èƒ½è¾ƒé«˜ï¼Œä½†æ˜¯ mapPartitions ä¼šé•¿æ—¶é—´å ç”¨å†…å­˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºï¼Œåœ¨å†…å­˜æœ‰é™çš„æƒ…å†µä¸‹ä¸æ¨èä½¿ç”¨</p>
</blockquote>
<ul>
<li><p>mapPartitionsWithIndex</p>
<p>ä¸ mapPartitions ç±»ä¼¼ï¼Œåªæ˜¯åœ¨å¤„ç†æ—¶å¯ä»¥è·å–å½“å‰åˆ†åŒºç´¢å¼•</p>
</li>
<li><p>flatMap</p>
<p>å°†å¤„ç†çš„æ•°æ®è¿›è¡Œæ‰å¹³åŒ–åå†è¿›è¡Œæ˜ å°„å¤„ç†ï¼Œæ‰€ä»¥ç®—å­ä¹Ÿç§°ä¹‹ä¸ºæ‰å¹³æ˜ å°„</p>
</li>
<li><p>glom</p>
<p>å°†åŒä¸€ä¸ªåˆ†åŒºçš„æ•°æ®ç›´æ¥è½¬æ¢ä¸ºç›¸åŒç±»å‹çš„å†…å­˜æ•°ç»„è¿›è¡Œå¤„ç†ï¼Œåˆ†åŒºä¸å˜</p>
</li>
<li><p>groupBy</p>
<p>å°†æ•°æ®æ ¹æ®æŒ‡å®šçš„è§„åˆ™è¿›è¡Œåˆ†ç»„ï¼Œåˆ†åŒºé»˜è®¤ä¸å˜ï¼Œä½†æ˜¯æ•°æ®ä¼šè¢«æ‰“ä¹±é‡æ–°ç»„åˆï¼Œè¿™æ ·çš„æ“ä½œç§°ä¹‹ä¸º shuffle</p>
</li>
<li><p>filter</p>
<p>å°†æ•°æ®æ ¹æ®æŒ‡å®šçš„è§„åˆ™è¿›è¡Œç­›é€‰è¿‡æ»¤ï¼Œç¬¦åˆè§„åˆ™çš„æ•°æ®ä¿ç•™ï¼Œä¸ç¬¦åˆè§„åˆ™çš„æ•°æ®ä¸¢å¼ƒ</p>
</li>
<li><p>sample</p>
<p>æ ¹æ®æŒ‡å®šçš„è§„åˆ™ä»æ•°æ®é›†ä¸­æŠ½å–æ•°æ®</p>
</li>
<li><p>distinct</p>
<p>å°†æ•°æ®é›†ä¸­é‡å¤çš„æ•°æ®å»é‡</p>
</li>
<li><p>coalesce</p>
<p>æ ¹æ®æ•°æ®é‡ç¼©å‡åˆ†åŒºï¼Œå½“å­˜åœ¨è¿‡å¤šå°ä»»åŠ¡æ—¶ï¼Œå¯ä»¥é€šè¿‡ coalesce æ–¹æ³•æ”¶ç¼©åˆå¹¶åˆ†åŒºï¼Œå‡å°‘åˆ†åŒºçš„ä¸ªæ•°ï¼Œå‡å°ä»»åŠ¡è°ƒåº¦æˆæœ¬</p>
</li>
<li><p>sortBy</p>
<p>ç”¨äºæ’åºæ•°æ®</p>
</li>
</ul>
<h5 id="åŒ-Value-ç±»å‹"><a href="#åŒ-Value-ç±»å‹" class="headerlink" title="åŒ Value ç±»å‹"></a>åŒ Value ç±»å‹</h5><ul>
<li><p>intersection</p>
<p>å¯¹ä¸¤ä¸ª RDD æ±‚äº¤é›†</p>
</li>
<li><p>union</p>
<p>å¯¹ä¸¤ä¸ª RDD æ±‚å¹¶é›†</p>
</li>
<li><p>subtract</p>
<p>å¯¹ä¸¤ä¸ª RDD æ±‚å·®é›†ï¼Œä»¥ä¸€ä¸ª RDD å…ƒç´ ä¸ºä¸»ï¼Œå»é™¤ä¸¤ä¸ª RDD ä¸­é‡å¤å…ƒç´ ï¼Œå°†å…¶ä»–å…ƒç´ ä¿ç•™ä¸‹æ¥</p>
</li>
<li><p>zip</p>
<p>å°†ä¸¤ä¸ª RDD ä¸­çš„å…ƒç´ ä»¥é”®å€¼å¯¹çš„å½¢å¼è¿›è¡Œåˆå¹¶ï¼Œå…¶ä¸­é”®å€¼å¯¹ä¸­çš„ Key ä¸ºç¬¬ 1 ä¸ª RDD ä¸­çš„å…ƒç´ ï¼ŒValue ä¸ºç¬¬ 2 ä¸ª RDD ä¸­çš„ç›¸åŒä½ç½®çš„å…ƒç´ </p>
</li>
</ul>
<h5 id="Key-Value-ç±»å‹"><a href="#Key-Value-ç±»å‹" class="headerlink" title="Key - Value ç±»å‹"></a>Key - Value ç±»å‹</h5><ul>
<li><p>partitionBy</p>
<p>å°†æ•°æ®æŒ‰ç…§æŒ‡å®š Partitioner é‡æ–°è¿›è¡Œåˆ†åŒºï¼ŒSpark é»˜è®¤çš„åˆ†åŒºå™¨æ˜¯ HashPartitioner</p>
</li>
<li><p>reduceByKey</p>
<p>å¯ä»¥å°†æ•°æ®æŒ‰ç…§ç›¸åŒçš„ key å¯¹ value è¿›è¡Œèšåˆ</p>
</li>
<li><p>groupByKey</p>
<p>å°†æ•°æ®æºçš„æ•°æ®æ ¹æ® key å¯¹ value è¿›è¡Œåˆ†ç»„</p>
</li>
<li><p>aggregateByKey</p>
<p>å°†æ•°æ®æ ¹æ®ä¸åŒçš„è§„åˆ™è¿›è¡Œåˆ†åŒºå†…è®¡ç®—å’Œåˆ†åŒºé—´è®¡ç®—</p>
</li>
<li><p>foldByKey</p>
<p>å½“åˆ†åŒºå†…è®¡ç®—è§„åˆ™å’Œåˆ†åŒºé—´è®¡ç®—è§„åˆ™ç›¸åŒæ—¶ï¼ŒaggregateByKey å°±å¯ä»¥ç®€åŒ–ä¸º foldByKey</p>
</li>
<li><p>combineByKey</p>
<p>æœ€é€šç”¨çš„å¯¹ key-value å‹ RDD è¿›è¡Œèšé›†æ“ä½œçš„èšé›†å‡½æ•°</p>
</li>
<li><p>sortByKey</p>
<p>åœ¨ä¸€ä¸ª (K,V) çš„ RDD ä¸Šè°ƒç”¨ï¼ŒK å¿…é¡»å®ç° Ordered æ¥å£(ç‰¹è´¨)ï¼Œè¿”å›ä¸€ä¸ªæŒ‰ç…§ key è¿›è¡Œæ’åºçš„ RDD</p>
</li>
<li><p>join</p>
<p>åœ¨ç±»å‹ä¸º (K,V) å’Œ (K,W) çš„ RDD ä¸Šè°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ªç›¸åŒ key å¯¹åº”çš„æ‰€æœ‰å…ƒç´ è¿æ¥åœ¨ä¸€èµ·çš„ (K,(V,W)) çš„ RDD</p>
</li>
</ul>
<h4 id="RDD-è¡ŒåŠ¨ç®—å­"><a href="#RDD-è¡ŒåŠ¨ç®—å­" class="headerlink" title="RDD è¡ŒåŠ¨ç®—å­"></a>RDD è¡ŒåŠ¨ç®—å­</h4><ul>
<li><p>reduce</p>
<p>èšé›† RDD ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå…ˆèšåˆåˆ†åŒºå†…æ•°æ®ï¼Œå†èšåˆåˆ†åŒºé—´æ•°æ®</p>
</li>
<li><p>collect</p>
<p>åœ¨é©±åŠ¨ç¨‹åºä¸­ï¼Œä»¥æ•°ç»„ Array çš„å½¢å¼è¿”å›æ•°æ®é›†çš„æ‰€æœ‰å…ƒç´ </p>
</li>
<li><p>count</p>
<p>è¿”å› RDD ä¸­å…ƒç´ çš„ä¸ªæ•°</p>
</li>
<li><p>first</p>
<p>è¿”å› RDD ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ </p>
</li>
<li><p>take</p>
<p>è¿”å›ä¸€ä¸ªç”± RDD çš„å‰ n ä¸ªå…ƒç´ ç»„æˆçš„æ•°ç»„</p>
</li>
<li><p>takeOrdered</p>
<p>è¿”å›è¯¥ RDD æ’åºåçš„å‰ n ä¸ªå…ƒç´ ç»„æˆçš„æ•°ç»„</p>
</li>
<li><p>aggregate</p>
<p>åˆ†åŒºçš„æ•°æ®é€šè¿‡åˆå§‹å€¼å’Œåˆ†åŒºå†…çš„æ•°æ®è¿›è¡Œèšåˆï¼Œç„¶åå†å’Œåˆå§‹å€¼è¿›è¡Œåˆ†åŒºé—´çš„æ•°æ®èšåˆ</p>
</li>
<li><p>fold</p>
<p>æŠ˜å æ“ä½œï¼Œaggregate çš„ç®€åŒ–ç‰ˆæ“ä½œ</p>
</li>
<li><p>countByKey</p>
<p>ç»Ÿè®¡æ¯ç§ key çš„ä¸ªæ•°</p>
</li>
<li><p>save ç›¸å…³</p>
<p>å°†æ•°æ®ä¿å­˜åˆ°ä¸åŒæ ¼å¼çš„æ–‡ä»¶ä¸­</p>
</li>
<li><p>foreach</p>
<p>åˆ†å¸ƒå¼éå† RDD ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œè°ƒç”¨æŒ‡å®šå‡½æ•°</p>
</li>
</ul>
<h3 id="RDD-åºåˆ—åŒ–"><a href="#RDD-åºåˆ—åŒ–" class="headerlink" title="RDD åºåˆ—åŒ–"></a>RDD åºåˆ—åŒ–</h3><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202301262351595.png" loading="lazy"></p>
<p>ä»è®¡ç®—çš„è§’åº¦ï¼Œç®—å­å¤–çš„ä»£ç éƒ½æ˜¯åœ¨ Driver ç«¯æ‰§è¡Œï¼Œç®—å­å†…çš„ä»£ç éƒ½æ˜¯åœ¨ Executor ç«¯æ‰§è¡Œ</p>
<p>é‚£ä¹ˆåœ¨ Scala çš„å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œå°±ä¼šå¯¼è‡´ç®—å­å†…ç»å¸¸ä¼šç”¨åˆ°ç®—å­å¤–çš„æ•°æ®ï¼Œå¦‚æœä½¿ç”¨çš„ç®—å­å¤–çš„æ•°æ®æ— æ³•åºåˆ—åŒ–ï¼Œå°±æ„å‘³ç€æ— æ³•<strong>é€šè¿‡ç½‘ç»œ</strong>ä¼ å€¼ç»™ Executor ç«¯æ‰§è¡Œï¼Œå‘ç”Ÿé”™è¯¯</p>
<p>æ‰€ä»¥éœ€è¦åœ¨æ‰§è¡Œä»»åŠ¡è®¡ç®—å‰ï¼Œæ£€æµ‹é—­åŒ…å†…çš„å¯¹è±¡æ˜¯å¦å¯ä»¥è¿›è¡Œåºåˆ—åŒ–ï¼Œè¿™ä¸ªæ“ä½œç§°ä¹‹ä¸ºé—­åŒ…æ£€æµ‹</p>
<h4 id="Kryo-åºåˆ—åŒ–æ¡†æ¶"><a href="#Kryo-åºåˆ—åŒ–æ¡†æ¶" class="headerlink" title="Kryo åºåˆ—åŒ–æ¡†æ¶"></a>Kryo åºåˆ—åŒ–æ¡†æ¶</h4><p>Java çš„åºåˆ—åŒ–èƒ½å¤Ÿåºåˆ—åŒ–ä»»ä½•ç±»ï¼Œä½†æ˜¯ç”Ÿæˆçš„å­—èŠ‚å¤šï¼Œåºåˆ—åŒ–åå¯¹è±¡æ¯”è¾ƒå¤§</p>
<p>Spark å‡ºäºæ€§èƒ½çš„è€ƒè™‘ï¼ŒSpark2.0 å¼€å§‹æ”¯æŒå¦å¤–ä¸€ç§ Kryo åºåˆ—åŒ–æœºåˆ¶</p>
<p>Kryo é€Ÿåº¦æ˜¯ Serializable çš„ 10 å€ï¼Œå½“ RDD åœ¨ Shuffle æ•°æ®çš„æ—¶å€™ï¼Œç®€å•æ•°æ®ç±»å‹ã€æ•°ç»„å’Œå­—ç¬¦ä¸²ç±»å·²ç»åœ¨ Spark å†…éƒ¨ä½¿ç”¨ Kryo æ¥åºåˆ—åŒ–</p>
<h3 id="RDD-ä¾èµ–å…³ç³»"><a href="#RDD-ä¾èµ–å…³ç³»" class="headerlink" title="RDD ä¾èµ–å…³ç³»"></a>RDD ä¾èµ–å…³ç³»</h3><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302091705504.png" alt="image-20230209170526155" loading="lazy"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302091705344.png" alt="image-20230209170536238" loading="lazy"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302091712456.png" alt="image-20230209171241203" loading="lazy"></p>
<p>RDD æ˜¯ä¸ä¼šä¿å­˜æ•°æ®çš„ï¼Œä¸ºäº†æä¾›å®¹é”™æ€§ï¼Œéœ€è¦å°† RDD çš„ä¾èµ–å…³ç³»ä¿å­˜ä¸‹æ¥</p>
<p>ä¸€æ—¦å‘ç”Ÿé”™è¯¯ï¼Œå¯æ ¹æ®è¡€ç¼˜å…³ç³»é‡æ–°è¯»å–æ•°æ®å¹¶è®¡ç®—</p>
<h4 id="ä¾èµ–å…³ç³»"><a href="#ä¾èµ–å…³ç³»" class="headerlink" title="ä¾èµ–å…³ç³»"></a>ä¾èµ–å…³ç³»</h4><p><code>val rdd1 = rdd.map(_ * 2)</code></p>
<p>ç›¸é‚»ä¸¤ä¸ª RDD ç§°ä¸ºä¾èµ–å…³ç³»</p>
<h4 id="è¡€ç¼˜å…³ç³»"><a href="#è¡€ç¼˜å…³ç³»" class="headerlink" title="è¡€ç¼˜å…³ç³»"></a>è¡€ç¼˜å…³ç³»</h4><p>RDD1ã€RDD2ã€RDD3ã€RDD4 ç§°ä¸ºè¡€ç¼˜å…³ç³»</p>
<h4 id="çª„ä¾èµ–"><a href="#çª„ä¾èµ–" class="headerlink" title="çª„ä¾èµ–"></a>çª„ä¾èµ–</h4><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302091731919.png" alt="image-20230209173155612" loading="lazy"></p>
<p>çª„ä¾èµ–è¡¨ç¤ºæ¯ä¸€ä¸ªçˆ¶ RDD çš„ Partition æœ€å¤šè¢«å­ RDD çš„ä¸€ä¸ª Partition ä½¿ç”¨</p>
<p>çª„ä¾èµ–å¯ç±»æ¯”ç‹¬ç”Ÿå­å¥³</p>
<h4 id="å®½ä¾èµ–"><a href="#å®½ä¾èµ–" class="headerlink" title="å®½ä¾èµ–"></a>å®½ä¾èµ–</h4><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302091732650.png" alt="image-20230209173250322" loading="lazy"></p>
<p>å®½ä¾èµ–è¡¨ç¤ºåŒä¸€ä¸ªçˆ¶ RDD çš„ Partition è¢«å¤šä¸ªå­ RDD çš„ Partition ä¾èµ–ï¼Œä¼šå¼•èµ· Shuffle</p>
<p>å®½ä¾èµ–å¯ç±»æ¯”å¤šç”Ÿ</p>
<h3 id="RDD-æŒä¹…åŒ–"><a href="#RDD-æŒä¹…åŒ–" class="headerlink" title="RDD æŒä¹…åŒ–"></a>RDD æŒä¹…åŒ–</h3><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302091753853.png" alt="image-20230209175349601" loading="lazy"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302091754211.png" alt="image-20230209175429945" loading="lazy"></p>
<p>RDD ä¸å­˜å‚¨æ•°æ®ï¼Œå¦‚æœä¸€ä¸ª RDD éœ€è¦é‡å¤ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±éœ€è¦<strong>ä»å¤´å¼€å§‹</strong>å†æ¬¡æ‰§è¡Œæ¥è·å–æ•°æ®</p>
<p>åœ¨æ•°æ®æ‰§è¡Œä»»åŠ¡è¾ƒé•¿ï¼Œæˆ–æ•°æ®æ¯”è¾ƒé‡è¦çš„åœºåˆå¯ä»¥ä½¿ç”¨æŒä¹…åŒ–</p>
<h4 id="RDD-Cache-ç¼“å­˜"><a href="#RDD-Cache-ç¼“å­˜" class="headerlink" title="RDD Cache ç¼“å­˜"></a>RDD Cache ç¼“å­˜</h4><p>RDD é€šè¿‡ Cache æˆ–è€… Persist æ–¹æ³•å°†å‰é¢çš„è®¡ç®—ç»“æœè¿›è¡Œç¼“å­˜ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šæŠŠæ•°æ®ç¼“å­˜åœ¨ JVM çš„å †å†…å­˜ä¸­</p>
<p>ç¼“å­˜æœ‰å¯èƒ½ä¸¢å¤±æˆ–è€…ç”±äºå†…å­˜ä¸è¶³è€Œè¢«åˆ é™¤ï¼ŒRDD çš„ç¼“å­˜å®¹é”™æœºåˆ¶ä¿è¯äº†å³ä½¿ç¼“å­˜ä¸¢å¤±ä¹Ÿèƒ½ä¿è¯è®¡ç®—çš„æ­£ç¡®æ‰§è¡Œ</p>
<pre class="language-scala" data-language="scala"><code class="language-scala"><span class="token comment">// cache æ“ä½œä¼šå¢åŠ è¡€ç¼˜å…³ç³»ï¼Œä¸æ”¹å˜åŸæœ‰çš„è¡€ç¼˜å…³ç³»</span>
println<span class="token punctuation">(</span>wordToOneRdd<span class="token punctuation">.</span>toDebugString<span class="token punctuation">)</span>
<span class="token comment">// æ•°æ®ç¼“å­˜</span>
wordToOneRdd<span class="token punctuation">.</span>cache<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// å¯ä»¥æ›´æ”¹å­˜å‚¨çº§åˆ«</span>
mapRdd<span class="token punctuation">.</span>persist<span class="token punctuation">(</span>StorageLevel<span class="token punctuation">.</span>MEMORY_AND_DISK_2<span class="token punctuation">)</span></code></pre>

<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302091741399.png" alt="image-20230209174139303" loading="lazy"></p>
<h4 id="RDD-CheckPoint-æ£€æŸ¥ç‚¹"><a href="#RDD-CheckPoint-æ£€æŸ¥ç‚¹" class="headerlink" title="RDD CheckPoint æ£€æŸ¥ç‚¹"></a>RDD CheckPoint æ£€æŸ¥ç‚¹</h4><p>æ£€æŸ¥ç‚¹å…¶å®å°±æ˜¯å°† RDD ä¸­é—´ç»“æœå†™å…¥ç£ç›˜</p>
<p>è¡€ç¼˜ä¾èµ–è¿‡é•¿ä¼šé€ æˆå®¹é”™æˆæœ¬è¿‡é«˜ï¼Œå¦‚æœæ£€æŸ¥ç‚¹ä¹‹åæœ‰èŠ‚ç‚¹å‡ºç°é—®é¢˜ï¼Œå¯ä»¥ä»æ£€æŸ¥ç‚¹å¼€å§‹é‡åšè¡€ç¼˜ï¼Œå‡å°‘äº†å¼€é”€</p>
<h4 id="ç¼“å­˜å’Œæ£€æŸ¥ç‚¹åŒºåˆ«"><a href="#ç¼“å­˜å’Œæ£€æŸ¥ç‚¹åŒºåˆ«" class="headerlink" title="ç¼“å­˜å’Œæ£€æŸ¥ç‚¹åŒºåˆ«"></a>ç¼“å­˜å’Œæ£€æŸ¥ç‚¹åŒºåˆ«</h4><ul>
<li><p>Cache ç¼“å­˜åªæ˜¯å°†æ•°æ®ä¿å­˜èµ·æ¥ï¼Œä¸åˆ‡æ–­è¡€ç¼˜ä¾èµ–</p>
<p>Checkpoint æ£€æŸ¥ç‚¹åˆ‡æ–­è¡€ç¼˜ä¾èµ–</p>
</li>
<li><p>Cache ç¼“å­˜çš„æ•°æ®é€šå¸¸å­˜å‚¨åœ¨å†…å­˜ï¼Œå¯é æ€§ä½</p>
<p>Checkpoint çš„æ•°æ®é€šå¸¸å­˜å‚¨åœ¨ HDFS ç­‰å®¹é”™ã€é«˜å¯ç”¨çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¯é æ€§é«˜</p>
</li>
</ul>
<h3 id="RDD-åˆ†åŒºå™¨"><a href="#RDD-åˆ†åŒºå™¨" class="headerlink" title="RDD åˆ†åŒºå™¨"></a>RDD åˆ†åŒºå™¨</h3><p>Spark ç›®å‰æ”¯æŒ Hash åˆ†åŒºã€Range åˆ†åŒºã€ç”¨æˆ·è‡ªå®šä¹‰åˆ†åŒºï¼Œé»˜è®¤ä¸º Hash åˆ†åŒº</p>
<p>åªæœ‰ Key-Value ç±»å‹çš„ RDD æ‰æœ‰åˆ†åŒºå™¨ï¼Œé Key-Value ç±»å‹çš„ RDD åˆ†åŒºçš„å€¼æ˜¯ None</p>
<h4 id="Hash-åˆ†åŒº"><a href="#Hash-åˆ†åŒº" class="headerlink" title="Hash åˆ†åŒº"></a>Hash åˆ†åŒº</h4><p>å¯¹äºç»™å®šçš„ keyï¼Œè®¡ç®—å…¶ hashCode,å¹¶é™¤ä»¥åˆ†åŒºä¸ªæ•°å–ä½™</p>
<h4 id="Range-åˆ†åŒº"><a href="#Range-åˆ†åŒº" class="headerlink" title="Range åˆ†åŒº"></a>Range åˆ†åŒº</h4><p>å°†ä¸€å®šèŒƒå›´å†…çš„æ•°æ®æ˜ å°„åˆ°ä¸€ä¸ªåˆ†åŒºä¸­ï¼Œå°½é‡ä¿è¯æ¯ä¸ªåˆ†åŒºæ•°æ®å‡åŒ€ï¼Œè€Œ ä¸”åˆ†åŒºé—´æœ‰åº</p>
<h3 id="RDD-æ–‡ä»¶è¯»å–ä¸ä¿å­˜"><a href="#RDD-æ–‡ä»¶è¯»å–ä¸ä¿å­˜" class="headerlink" title="RDD æ–‡ä»¶è¯»å–ä¸ä¿å­˜"></a>RDD æ–‡ä»¶è¯»å–ä¸ä¿å­˜</h3><p>Spark çš„æ•°æ®è¯»å–åŠæ•°æ®ä¿å­˜å¯ä»¥ä»ä¸¤ä¸ªç»´åº¦æ¥ä½œåŒºåˆ†ï¼šæ–‡ä»¶æ ¼å¼ä»¥åŠæ–‡ä»¶ç³»ç»Ÿ</p>
<p>æ–‡ä»¶æ ¼å¼åˆ†ä¸ºï¼štext æ–‡ä»¶ã€csv æ–‡ä»¶ã€sequence æ–‡ä»¶ä»¥åŠ Object æ–‡ä»¶</p>
<p>æ–‡ä»¶ç³»ç»Ÿåˆ†ä¸ºï¼šæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€HDFSã€HBASE ä»¥åŠæ•°æ®åº“</p>
<h4 id="text-æ–‡ä»¶"><a href="#text-æ–‡ä»¶" class="headerlink" title="text æ–‡ä»¶"></a>text æ–‡ä»¶</h4><pre class="language-scala" data-language="scala"><code class="language-scala"><span class="token comment">// è¯»å–è¾“å…¥æ–‡ä»¶</span>
<span class="token keyword">val</span> inputRDD<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">"input/1.txt"</span><span class="token punctuation">)</span>
<span class="token comment">// ä¿å­˜æ•°æ®</span>
inputRDD<span class="token punctuation">.</span>saveAsTextFile<span class="token punctuation">(</span><span class="token string">"output"</span><span class="token punctuation">)</span></code></pre>

<h4 id="sequence-æ–‡ä»¶"><a href="#sequence-æ–‡ä»¶" class="headerlink" title="sequence æ–‡ä»¶"></a>sequence æ–‡ä»¶</h4><p>SequenceFile æ–‡ä»¶æ˜¯ Hadoop ç”¨æ¥å­˜å‚¨äºŒè¿›åˆ¶å½¢å¼çš„ key-value è€Œè®¾è®¡çš„ä¸€ç§å¹³é¢æ–‡ä»¶ (Flat File)</p>
<pre class="language-scala" data-language="scala"><code class="language-scala"><span class="token comment">// ä¿å­˜æ•°æ®ä¸º SequenceFile</span>
dataRDD<span class="token punctuation">.</span>saveAsSequenceFile<span class="token punctuation">(</span><span class="token string">"output"</span><span class="token punctuation">)</span>
<span class="token comment">// è¯»å– SequenceFile æ–‡ä»¶</span>
sc<span class="token punctuation">.</span>sequenceFile<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"output"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">)</span></code></pre>

<h4 id="object-å¯¹è±¡æ–‡ä»¶"><a href="#object-å¯¹è±¡æ–‡ä»¶" class="headerlink" title="object å¯¹è±¡æ–‡ä»¶"></a>object å¯¹è±¡æ–‡ä»¶</h4><p>å¯¹è±¡æ–‡ä»¶æ˜¯å°†å¯¹è±¡åºåˆ—åŒ–åä¿å­˜çš„æ–‡ä»¶ï¼Œé‡‡ç”¨ Java çš„åºåˆ—åŒ–æœºåˆ¶</p>
<pre class="language-scala" data-language="scala"><code class="language-scala"><span class="token comment">// ä¿å­˜æ•°æ®</span>
dataRDD<span class="token punctuation">.</span>saveAsObjectFile<span class="token punctuation">(</span><span class="token string">"output"</span><span class="token punctuation">)</span>
<span class="token comment">// è¯»å–æ•°æ®</span>
sc<span class="token punctuation">.</span>objectFile<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"output"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">)</span></code></pre>

<h3 id="ç´¯åŠ å™¨"><a href="#ç´¯åŠ å™¨" class="headerlink" title="ç´¯åŠ å™¨"></a>ç´¯åŠ å™¨</h3><p>ç´¯åŠ å™¨ç”¨äºæŠŠ Executor çš„å˜é‡æ•°æ®èšåˆåˆ° Driver</p>
<p>å¯¹äºç´¯åŠ å™¨ï¼Œåœ¨ Driver ä¸­å®šä¹‰çš„å˜é‡ï¼Œæ¯ä¸ª Executor çš„ Task éƒ½ä¼šè¿›è¡Œå¤åˆ¶å¾—åˆ°ä¸€ä¸ªå‰¯æœ¬ï¼ŒTask æ›´æ–°å˜é‡å‰¯æœ¬åï¼Œä¼šè¿”å› Driver è¿›è¡Œåˆå¹¶</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302101720543.png" alt="image-20230210172002330" loading="lazy"></p>
<pre class="language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>makeRDD<span class="token punctuation">(</span>List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// å£°æ˜ç´¯åŠ å™¨</span>
<span class="token keyword">var</span> sum <span class="token operator">=</span> sc<span class="token punctuation">.</span>longAccumulator<span class="token punctuation">(</span><span class="token string">"sum"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rdd<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>
    num <span class="token keyword">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// ä½¿ç”¨ç´¯åŠ å™¨</span>
        sum<span class="token punctuation">.</span>add<span class="token punctuation">(</span>num<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span>
<span class="token comment">// è·å–ç´¯åŠ å™¨çš„å€¼</span>
println<span class="token punctuation">(</span><span class="token string">"sum = "</span> <span class="token operator">+</span> sum<span class="token punctuation">.</span>value<span class="token punctuation">)</span></code></pre>

<h3 id="å¹¿æ’­å˜é‡"><a href="#å¹¿æ’­å˜é‡" class="headerlink" title="å¹¿æ’­å˜é‡"></a>å¹¿æ’­å˜é‡</h3><p>é—­åŒ…æ•°æ®éƒ½æ˜¯ä»¥ Task ä¸ºå•ä½è¿›è¡Œå‘é€çš„ï¼Œè¿™æ ·å¯èƒ½å¯¼è‡´ä¸€ä¸ª Executor ä¸­å«æœ‰å¤§é‡é‡å¤æ•°æ®ï¼Œæµªè´¹å¤§é‡å†…å­˜</p>
<p>Executor æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª JVMï¼Œå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨ä¸ºå…¶åˆ†é…å†…å­˜ï¼Œå› æ­¤å¯ä»¥å°†é—­åŒ…æ•°æ®æ”¾åœ¨è¯¥å†…å­˜ä¸­ï¼Œè¾¾åˆ°å…±äº«ç›®çš„</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302101721345.png" alt="image-20230210172135194" loading="lazy"></p>
<pre class="language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> rdd1 <span class="token operator">=</span> sc<span class="token punctuation">.</span>makeRDD<span class="token punctuation">(</span>List<span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> list <span class="token operator">=</span> List<span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token comment">// å£°æ˜å¹¿æ’­å˜é‡</span>
<span class="token keyword">val</span> broadcast<span class="token operator">:</span> Broadcast<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> sc<span class="token punctuation">.</span>broadcast<span class="token punctuation">(</span>list<span class="token punctuation">)</span>
<span class="token keyword">val</span> resultRDD<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> rdd1<span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> num<span class="token punctuation">)</span> <span class="token keyword">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> num2 <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment">// ä½¿ç”¨å¹¿æ’­å˜é‡</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">&lt;-</span> broadcast<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token operator">==</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                num2 <span class="token operator">=</span> v
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token punctuation">(</span>num<span class="token punctuation">,</span> num2<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>



<h2 id="Spark-SQL"><a href="#Spark-SQL" class="headerlink" title="Spark SQL"></a>Spark SQL</h2><p>Spark SQL æ˜¯ Spark ç”¨äºå¤„ç†ç»“æ„åŒ–æ•°æ®ï¼ˆstructured dataï¼‰çš„æ¨¡å—</p>
<h3 id="Spark-SQL-ä¸-Hive"><a href="#Spark-SQL-ä¸-Hive" class="headerlink" title="Spark SQL ä¸ Hive"></a>Spark SQL ä¸ Hive</h3><p>Hive æ˜¯æ—©æœŸå”¯ä¸€è¿è¡Œåœ¨ Hadoop ä¸Šçš„ SQL-on-Hadoop å·¥å…·ï¼Œä½† MapReduce è®¡ç®—è¿‡ç¨‹ä¸­éœ€è¦è¿›è¡Œå¤§é‡ç£ç›˜ I/Oï¼Œé™ä½äº†è¿è¡Œæ•ˆç‡</p>
<p>Shark æ˜¯ SparkSQL çš„å‰èº«ï¼Œå®ƒçš„å‡ºç°ä½¿ SQL-on-Hadoop çš„æ€§èƒ½æ¯” Hive æœ‰äº† 10-100 å€çš„æé«˜ï¼Œä½†éšç€ Spark çš„å‘å±•ï¼ŒShark å¯¹ Hive è¿‡äºä¾èµ–ï¼Œåˆ¶çº¦äº† Spark çš„å‘å±•</p>
<p>SparkSQL æŠ›å¼ƒäº†åŸæœ‰ Shark çš„ä»£ç ï¼Œå¸å–äº†å…¶ä¸­çš„ä¼˜ç‚¹ï¼ŒåŒæ—¶æ‘†è„±äº†å¯¹ Hive çš„ä¾èµ–æ€§ï¼Œåœ¨æ•°æ®å…¼å®¹ã€æ€§èƒ½ä¼˜åŒ–ã€ç»„ä»¶æ‰©å±•æ–¹é¢æœ‰æå¤§æé«˜</p>
<h3 id="Spark-SQL-ç‰¹ç‚¹"><a href="#Spark-SQL-ç‰¹ç‚¹" class="headerlink" title="Spark SQL ç‰¹ç‚¹"></a>Spark SQL ç‰¹ç‚¹</h3><h4 id="æ˜“æ•´åˆ"><a href="#æ˜“æ•´åˆ" class="headerlink" title="æ˜“æ•´åˆ"></a>æ˜“æ•´åˆ</h4><p>ä¾¿æ·åœ°æ•´åˆäº† SQL æŸ¥è¯¢å’Œ Spark ç¼–ç¨‹</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302132144518.png" alt="image-20230213214353200" loading="lazy"></p>
<h4 id="æ•°æ®è®¿é—®æ–¹å¼ç»Ÿä¸€"><a href="#æ•°æ®è®¿é—®æ–¹å¼ç»Ÿä¸€" class="headerlink" title="æ•°æ®è®¿é—®æ–¹å¼ç»Ÿä¸€"></a>æ•°æ®è®¿é—®æ–¹å¼ç»Ÿä¸€</h4><p>ä½¿ç”¨ç›¸åŒçš„æ–¹å¼è¿æ¥ä¸åŒçš„æ•°æ®æº</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302132144369.png" alt="image-20230213214426269" loading="lazy"></p>
<h4 id="æ ‡å‡†æ•°æ®è¿æ¥"><a href="#æ ‡å‡†æ•°æ®è¿æ¥" class="headerlink" title="æ ‡å‡†æ•°æ®è¿æ¥"></a>æ ‡å‡†æ•°æ®è¿æ¥</h4><p>é€šè¿‡ JDBC æˆ–è€… ODBC æ¥è¿æ¥</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302132144548.png" alt="image-20230213214456341" loading="lazy"></p>
<h3 id="DataFrame"><a href="#DataFrame" class="headerlink" title="DataFrame"></a>DataFrame</h3><h4 id="Spark-1-x"><a href="#Spark-1-x" class="headerlink" title="Spark 1.x"></a>Spark 1.x</h4><p>åœ¨æ—©æœŸç‰ˆæœ¬ Spark 1.x ä¸­ï¼ŒDataFrame ç±»ä¼¼äºä¼ ç»Ÿæ•°æ®åº“ä¸­çš„äºŒç»´è¡¨æ ¼</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302132214130.png" alt="image-20230213221449968" loading="lazy"></p>
<p>å·¦ä¾§çš„ RDD[Person]è™½ç„¶ä»¥ Person ä¸ºç±»å‹å‚æ•°ï¼Œä½† Spark æ¡†æ¶æœ¬èº«ä¸äº†è§£ Person ç±»çš„å†…éƒ¨ç»“æ„</p>
<p>å³ä¾§çš„ DataFrame å¤šäº†æ•°æ®çš„ç»“æ„ä¿¡æ¯ï¼Œå³ schemaï¼Œå¯ä»¥æ¸…æ¥šåœ°çŸ¥é“è¯¥æ•°æ®é›†ä¸­åŒ…å«å“ªäº›åˆ—ï¼Œæ¯åˆ—çš„åç§°å’Œç±»å‹å„æ˜¯ä»€ä¹ˆ</p>
<h4 id="Spark-2-x"><a href="#Spark-2-x" class="headerlink" title="Spark 2.x"></a>Spark 2.x</h4><p>ä½†åœ¨æ–°ç‰ˆæœ¬ Spark 2.x ä¸­ï¼ŒDataFrame=DataSet[Row]ï¼Œå³DataFrame æ¯ä¸€è¡Œæ˜¯ <strong>Row ç±»å‹</strong>ï¼Œä½†æ¯ä¸€è¡Œç©¶ç«Ÿæœ‰å“ªäº›å­—æ®µï¼Œå„ä¸ªå­—æ®µåˆæ˜¯ä»€ä¹ˆç±»å‹éƒ½æ— ä»å¾—çŸ¥ï¼Œå³æ¯ä¸€åˆ—çš„å€¼æ— æ³•ç›´æ¥è®¿é—®ï¼Œåªèƒ½ç”¨ <code>getAS</code> æ–¹æ³•å¾—åˆ°å„å­—æ®µçš„å…·ä½“å€¼</p>
<pre class="language-scala" data-language="scala"><code class="language-scala">testDataFrame<span class="token punctuation">.</span>foreach<span class="token punctuation">&#123;</span>
  line <span class="token keyword">=></span>
    <span class="token keyword">val</span> col1<span class="token operator">=</span>line<span class="token punctuation">.</span>getAs<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"col1"</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> col2<span class="token operator">=</span>line<span class="token punctuation">.</span>getAs<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"col2"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>

<h4 id="DataFrame-æŸ¥è¯¢ä¼˜åŒ–"><a href="#DataFrame-æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="DataFrame æŸ¥è¯¢ä¼˜åŒ–"></a>DataFrame æŸ¥è¯¢ä¼˜åŒ–</h4><p>DataFrame ä¸ RDD éƒ½æ˜¯æ‡’æ‰§è¡Œçš„ï¼Œä½† DataFrame æ€§èƒ½æ¯” RDD é«˜ï¼Œå› ä¸º Spark SQL å…·æœ‰<strong>æŸ¥è¯¢ä¼˜åŒ–å™¨</strong>ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302132156508.png" alt="image-20230213215625359" loading="lazy"></p>
<p>å›¾ä¸­æ„é€ äº†ä¸¤ä¸ª DataFrameï¼Œå…ˆå°†ä»–ä»¬ join ç„¶åè¿›è¡Œ filter æ“ä½œ</p>
<p>å¦‚æœåŸå°ä¸åŠ¨åœ°æ‰§è¡Œè¿™ä¸ªæ‰§è¡Œè®¡åˆ’ï¼Œæœ€ç»ˆçš„æ‰§è¡Œæ•ˆç‡æ˜¯ä¸é«˜çš„ï¼Œå› ä¸º join æ˜¯ä¸€ä¸ªä»£ä»·è¾ƒå¤§çš„æ“ä½œï¼Œä¹Ÿå¯èƒ½ä¼šäº§ç”Ÿä¸€ä¸ªè¾ƒå¤§çš„æ•°æ®é›†</p>
<p>å¦‚æœæˆ‘ä»¬èƒ½å°† filter å»¶è¿Ÿåˆ° join ä¹‹åæ‰§è¡Œï¼Œå…ˆå¯¹ DataFrame è¿›è¡Œè¿‡æ»¤ï¼Œå† join è¿‡æ»¤åçš„è¾ƒå°çš„ç»“æœé›†ï¼Œä¾¿å¯ä»¥æœ‰æ•ˆç¼©çŸ­æ‰§è¡Œæ—¶é—´</p>
<p>è€Œ Spark SQL çš„æŸ¥è¯¢ä¼˜åŒ–å™¨æ­£æ˜¯è¿™æ ·åšçš„ï¼Œç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯å°†<strong>é«˜æˆæœ¬</strong>çš„æ“ä½œæ›¿æ¢ä¸º<strong>ä½æˆæœ¬</strong>æ“ä½œçš„è¿‡ç¨‹</p>
<blockquote>
<p>å…³äºæ‡’æ‰§è¡Œï¼š</p>
<p>Sparkç®—å­ä¸»è¦åˆ’åˆ†ä¸ºä¸¤ç±»ï¼štransformation å’Œ action ï¼Œå¹¶ä¸”åªæœ‰actionç®—å­è§¦å‘çš„æ—¶å€™æ‰ä¼šçœŸæ­£æ‰§è¡Œä»»åŠ¡</p>
<p>å¸¸ç”¨çš„ç®—å­mapã€flatMapã€filteréƒ½æ˜¯ transformation ç®—å­</p>
<p>è€Œcollectã€countã€saveAsTextFileã€countByKeyã€foreachåˆ™ä¸ºactionç®—å­</p>
<p><strong>ä¸ºä»€ä¹ˆ Spark ä»»åŠ¡åªæœ‰åœ¨è°ƒç”¨ action ç®—å­çš„æ—¶å€™ï¼Œæ‰ä¼šçœŸæ­£æ‰§è¡Œå‘¢ï¼Ÿ</strong></p>
<p>å‡å¦‚ transformation ç®—å­ç›´æ¥è§¦å‘ Spark ä»»åŠ¡ï¼š</p>
<ul>
<li>å¯¼è‡´ map æ‰§è¡Œå®Œäº†è¦ç«‹å³è¾“å‡ºï¼Œæ•°æ®ä¹Ÿå¿…ç„¶è¦è½åœ°ï¼ˆå†…å­˜å’Œç£ç›˜ï¼‰</li>
<li>å¯¹äº map ä»»åŠ¡çš„ç”Ÿæˆã€è°ƒåº¦ã€æ‰§è¡Œä»¥åŠå½¼æ­¤ä¹‹é—´çš„ RPC é€šä¿¡ç­‰ï¼Œå½“æ¶‰åŠå¤§æ•°æ®é‡æ—¶ï¼Œä¼šå¾ˆå½±å“æ€§èƒ½</li>
</ul>
<p>MapReduce æ­£æ˜¯å› ä¸ºä¸­é—´ç»“æœéœ€è¦è½åœ°ï¼Œå¯¼è‡´æ€§èƒ½ä½ä¸‹</p>
<p>Spark åªæœ‰è°ƒç”¨ action ç®—å­æ—¶æ‰ä¼šçœŸæ­£æ‰§è¡Œä»»åŠ¡ï¼Œè¿™æ˜¯ç›¸å¯¹äº MapReduce çš„ä¼˜åŒ–ä¹‹ä¸€</p>
</blockquote>
<h3 id="DataSet"><a href="#DataSet" class="headerlink" title="DataSet"></a>DataSet</h3><p>è¿™é‡Œä»¥æ–°ç‰ˆæœ¬ Spark 2.x ä¸ºä¾‹</p>
<p><code>DataFrame=DataSet[Row]</code></p>
<p>DataFrame ä¹Ÿå¯ä»¥ç§°ä¸º DataSet[Row]ï¼Œæ¯ä¸€è¡Œçš„ç±»å‹éƒ½æ˜¯ <strong>Row</strong>ï¼Œä½†æ¯ä¸€è¡Œæœ‰å“ªäº›å­—æ®µï¼Œå„å­—æ®µæ˜¯ä»€ä¹ˆç±»å‹éƒ½æ— æ³•å¾—çŸ¥</p>
<p>DataSet ä¸åŒäº DataFrameï¼Œåœ¨å®šä¹‰äº† case class åå¯ä»¥ç›´æ¥è·å–æ¯åˆ—çš„å€¼</p>
<pre class="language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">case</span> <span class="token keyword">class</span> Coltest<span class="token punctuation">(</span>col1<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">,</span>col2<span class="token operator">:</span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token keyword">extends</span> Serializable <span class="token comment">//å®šä¹‰å­—æ®µåå’Œç±»å‹</span>

<span class="token keyword">val</span> test<span class="token operator">:</span> Dataset<span class="token punctuation">[</span>Coltest<span class="token punctuation">]</span><span class="token operator">=</span>rdd<span class="token punctuation">.</span>map<span class="token punctuation">&#123;</span>line<span class="token keyword">=></span>
      Coltest<span class="token punctuation">(</span>line<span class="token punctuation">.</span>_1<span class="token punctuation">,</span>line<span class="token punctuation">.</span>_2<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">.</span>toDS

test<span class="token punctuation">.</span>map<span class="token punctuation">&#123;</span>
      line<span class="token keyword">=></span>
        println<span class="token punctuation">(</span>line<span class="token punctuation">.</span>col1<span class="token punctuation">)</span>
        println<span class="token punctuation">(</span>line<span class="token punctuation">.</span>col2<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span></code></pre>

<h4 id="DataSet-gt-DataFrame"><a href="#DataSet-gt-DataFrame" class="headerlink" title="DataSet -&gt; DataFrame"></a>DataSet -&gt; DataFrame</h4><p>DataSet å°è£…æˆ Row ç±»å‹åï¼Œå¯è½¬ä¸º DataFrame</p>
<pre class="language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">import</span> <span class="token namespace">spark<span class="token punctuation">.</span>implicits<span class="token punctuation">.</span></span>_

<span class="token keyword">val</span> testDF <span class="token operator">=</span> testDS<span class="token punctuation">.</span>toDF</code></pre>

<h4 id="DataFrame-gt-DataSet"><a href="#DataFrame-gt-DataSet" class="headerlink" title="DataFrame -&gt; DataSet"></a>DataFrame -&gt; DataSet</h4><p>DataFrame ç»™å‡ºæ¯åˆ—çš„å…·ä½“ç±»å‹ï¼Œä½¿ç”¨ as æ–¹æ³•ï¼Œå¯è½¬ä¸º DataSet</p>
<pre class="language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">import</span> <span class="token namespace">spark<span class="token punctuation">.</span>implicits<span class="token punctuation">.</span></span>_

<span class="token keyword">case</span> <span class="token keyword">class</span> Coltest<span class="token punctuation">(</span>col1<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">,</span>col2<span class="token operator">:</span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token keyword">extends</span> Serializable <span class="token comment">//å®šä¹‰å­—æ®µåå’Œç±»å‹</span>
<span class="token keyword">val</span> testDS <span class="token operator">=</span> testDF<span class="token punctuation">.</span>as<span class="token punctuation">[</span>Coltest<span class="token punctuation">]</span></code></pre>

<h3 id="Spark-Session"><a href="#Spark-Session" class="headerlink" title="Spark Session"></a>Spark Session</h3><p>åœ¨ä»¥å¾€ Spark Core ä¸­ï¼Œè‹¥è¦æ‰§è¡Œåº”ç”¨ç¨‹åºï¼Œéœ€è¦å…ˆåˆ›å»ºä¸Šä¸‹æ–‡å¯¹è±¡ SparkContext</p>
<p>è€Œ Spark SQL å¯¹å…¶è¿›è¡Œäº†å°è£…ï¼Œç§°ä¸º SparkSessionï¼Œæ‰€ä»¥å®é™…ä¸Šçš„è®¡ç®—æ˜¯ç”±å†…éƒ¨ SparkContext å®Œæˆçš„</p>
<p>Spark Session æ˜¯ Spark SQL æŸ¥è¯¢çš„èµ·ç‚¹</p>
<h3 id="ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°-UDF"><a href="#ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°-UDF" class="headerlink" title="ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•° UDF"></a>ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•° UDF</h3><p>ç”¨æˆ·å¯ä»¥é€šè¿‡ <code>spark.udf</code> åˆ›å»ºè‡ªå®šä¹‰å‡½æ•°ï¼Œå®ç°è‡ªå®šä¹‰åŠŸèƒ½</p>
<pre class="language-scala" data-language="scala"><code class="language-scala">spark<span class="token punctuation">.</span>udf<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">"addName"</span><span class="token punctuation">,</span><span class="token punctuation">(</span>x<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token keyword">=></span> <span class="token string">"Name:"</span><span class="token operator">+</span>x<span class="token punctuation">)</span></code></pre>

<h2 id="Spark-Streaming"><a href="#Spark-Streaming" class="headerlink" title="Spark Streaming"></a>Spark Streaming</h2><p>Spark Streaming ç”¨äºæµå¼æ•°æ®çš„å¤„ç†ï¼Œæ”¯æŒçš„æ•°æ®æºå¾ˆå¤šï¼Œä¾‹å¦‚ Kafkaã€ç®€å• TCP å¥—æ¥å­—ç­‰</p>
<p>ä¸ Spark åŸºäº RDD ç±»ä¼¼ï¼ŒSpark Streaming åŸºäº DStreamï¼ŒDStream æ˜¯éšæ—¶é—´æ¨ç§»æ”¶åˆ°çš„æ•°æ®åºåˆ—</p>
<p>DStream å†…éƒ¨æ¯ä¸ªæ—¶é—´é—´éš”æ”¶åˆ°çš„æ•°æ®æ˜¯ä½œä¸º RDD å­˜åœ¨ï¼Œè€Œ DStream æ˜¯ç”±è¿™äº› RDD ç»„æˆçš„åºåˆ—ï¼Œå³ç¦»æ•£åŒ–</p>
<p>æ€»ä¹‹ï¼ŒDStream æ˜¯å¯¹ RDD åœ¨å®æ—¶æ•°æ®å¤„ç†åœºæ™¯çš„å°è£…</p>
<blockquote>
<p><strong>æµå¼å¤„ç† å’Œ æ‰¹é‡å¤„ç†</strong></p>
<p>ä»æ•°æ®å¤„ç†çš„æ–¹å¼è§’åº¦</p>
<ul>
<li>æµå¼å¤„ç†ï¼šæ¥æ”¶ä¸€æ¡æ•°æ®ï¼Œç«‹å³è¿›è¡Œå¤„ç†</li>
<li>æ‰¹é‡å¤„ç†ï¼šæ¥æ”¶ä¸€æ¡æ•°æ®ï¼Œå…ˆæš‚å­˜ï¼Œæ”¶é›†ä¸€æ‰¹æ•°æ®åä¸€èµ·å¤„ç†</li>
</ul>
<p><strong>å®æ—¶å¤„ç† å’Œ ç¦»çº¿å¤„ç†</strong></p>
<p>ä»æ•°æ®å¤„ç†çš„å»¶è¿Ÿé•¿çŸ­è§’åº¦</p>
<ul>
<li>å®æ—¶å¤„ç†ï¼šæ¯«ç§’</li>
<li>ç¦»çº¿å¤„ç†ï¼šå°æ—¶ã€å¤©</li>
</ul>
</blockquote>
<p>è€Œ Spark Streaming æ˜¯å‡†å®æ—¶ï¼ˆç§’ã€åˆ†é’Ÿï¼‰çš„æ•°æ®å¤„ç†æ¡†æ¶</p>
<h3 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h3><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302191540611.png" alt="image-20230219154000410" loading="lazy"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302191540945.png" alt="image-20230219154017818" loading="lazy"></p>
<h3 id="èƒŒå‹æœºåˆ¶"><a href="#èƒŒå‹æœºåˆ¶" class="headerlink" title="èƒŒå‹æœºåˆ¶"></a>èƒŒå‹æœºåˆ¶</h3><p><img src="https://cdn.jsdelivr.net/gh/Rayucan/imageCloud/data/202302191542019.png" alt="image-20230219154236720" loading="lazy"></p>
<p>Spark Streaming å¤„ç†ä»»åŠ¡é‡‡ç”¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼Œæ¥æ”¶å™¨ï¼ˆæˆ–é‡‡é›†å™¨ï¼ŒReceiverï¼‰æ¥æ”¶åˆ°æ•°æ®åï¼Œç”± Driver å‘é€ç»™ Executor å·¥ä½œèŠ‚ç‚¹å¤„ç†æ•°æ®</p>
<p>æ­¤æ—¶å¯èƒ½ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œå¦‚æ¥æ”¶å™¨æ¥æ”¶å¤ªå¿«ï¼Œå·¥ä½œèŠ‚ç‚¹æ¥ä¸åŠå¤„ç†æ•°æ®ï¼Œä¼šé€ æˆæ•°æ®ç§¯å‹ï¼Œæˆ–å·¥ä½œèŠ‚ç‚¹å¤„ç†æ•°æ®å¤ªå¿«ï¼Œé€ æˆèµ„æºæµªè´¹</p>
<p>ä¸ºäº†åè°ƒæ¥æ”¶é€Ÿç‡å’Œå¤„ç†é€Ÿç‡ï¼ŒSpark Streaming é‡‡ç”¨èƒŒå‹æœºåˆ¶ï¼Œå¯æ ¹æ®ä½œä¸šæ‰§è¡Œæƒ…å†µåŠ¨æ€è°ƒæ•´ Receiver æ¥æ”¶é€Ÿç‡</p>
</div><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author: </strong>rayucan</li><li class="post-copyright-link"><strong>Post link: </strong><a href="http://example.com/2023/01/07/Spark/" title="Spark">http://example.com/2023/01/07/Spark/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> unless otherwise stated.</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2023/02/18/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/" rel="prev" title="æ¨èç³»ç»Ÿ"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">æ¨èç³»ç»Ÿ</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2023/01/01/Scala/" rel="next" title="Scala"><span class="post-nav-text">Scala</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>è¦ä¸è¦å’Œæˆ‘è¯´äº›ä»€ä¹ˆï¼Ÿ</span><br></div></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2023 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> rayucan</span></div><div class="powered"><span>Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> v5.4.0</span><span class="footer-separator">|</span><span>Theme - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.6.1</span></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></div></body></html>